---
title: "Summary Statistics"
author: "Kateri Mouawad"
date: "2024-06-17"
output: html_document
---
#START HERE - load packages

```{r}

#remotes::install_github("kwb-r/kwb.utils")

#options(repos = c(
#  kwbr = 'https://kwb-r.r-universe.dev',
#  CRAN = 'https://cloud.r-project.org'))
  
# Download and install kwb.utils in R
#install.packages('kwb.utils')




# install.packages(officer)
# install.packages(r2rtf)
# install.packages(dplyr)
# install.packages(ggplot2)
# install.packages(kwb.utils)
# install.packages(haven)
# install.packages(data.table)
# install.packages(rtf)
# install.packages(tidyverse)
# install.packages(estimatr)
# install.packages(broom)

library(officer)
library(r2rtf)
library(dplyr)
library(ggplot2)
library(kwb.utils)
library(haven)
library(data.table)
library(rtf)
library(tidyverse)
library(estimatr)
library(broom)

```


#File and Data paths
```{r}

# Define the file paths
proj_paths <- list(
  projects = "C:/Users/Kateri/Box/NSF Senegal",
  alternative_projects = "C:/Users/km978/Box/NSF Senegal"
)

# Check if the Kateri path exists and resolve the project path accordingly
if (file.exists(proj_paths$projects)) {
  proj <- kwb.utils::resolve(list(
    projects = proj_paths$projects,
    p1 = "<projects>/Data Management/_CRDES_CleanData/Baseline/Deidentified"
  ))
} else {
  proj <- kwb.utils::resolve(list(
    projects = proj_paths$alternative_projects,
    p1 = "<projects>/Data Management/_CRDES_CleanData/Baseline/Deidentified"
  ))
}



# proj <- kwb.utils::resolve(list(
#   projects = "C:/Users/Kateri/Box/NSF Senegal",
#   p1 = "<projects>/Data Work/Output/Data Corrections"
# ))

file_path_hh <- file.path(proj$p1, "Complete_Baseline_Household_Roster.dta")
household_df <- read_dta(file_path_hh)

file_path_know <- file.path(proj$p1, "Complete_Baseline_Knowledge.dta")
knowledge_df <- read_dta(file_path_know)

file_path_health <- file.path(proj$p1, "Complete_Baseline_Health.dta")
health_df <- read_dta(file_path_health)

file_path_agri <- file.path(proj$p1, "Complete_Baseline_Agriculture.dta")
agriculture_df <- read_dta(file_path_agri)

file_path_prod <- file.path(proj$p1, "Complete_Baseline_Production.dta")
production_df <- read_dta(file_path_prod)

file_path_cop <- file.path(proj$p1, "Complete_Baseline_Lean_Season.dta")
coping_df <- read_dta(file_path_cop)

file_path_income <- file.path(proj$p1, "Complete_Baseline_Income.dta")
income_df <- read_dta(file_path_income)

file_path_standard <- file.path(proj$p1, "Complete_Baseline_Standard_Of_Living.dta")
standard_df <- read_dta(file_path_standard)

file_path_beliefs <- file.path(proj$p1, "Complete_Baseline_Beliefs.dta")
beliefs_df <- read_dta(file_path_beliefs)

file_path_game <- file.path(proj$p1, "Complete_Baseline_Public_Goods_Game.dta")
donation_df <- read_dta(file_path_game)

file_path_enumerator <- file.path(proj$p1, "Complete_Baseline_Enumerator_Observations.dta")
enumerator_df <- read_dta(file_path_enumerator)

file_path_community <- file.path(proj$p1, "Complete_Baseline_Community.dta")
community_df <- read_dta(file_path_community)



#print(head(baseline_data, 10))

#baseline_data <- baseline_data %>%
 # mutate(hh_age_resp = if_else(hhid == "023B09", 50, hh_age_resp))

```


#Define and run all functions: 


###Numerical Summary
```{r}

#This function is used to summarize numerical variables 


numerical_summary_func <- function(baseline_data, prefix) {
  baseline_data %>%
    select(starts_with(prefix)) %>%
    pivot_longer(cols = starts_with(prefix), names_to = "id", values_to = "value", names_prefix = paste0(prefix, "_")) %>%
    summarise(N = round(sum(!is.na(value)), 2),
              min = round(min(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
              mean = round(mean(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
              max = sprintf("%.2f", max(ifelse(value == -9, NA, value), na.rm = TRUE),2),
              sd = round(sd(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
              prop_na = round(sum(value == -9, na.rm = TRUE) / sum(!is.na(value)), 2)) %>%
    mutate(variable = prefix)
}

numerical_summary <- function(baseline_data, prefixes) {
  summaries <- lapply(prefixes, function(prefix) {
    numerical_summary_func(baseline_data, prefix)
  })
  numerical_sum_set <- bind_rows(summaries)
  return(numerical_sum_set)
}


```

#### Numerical Summary long form 



```{r}

# Function to calculate summary statistics for a single numeric vector
numerical_summary_func_l <- function(value) {
  
  # Calculate summary statistics for numeric variables
  numerical_stats_l <- data.frame(
    N = round(sum(!is.na(value)), 2),
    min = round(min(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    mean = round(mean(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    #max = round(max(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    max = sprintf("%.2f", max(ifelse(value == -9, NA, value), na.rm = TRUE),2),
    sd = round(sd(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    prop_na = round(sum(value == -9, na.rm = TRUE) / sum(!is.na(value)), 2)
  )
  
  return(numerical_stats_l)
}

# Function to summarize multiple sets of numeric variables by prefix
numerical_summary_l <- function(baseline_data, prefixes) {
  # Loop over each prefix
  summaries_numerical_l <- lapply(prefixes, function(prefix) {
    # Select the column that matches the prefix
    numerical_data_l <- baseline_data %>%
      select(starts_with(prefix))
    
    # Pull the column values and pass to numerical_summary_func_l
    value <- numerical_data_l[[1]]
    numerical_summary_stats <- numerical_summary_func_l(value)
    
    # Add the prefix (variable name) to the summary
    numerical_summary_stats$variable <- prefix
    
    return(numerical_summary_stats)
  })
  
  # Combine the summaries into a single data frame
  numerical_sum_set_l <- bind_rows(summaries_numerical_l)
  return(numerical_sum_set_l)
}


```



### Almost Binary

```{r}
almost_binary_func <- function(baseline_data, prefix) {
  almost_binary_data <- baseline_data %>%
    select(starts_with(prefix)) %>%
    pivot_longer(cols = starts_with(prefix), 
                 names_to = "id", 
                 values_to = "value", 
                 names_prefix = paste0(prefix, "_"))
  
  # Calculate N (including 0s, 1s, and 2s), mean, and sd for 0s and 1s
  binary_stats <- almost_binary_data %>%
    filter(value %in% c(0, 1, 2)) %>%
    summarise(N = round(sum(!is.na(value)), 2),  # N includes 0s, 1s, and 2s
              mean = round(mean(ifelse(value == -9 | value == 2, NA, value), na.rm = TRUE), 2),  # Exclude 2s for mean
              sd = round(sd(ifelse(value == -9 | value == 2, NA, value), na.rm = TRUE), 2),  # Exclude 2s for SD
              prop_na = round(sum(value == -9, na.rm = TRUE) / sum(!is.na(value)), 2))
  
  # Calculate proportion of 2s
  proportion_dont_know <- almost_binary_data %>%
    summarise(proportion_dont_know = round(mean(value == 2, na.rm = TRUE), 2)) %>%
    mutate(variable = prefix)

  # Combine results
  combined_stats <- cbind(binary_stats, proportion_dont_know)
  combined_stats$variable <- prefix  # Add prefix as a variable
  
  return(combined_stats)
}

# Function to summarize multiple sets of variables
almost_binary_summary <- function(baseline_data, prefixes) {
  summaries <- lapply(prefixes, function(prefix) {
    almost_binary_func(baseline_data, prefix)
  })
  almost_binary_sum_set <- bind_rows(summaries)
  return(almost_binary_sum_set)
}

```

####Almost binary long form 

```{r}
# Function to calculate summary statistics for a single vector (variable)
almost_binary_func_l <- function(value) {
  
  # Ensure we're working with values 0, 1, and 2 only
  value <- value[value %in% c(0, 1, 2, -9)] 
  
  # Calculate summary statistics for 0s and 1s (exclude -9 and 2 for mean and SD)
  almost_binary_stats_l <- data.frame(
    N = round(sum(!is.na(value)), 2),  # N includes 0s, 1s, and 2s
    mean = round(mean(ifelse(value == -9 | value == 2, NA, value), na.rm = TRUE), 2),  # Exclude 2s and -9 for mean
    sd = round(sd(ifelse(value == -9 | value == 2, NA, value), na.rm = TRUE), 2),  # Exclude 2s and -9 for SD
    prop_na = round(sum(value == -9, na.rm = TRUE) / sum(!is.na(value)), 2)  # Proportion of NAs (-9)
  )
  
  # Calculate proportion of 2s
  proportion_dont_know_l <- data.frame(
    proportion_dont_know_l = round(mean(value == 2, na.rm = TRUE), 2)  # Proportion of "Don't know" (2)
  )
  
  # Combine results
  almost_binary_combined_stats_l <- cbind(almost_binary_stats_l, proportion_dont_know_l)
  
  return(almost_binary_combined_stats_l)
}

# Function to summarize multiple sets of variables by prefix
almost_binary_summary_l <- function(baseline_data, prefixes) {
  # Loop over each prefix
  summaries_almost_binary_l <- lapply(prefixes, function(prefix) {
    # Select the column that matches the prefix
    almost_binary_data_l <- baseline_data %>%
      select(starts_with(prefix))
    
    # Ensure only one column is selected for each prefix
 #Pull the column values and pass to almost_binary_func_l
    value <- almost_binary_data_l[[1]]
    almost_binary_summary_stats_l <- almost_binary_func_l(value)
    
    # Add the prefix (variable name) to the summary
    almost_binary_summary_stats_l$variable <- prefix
    
    return(almost_binary_summary_stats_l)
  })
  
  # Combine all summaries into a single data frame
  almost_binary_sum_set_l <- bind_rows(summaries_almost_binary_l)
  return(almost_binary_sum_set_l)
}

```



### Binary


```{r}

binary_func <- function(baseline_data, prefix) {
  # Pivot longer to create the 'value' column
  binary_data <- baseline_data %>%
    select(starts_with(prefix)) %>%
    pivot_longer(cols = everything(), 
                 names_to = "id", 
                 values_to = "value") 
  
  # Check if 'value' column exists
  #print(head(binary_data))  # Print the first few rows to verify
  
  # Adjust 2 -> 0 and 1 -> 1
  binary_data <- binary_data %>%
    mutate(value = ifelse(value == 2, 0, 
                   ifelse(value == 1, 1, value)))  

  # Calculate mean, sd, and N for 0s and 1s
  binary_stats <- binary_data %>%
    summarise(N = round(sum(!is.na(value)), 2),
    #summarise(N = round(sum(!is.na(ifelse(value == -9, NA, value))), 2),
              mean = round(mean(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
              sd = round(sd(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
              prop_na = round(sum(value == -9, na.rm = TRUE) / sum(!is.na(value)), 2))  
  
  binary_stats$variable <- prefix  # Add prefix as a variable
  
  return(binary_stats)
}

# Function to summarize multiple sets of variables
binary_summary <- function(baseline_data, prefixes) {
  summaries_binary <- lapply(prefixes, function(prefix) {
    binary_func(baseline_data, prefix)
  })
  binary_sum_set <- bind_rows(summaries_binary)
  return(binary_sum_set)
}


```



####Binary long form 

```{r}

# Function to calculate summary statistics for a single vector (variable)
binary_func_l <- function(value) {

  # Calculate summary statistics for 0s and 1s
  binary_stats_l <- data.frame(
    N = round(sum(!is.na(value)), 2),
    mean = round(mean(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    sd = round(sd(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    prop_na = round(sum(value == -9, na.rm = TRUE) / sum(!is.na(value)), 2)
  )
  
  return(binary_stats_l)
}

binary_summary_l <- function(baseline_data, prefixes) {
  # Loop over each prefix
  summaries_binary_l <- lapply(prefixes, function(prefix) {
    # Select the column that matches the prefix
    selected_data <- baseline_data %>%
      select(starts_with(prefix))
    
    # Pull the column values and pass to binary_func_l
    value <- selected_data[[1]]
    summary_stats <- binary_func_l(value)
    
    # Add the prefix (variable name) to the summary
    summary_stats$variable <- prefix
    
    return(summary_stats)
  })
  
  binary_sum_set_l <- bind_rows(summaries_binary_l)
  return(binary_sum_set_l)
}

```


### Categorical



```{r}
categ_func <- function(value) {
  # N = Total number of non-empty, non-NA observations (including -9s but excluding true NAs/empty cells)
  N <- sum(!is.na(value) & value != "")
  
  # Remove NAs and invalid values (-9 in this example)
  valid_value <- value[!is.na(value) & value != -9]
  
  # Calculate frequency and proportion for valid responses
  freq_table <- table(valid_value)
  proportions <- round(freq_table / length(valid_value), 2)
  
  # Calculate the proportion of -9s and NAs
  prop_na <- round(sum(value == -9, na.rm = TRUE) / N, 2)
  #prop_na <- round(sum(value == -9 | is.na(value) | value == ".", na.rm = TRUE) / N, 2)

  
  # Create a data frame with the summary
  categorical_data <- data.frame(
    Value = names(freq_table),
    N = N,  # Total number of observations
    Frequency = as.vector(freq_table),  # Frequency of valid responses
    Proportion = as.vector(proportions),  # Proportion of valid responses
    prop_na = prop_na  # Proportion of -9s/NAs
  )
  
  return(categorical_data)
}

categ_summary <- function(data, prefixes) {
  summaries <- lapply(prefixes, function(prefix) {
    variable_data <- data %>%
      select(starts_with(prefix)) %>%
      pivot_longer(cols = everything(), names_to = "variable", values_to = "value")
    
    # Pass the 'value' column to categ_func
    summary_categ <- categ_func(variable_data$value)
    summary_categ$Variable <- prefix  # Assign the prefix as the variable name
    return(summary_categ)
  })
  
  categ_sum_set <- bind_rows(summaries)
  return(categ_sum_set)
}

```


#### Categorical long format 



```{r}

# Function to calculate summary statistics for a single categorical vector
categ_func_l <- function(value_l) {
  # N = Total number of non-empty, non-NA observations (including -9s but excluding true NAs/empty cells)
  N <- sum(!is.na(value_l) & value_l != "")
  
  # Remove NAs and invalid values (-9 in this example)
  valid_value_l <- value_l[!is.na(value_l) & value_l != -9]
  
  # Calculate frequency and proportion for valid responses
  freq_table_l <- table(valid_value_l)
  proportions_l <- round(freq_table_l / length(valid_value_l), 2)
  
  # Calculate the proportion of -9s and NAs
  prop_na_l <- round(sum(value_l == -9, na.rm = TRUE) / N, 2)
  
  # Create a data frame with the summary
  categorical_data_l <- data.frame(
    Value = names(freq_table_l),
    N = N,  # Total number of observations
    Frequency = as.vector(freq_table_l),  # Frequency of valid responses
    Proportion = as.vector(proportions_l),  # Proportion of valid responses
    prop_na = prop_na_l  # Proportion of -9s/NAs
  )
  
  return(categorical_data_l)
}

# Function to summarize multiple categorical variables by prefix
categ_summary_l <- function(data_l, prefixes_l) {
  summaries_l <- lapply(prefixes_l, function(prefix_l) {
    variable_data_l <- data_l %>%
      select(starts_with(prefix_l))
    
    # Pull the 'value' column and pass to categ_func_l
    value_l <- variable_data_l[[1]]
    summary_categ_l <- categ_func_l(value_l)
    summary_categ_l$Variable_l <- prefix_l  # Assign the prefix as the variable name
    return(summary_categ_l)
  })
  
  categ_sum_set_l <- bind_rows(summaries_l)
  return(categ_sum_set_l)
}


```


# Function shortcuts

### numerical

```{r}
# prefixes_numberreplace <- c("list", "goes", "here","", "", "", "", "", "","", "", "", "", "", "","", "", "", "", "", "",)
# # Function to summarize multiple sets of variables
# numerical_summary(baseline_data, prefixes_numberreplace)
# 
# print(numerical_summary)

```


### almost binary

```{R}
# 
# prefixes_numberreplace <- c("list", "goes", "here""", "", "", "", "", "","", "", "", "", "", "",)
# 
# # Summarize all sets of variables
# almost_binary_summary(baseline_data, prefixes)
# 
# print(binary_summary)

```



### binary

```{r}


# # List of prefixes for sets of variables
# prefixes_numberreplace <- c("list", "goes", "here","", "", "", "", "", "","", "", "", "", "", "")
# 
# # Summarize all sets of variables
# binary_summary(baseline_data, prefixes)
# 
# print(binary_summary)
```


### categorical


```{r}

# var_replace_cat <- c("list", "goes", "here","", "", "", "", "", "","", "", "", "", "", "")
# 
# 
# print(categ_summary(baseline_data, var_replace_cat))


```

#BEGIN SUMMARY STATS

## Household Roster
####Categorical 
##### hh_ethnicity


```{r}
# Step 1: Select all columns except those starting with hh_ethnicity_o_
hh_ethn_c <- household_df %>%
  select(-matches("^hh_ethnicity_o_"))


prefixes_ethnicity <- c("hh_ethnicity")

# Print combined summary
print(categ_summary(hh_ethn_c, prefixes_ethnicity))

################################ ETHNICITY OTHER ##################################################

hh_ethn_c2 <- household_df %>%
  select(matches("^hh_ethnicity_o_")) %>%
  
  # Step 2: Convert all columns that start with hh_ethnicity_o_ to strings
  mutate(across(starts_with("hh_ethnicity_o_"), as.character))

#view(hh_categ)
prefixes_ethnicity_o <- c("hh_ethnicity_o_")

# Print combined summary
print(categ_summary(hh_ethn_c2, prefixes_ethnicity_o))


```

#####hh_relation

```{r}


# Step 1: Select all columns except those starting with hh_ethnicity_o_
hh_rel_c <- household_df %>%
  select(-matches("^hh_relation_with_o_"))


prefixes_hh_rel <- c("hh_relation_with")

# Print combined summary
print(categ_summary(hh_rel_c, prefixes_hh_rel))

################################ ETHNICITY OTHER ##################################################

hh_rel_c2 <- household_df %>%
  select(matches("^hh_relation_with_o_")) %>%
  
  # Step 2: Convert all columns that start with hh_ethnicity_o_ to strings
  mutate(across(starts_with("hh_relation_with_o_"), as.character))

#view(hh_categ)
prefixes_hh_rel_o <- c("hh_relation_with_o_")

# Print combined summary
print(categ_summary(hh_rel_c2, prefixes_hh_rel_o))


```


#####hh_education_level

```{r}


# Step 1: Select all columns except those starting with hh_ethnicity_o_
hh_edu_lvl_c <- household_df %>%
  select(-matches("^hh_education_level_o"))


prefixes_edu_lvl <- c("hh_education_level_")

# Print combined summary
print(categ_summary(hh_edu_lvl_c, prefixes_edu_lvl))

################################ ETHNICITY OTHER ##################################################

hh_edu_lvl_c2 <- household_df %>%
  select(matches("^hh_education_level_o")) %>%
  
  # Step 2: Convert all columns that start with hh_ethnicity_o_ to strings
  mutate(across(starts_with("hh_education_level_o"), as.character))

#view(hh_categ)
prefixes_edu_lvl_o <- c("hh_education_level_o")

# Print combined summary
print(categ_summary(hh_edu_lvl_c2, prefixes_edu_lvl_o))


```
#####hh_main_activity

```{r}


# Step 1: Select all columns except those starting with hh_ethnicity_o_
hh_activ_c <- household_df %>%
  select(-matches("^hh_main_activity_o"))


prefixes_main_act <- c("hh_main_activity_")

# Print combined summary
print(categ_summary(hh_activ_c, prefixes_main_act))

################################ ETHNICITY OTHER ##################################################

hh_activ_c2 <- household_df %>%
  select(matches("^hh_main_activity_o")) %>%
  
  # Step 2: Convert all columns that start with hh_ethnicity_o_ to strings
  mutate(across(starts_with("hh_main_activity_o"), as.character))

#view(hh_categ)
prefixes_main_act_o <- c("hh_main_activity_o")

# Print combined summary
print(categ_summary(hh_activ_c2, prefixes_main_act_o))


```


##### hh_relation_imam

```{r}
prefixes_hh_rel_imam <- c("hh_relation_imam")


print(categ_summary(household_df, prefixes_hh_rel_imam))
```



#####hh_11 

```{r}


# Step 1: Select all columns except those starting with hh_ethnicity_o_
hh_11_c <- household_df %>%
  select(-matches("^hh_11_o_"))


prefixes_hh11 <- c("hh_11_")

# Print combined summary
print(categ_summary(hh_11_c, prefixes_hh11))

################################ ETHNICITY OTHER ##################################################

hh_11_c2 <- household_df %>%
  select(matches("^hh_11_o_")) %>%
  
  # Step 2: Convert all columns that start with hh_ethnicity_o_ to strings
  mutate(across(starts_with("hh_11_o_"), as.character))

#view(hh_categ)
prefixes_hh11_o <- c("hh_11_o_")

# Print combined summary
print(categ_summary(hh_11_c2, prefixes_hh11_o))


```

#####hh_12 

```{r}


# Step 1: Select all columns except those starting with hh_ethnicity_o_
# hh_12_c <- household_df %>%
#   select(matches("^hh_12_\\d_\\d+"))


prefixes_hh12 <- c("hh_12_1_","hh_12_2_","hh_12_3_","hh_12_4_","hh_12_5_","hh_12_6_","hh_12_7_","hh_12_8_")

# Print combined summary
print(binary_summary(household_df, prefixes_hh12))

################################ hh_12 OTHER ##################################################

hh_12_c2 <- household_df %>%
  select(matches("^hh_12_o_")) %>%
  
  # Step 2: Convert all columns that start with hh_ethnicity_o_ to strings
  mutate(across(starts_with("hh_12_o_"), as.character))

#view(hh_categ)
prefixes_hh12_o <- c("hh_12_o_")

# Print combined summary
print(categ_summary(hh_12_c2, prefixes_hh12_o))

################################ hh_12_a OTHER ##################################################

hh_12_almost_bin3 <- household_df %>%
  select(matches("^hh_12_a_")) #%>%
  
  # Step 2: Convert all columns that start with hh_ethnicity_o_ to strings
  #mutate(across(starts_with("hh_12_a_"), as.character))

#view(hh_categ)
prefixes_hh12_a <- c("hh_12_a_")

# Print combined summary
print(almost_binary_summary(hh_12_almost_bin3, prefixes_hh12_a))



```


#####hh_15

```{r}


# Step 1: Select all columns except those starting with hh_ethnicity_o_
hh_15_c <- household_df %>%
  select(matches("^hh_15_\\d+"))


prefixes_hh_15 <- c("hh_15_")

# Print combined summary
print(categ_summary(hh_15_c, prefixes_hh_15))

################################ hh_15 OTHER ##################################################

hh_15_c_o <- household_df %>%
  select(matches("^hh_15_o_")) %>%
  
  # Step 2: Convert all columns that start with hh_ethnicity_o_ to strings
  mutate(across(starts_with("hh_15_o_"), as.character))

#view(hh_categ)
prefixes_hh_15_o <- c("hh_15_o_")

# Print combined summary
print(categ_summary(hh_15_c_o, prefixes_hh_15_o))

################################ hh_15_a OTHER ##################################################

```


#####hh_19

```{r}


# Step 1: Select all columns except those starting with hh_ethnicity_o_
hh_19_c <- household_df %>%
  select(matches("^hh_19_\\d+"))


prefixes_hh_19 <- c("hh_19_")

# Print combined summary
print(categ_summary(hh_19_c, prefixes_hh_19))

################################ hh_19 OTHER ##################################################

hh_19_c2 <- household_df %>%
  select(matches("^hh_19_o_")) %>%
  
  # Step 2: Convert all columns that start with hh_ethnicity_o_ to strings
  mutate(across(starts_with("hh_19_o_"), as.character))

#view(hh_categ)
prefixes_hh_19_2 <- c("hh_19_o_")

# Print combined summary
print(categ_summary(hh_19_c2, prefixes_hh_19_2))

```

#####hh_20


```{r}


# Step 1: Select all columns except those starting with hh_ethnicity_o_
hh_20_c <- household_df %>%
  select(matches("^hh_20_\\d+_\\d+"))


prefixes_hh_20 <- c("hh_20_1_", "hh_20_2_","hh_20_3_","hh_20_4_", "hh_20_5_", "hh_20_6_","hh_20_7_","hh_20_8_")

# Print combined summary
print(binary_summary(hh_20_c, prefixes_hh_20))

################################ hh_20 OTHER ##################################################

hh_20_c_o <- household_df %>%
  select(matches("^hh_20_o_")) %>%
  
  # Step 2: Convert all columns that start with hh_ethnicity_o_ to strings
  mutate(across(starts_with("hh_20_o_"), as.character))

#view(hh_categ)
prefixes_hh_20_o <- c("hh_20_o_")

# Print combined summary
print(categ_summary(hh_20_c_o, prefixes_hh_20_o))

```


#####hh_23

```{r}

# Step 1: Select all columns except those starting with hh_23_
hh_23_d <- household_df %>%
  select(matches("^hh_23_\\d+_\\d+"))


prefixes_hh_23 <- c("hh_23_1_", "hh_23_2_","hh_23_3_","hh_23_4_", "hh_23_5_", "hh_23_99_")

# Print combined summary
print(binary_summary(hh_23_d, prefixes_hh_23))

################################ hh_23 OTHER ##################################################

hh_23_d2 <- household_df %>%
  select(matches("^hh_23_o_")) %>%
  
  # Step 2: Convert all columns that start with hh_23_ to strings
  mutate(across(starts_with("hh_23_o_"), as.character))

#view(hh_categ)
prefixes_hh_23_2 <- c("hh_23_o_")

# Print combined summary
print(categ_summary(hh_23_d2, prefixes_hh_23_2))


```

#####hh_28
```{r}

prefixes_hh_28 <- c("hh_28_")


print(categ_summary(household_df, prefixes_hh_28))



```


#####hh_29


```{r}

# Step 1: Select all columns except those starting with hh_29_
hh_29_d <- household_df %>%
  select(matches("^hh_29_\\d+"))

prefixes_hh_29 <- c("hh_29_")

# Print combined summary
print(categ_summary(hh_29_d, prefixes_hh_29))

################################ hh_29 OTHER ##################################################

hh_29_d2 <- household_df %>%
  select(matches("^hh_29_o_")) %>%
  
  # Step 2: Convert all columns that start with hh_29_ to strings
  mutate(across(starts_with("hh_29_o_"), as.character))

#view(hh_categ)
prefixes_hh_29_o <- c("hh_29_o_")

# Print combined summary
print(categ_summary(hh_29_d2, prefixes_hh_29_o))


```



#####hh_31


```{r}

prefixes_hh_31 <- c("hh_31_")


print(categ_summary(household_df, prefixes_hh_31))



```

#####hh_33


```{r}

prefixes_hh_33 <- c("hh_33_")


print(categ_summary(household_df, prefixes_hh_33))



```


#####hh_35

```{r}


hh_35_d <- c("hh_35")
# Function to summarize multiple sets of variables
print(categ_summary(household_df, hh_35_d))


```

####Binary 
#####gender
```{r}

# List of prefixes for sets of variables
prefixes_hh_bin <- c("hh_gender_resp", "hh_gender_")

# Summarize all sets of variables
print(binary_summary(household_df, prefixes_hh_bin))





```



####Numerical
#####hh_age - hh_education_year
```{r}
#Cleaning for variable hh_34:





prefixes_n1 <- c("hh_age", "hh_01", "hh_02", "hh_04", "hh_05","hh_06", "hh_07", "hh_08", "hh_09", "hh_10", "hh_13", "hh_14", "hh_16", "hh_17","hh_18", "hh_21","hh_21_o", "hh_22", "hh_24", "hh_25", "hh_34", "hh_38", "hh_age_resp", "hh_education_year_achieve")
# Function to summarize multiple sets of variables
print(numerical_summary(household_df, prefixes_n1))

#hh_34 has an outlier - value 2022, hhid = 082B16 and value = 0 and with 091B09. Deal with that here:

hh_34_d <- household_df %>%
  select(hhid, starts_with("hh_34")) %>%  # Keep only hhid and columns with the prefix "hh_34"
  pivot_longer(cols = starts_with("hh_34"), names_to = "variable", values_to = "hh_34") %>%  # Reshape wide to long
  filter(hh_34 != 2022) %>%
  filter(hh_34 != 0)# Drop rows where hh_34 equals 2022


prefixes_hh_34 <- c("hh_34")
print(numerical_summary(hh_34_d, prefixes_hh_34))

```

###### hh_38

```{r}

hh_38_check <- household_df %>%
  select(hhid, starts_with("hh_38")) %>%  # Select columns that start with "hh_32" and hhid
  pivot_longer(cols = -hhid,  # Keep "hhid" as is, pivot all other columns
               names_to = "id", 
               values_to = "value")


table(hh_38_check$value)










```


##### hh_education_skills

```{r}



hh_edu_b <- household_df %>%
  select(matches("^hh_education_skills_\\d_\\d+"))



# List of prefixes for sets of variables
prefixes_edu <- c("hh_education_skills_0_","hh_education_skills_1_","hh_education_skills_2_","hh_education_skills_3_","hh_education_skills_4_", "hh_education_skills_5_")

# Summarize all sets of variables
print(binary_summary(hh_edu_b, prefixes_edu))



```









####Almost binary
##### hh_mother_live - hh_37

```{R}

prefixes_hh_abin1 <- c("hh_mother_live", "hh_presence_winter", "hh_presence_dry","hh_active_agri", "hh_03", "hh_20_a", "hh_26", "hh_27", "hh_30","hh_32", "hh_36", "hh_37")

# Summarize all sets of variables
print(almost_binary_summary(household_df, prefixes_hh_abin1))

length(household_df$hh_32_)


```

######Data analysis here 
```{r}
hh_32_check <- household_df %>%
  select(hhid, starts_with("hh_32")) %>%  # Select columns that start with "hh_32" and hhid
  pivot_longer(cols = -hhid,  # Keep "hhid" as is, pivot all other columns
               names_to = "id", 
               values_to = "value")
head(hh_32_check)

table(hh_32_check$value)


```
 

##Knowledge
###Categorical 

#####knowledge_05 

```{r}

# Step 1: Select all columns except those starting with hh_23_
knowledge_05_d <- knowledge_df %>%
  select(-matches("^knowledge_05_o"))


prefixes_knowledge_05 <- c("knowledge_05")

# Print combined summary
print(categ_summary(knowledge_05_d, prefixes_knowledge_05))

################################ hh_23 OTHER ##################################################

knowledge_05_d2 <- knowledge_df %>%
  select(matches("^knowledge_05_o")) %>%
  
  # Step 2: Convert all columns that start with hh_23_ to strings
  mutate(across(starts_with("knowledge_05_o"), as.character))

#view(hh_categ)
prefixes_hh_23_2 <- c("knowledge_05_o")

# Print combined summary
print(categ_summary(knowledge_05_d2, prefixes_hh_23_2))





```



#####knowledge_06
```{r}

knowledge_06_d <- knowledge_df %>%
  select(matches("^knowledge_06_"))


prefixes_knowledge_06 <- c(paste("knowledge_06_", 1:6, sep=""))

# Print combined summary
print(binary_summary(knowledge_06_d, prefixes_knowledge_06))


```

#####knowledge_09

```{r}

knowledge_09_d <- knowledge_df %>%
  select(-"knowledge_09_o", -"knowledge_09")


prefixes_knowledge_09 <- c(paste("knowledge_09_", 1:6, sep=""), "knowledge_09_99")
# Print combined summary
print(binary_summary(knowledge_09_d, prefixes_knowledge_09))


```


#####knowledge_09

```{r}

knowledge_09_d <- knowledge_df %>%
  select(-"knowledge_09_o", -"knowledge_09")


prefixes_knowledge_09 <- c(paste("knowledge_09_", 1:6, sep=""), "knowledge_09_99")
# Print combined summary
print(binary_summary(knowledge_09_d, prefixes_knowledge_09))


```

#####knowledge_10

```{r}

knowledge_10_d <- knowledge_df %>%
  select(-"knowledge_10_o", -"knowledge_10")


prefixes_knowledge_10 <- c(paste("knowledge_10_", 1:7, sep=""), "knowledge_10_99")
# Print combined summary
print(binary_summary(knowledge_10_d, prefixes_knowledge_10))


```

#####knowledge_12

```{r}

knowledge_12_d <- knowledge_df %>%
  select(-"knowledge_12_o")


prefixes_knowledge_12 <- c("knowledge_12")
# Print combined summary
print(categ_summary(knowledge_12_d, prefixes_knowledge_12))


```

#####knowledge_19

```{r}

knowledge_19_d <- knowledge_df %>%
  select(-"knowledge_19_o")


prefixes_knowledge_19 <- c("knowledge_19")
# Print combined summary
print(categ_summary(knowledge_19_d, prefixes_knowledge_19))


```



#####knowledge_20

```{r}

knowledge_20_d <- knowledge_df %>%
  select(-"knowledge_20_o")


prefixes_knowledge_20 <- c("knowledge_20")
# Print combined summary
print(categ_summary(knowledge_20_d, prefixes_knowledge_20))


```



#####knowledge_21

```{r}

prefixes_knowledge_21 <- c("knowledge_21")
# Print combined summary
print(categ_summary(knowledge_df, prefixes_knowledge_21))


```

#####knowledge_22

```{r}

prefixes_knowledge_22 <- c("knowledge_22")
# Print combined summary
print(categ_summary(knowledge_df, prefixes_knowledge_22))


```


#####knowledge_23 - GROUPING

```{r}

knowledge_23_d <- knowledge_df %>%
  select(-"knowledge_23_o", -"knowledge_23")


prefixes_knowledge_23 <- c(paste("knowledge_23_", 1:6, sep=""), "knowledge_23_99")
# Print combined summary
print(binary_summary(knowledge_23_d, prefixes_knowledge_23))


```



###Almost binary 

```{r}

prefixes_abin_knowledge <- c("knowledge_01", "knowledge_03", "knowledge_04", "knowledge_07", "knowledge_11", "knowledge_13","knowledge_14", "knowledge_15", "knowledge_16", "knowledge_18")

# Summarize all sets of variables
print(almost_binary_summary(knowledge_df, prefixes_abin_knowledge))




```


##Health 


###Categorical 

####health_5_3 - DOUBLE INDEX

```{r}

health_5_3_d <- health_df %>%
   select(matches("health_5_3_\\d+_\\d+"))


prefixes_health_5_3 <- c(paste0("health_5_3_", 1:14, "_"), "health_5_3_99_")
#prefixes_health_5_3 <- c("health_5_3_2_","health_5_3_99_")

# Print combined summary
print(binary_summary(health_5_3_d, prefixes_health_5_3))

#head(prefixes_health_5_3, 30)


```

####health_5_11 - ONE INDEX

```{r}

health_5_11_d <- health_df %>%
   select(-matches("health_5_11_o_"))


prefixes_health_5_11 <- c("health_5_11_")

print(categ_summary(health_5_11_d, prefixes_health_5_11))




```




### Numerical
#### health_5_4

```{r}


prefixes_health_5_4 <- c("health_5_4")

print(numerical_summary(health_df, prefixes_health_5_4))



```

####health_5_12

```{r}

health_df <- health_df %>%
  mutate(across(starts_with("health_5_12_"), ~ ifelse(. == -1, -9, .)))


prefixes_health_5_12 <- c("health_5_12_")

print(numerical_summary(health_df, prefixes_health_5_12))



```


###Almost binary
#### health_5_2_ - health_5_14_c

```{r}

prefixes_abin_health <- c("health_5_2_", "health_5_5_","health_5_6_","health_5_7_","health_5_8_", "health_5_9_", "health_5_10_", "health_5_13", "health_5_14_a", "health_5_14_b", "health_5_14_c")

# Summarize all sets of variables
print(almost_binary_summary(health_df, prefixes_abin_health))

```


## Agriculture
###Categorical 
####list_actifs

```{r}


list_actifs_d <- agriculture_df %>%
   select(matches("list_actifs_\\d+"))


prefixes_list_actifs <- c(paste0("list_actifs_", 1:16))


# Print combined summary
print(binary_summary_l(list_actifs_d, prefixes_list_actifs))

```


####list_agri_equip

```{r}


list_agri_equip_d <- agriculture_df %>%
   select(matches("list_agri_equip_\\d+"))


prefixes_list_agri_equip <- c(paste0("list_agri_equip_", 1:14))


# Print combined summary
print(binary_summary_l(list_agri_equip_d, prefixes_list_agri_equip))

```



####agri_6_12

```{r}

agri_6_12_d <- agriculture_df %>%
   select(matches("agri_6_12_\\d+"))


prefixes_agri_6_12 <- c(paste0("agri_6_12_", 1:7), "agri_6_12_99")


# Print combined summary
print(binary_summary_l(agri_6_12_d, prefixes_agri_6_12))

head(prefixes_agri_6_12)



```









####agri_6_5

```{r}


prefixes_agri_6_5 <- c("agri_6_5")

# Print combined summary
print(categ_summary_l(agriculture_df, prefixes_agri_6_5))


```

####agri_6_7

```{r}


prefixes_agri_6_7 <- c("agri_6_7")

# Print combined summary
print(categ_summary_l(agriculture_df, prefixes_agri_6_7))


```


####agri_6_8

```{r}


prefixes_agri_6_8 <- c("agri_6_8")

# Print combined summary
print(categ_summary_l(agriculture_df, prefixes_agri_6_8))


```

####agri_6_9

```{r}


prefixes_agri_6_9 <- c("agri_6_9")

# Print combined summary
print(categ_summary_l(agriculture_df, prefixes_agri_6_9))


```

####agri_6_10

```{r}


prefixes_agri_6_10 <- c("agri_6_10")

# Print combined summary
print(categ_summary_l(agriculture_df, prefixes_agri_6_10))


```


####agri_6_11

```{r}


prefixes_agri_6_11 <- c("agri_6_11")

# Print combined summary
print(categ_summary_l(agriculture_df, prefixes_agri_6_11))


```



####agri_6_18

```{r}


prefixes_agri_6_18 <- c("agri_6_18")

# Print combined summary
print(categ_summary_l(agriculture_df, prefixes_agri_6_18))


```

####agri_6_20

```{r}


agri_6_20_d <- agriculture_df %>%
   select(matches("agri_6_20_\\d+"))

prefixes_agri_6_20 <- c("agri_6_20_")
#"agri_6_20_99" not present

# Print combined summary
print(categ_summary(agri_6_20_d, prefixes_agri_6_20))

head(agri_6_20_d)

```


####agri_6_20

```{r}


agri_6_23_d <- agriculture_df %>%
   select(matches("agri_6_23_\\d+"))

prefixes_agri_6_23 <- c("agri_6_23_")
#"agri_6_20_99" not present

# Print combined summary
print(categ_summary(agri_6_23_d, prefixes_agri_6_23))

head(agri_6_23_d)

```

####agri_6_25

```{r}


agri_6_25_d <- agriculture_df %>%
   select(matches("agri_6_25_\\d+"))

prefixes_agri_6_25 <- c("agri_6_25_")
#"agri_6_20_99" not present

# Print combined summary
print(categ_summary(agri_6_25_d, prefixes_agri_6_25))

head(agri_6_25_d)

```

####agri_6_26

```{r}


# health_5_3_d <- health_df %>%
#    select(matches("health_5_3_\\d+_\\d+"))
# 
# 
# prefixes_health_5_3 <- c(paste0("health_5_3_", 1:14, "_"), "health_5_3_99_")



agri_6_26_d <- agriculture_df %>%
   select(matches("agri_6_26_\\d+"))

prefixes_agri_6_26 <- c("agri_6_26_")
#"agri_6_20_99" not present

# Print combined summary
print(categ_summary_l(agri_6_26_d, prefixes_agri_6_26))




```

####agri_6_29

```{r}


# health_5_3_d <- health_df %>%
#    select(matches("health_5_3_\\d+_\\d+"))
# 
# 
# prefixes_health_5_3 <- c(paste0("health_5_3_", 1:14, "_"), "health_5_3_99_")



agri_6_29_d <- agriculture_df %>%
   select(matches("agri_6_29_\\d+"))

prefixes_agri_6_29 <- c("agri_6_29_")
#"agri_6_20_99" not present

# Print combined summary
print(categ_summary_l(agri_6_29_d, prefixes_agri_6_29))




```
####agri_6_31

```{r}


prefixes_agri_6_31 <- c("agri_6_31")

# Print combined summary
print(categ_summary_l(agriculture_df, prefixes_agri_6_31))


```


####agri_6_33

```{r}

agri_6_33_d <- agriculture_df %>%
   select(matches("agri_6_33_\\d+"))

prefixes_agri_6_33 <- c("agri_6_33_")

# Print combined summary
print(categ_summary(agri_6_33_d, prefixes_agri_6_33))

head(agri_6_33_d)
```






###Numerical 
####actifs_o_int - agri_6_21
```{r}

prefixes_num_ag <- c("actifs_o_int", "list_agri_equip_int", "agri_6_6", "agri_6_15", "_agri_number", "agri_6_21")

# Print combined summary
print(numerical_summary_l(agriculture_df, prefixes_num_ag))

```

####agri_6_32
```{r}

prefixes_agri_6_32 <- c("agri_6_32_")

# Print combined summary
print(numerical_summary(agriculture_df, prefixes_agri_6_32))



```

###Almost binary
#### list_actifs_o - agri_6_34_comp
```{r}
prefixes_al_bin_ag <- c("list_actifs_o", "list_agri_equip_o", "agri_6_14", "agri_6_28", "agri_6_30", "agri_6_34_comp")


# Print combined summary
print(almost_binary_summary_l(agriculture_df, prefixes_al_bin_ag))


```


##Production

###Categorical 

```{r}










```

###Binary



###Numerical
####cereals
```{r}


production_df <- production_df %>%
  mutate(cereals_03_1 = ifelse(cereals_03_1 == -99, -9, cereals_03_1))


prefixes_cereals <- c(paste0("cereals_", sprintf("%02d", 1:5), "_", 1:1), 
                      paste0("cereals_", sprintf("%02d", 1:5), "_", 2:2), 
                      paste0("cereals_", sprintf("%02d", 1:5), "_", 3:3), 
                      paste0("cereals_", sprintf("%02d", 1:5), "_", 4:4), 
                      paste0("cereals_", sprintf("%02d", 1:5), "_", 5:5))

print(numerical_summary_l(production_df, prefixes_cereals))




```

####farines (-9 CHANGE)
```{r}

production_df <- production_df %>%
  mutate(farines_02_2 = ifelse(farines_02_2 == -90, -9, farines_02_2))


prefixes_farines <- c(paste0("farines_", sprintf("%02d", 1:5), "_", 1:1), 
                      paste0("farines_", sprintf("%02d", 1:5), "_", 2:2), 
                      paste0("farines_", sprintf("%02d", 1:5), "_", 3:3), 
                      paste0("farines_", sprintf("%02d", 1:5), "_", 4:4), 
                      paste0("farines_", sprintf("%02d", 1:5), "_", 5:5),
                      paste0("farines_", sprintf("%02d", 1:5), "_", 6:6))

print(numerical_summary_l(production_df, prefixes_farines))




```


#### legumes

```{r}



prefixes_legumes <- c(paste0("legumes_", sprintf("%02d", 1:5), "_", 1:1), 
                      paste0("legumes_", sprintf("%02d", 1:5), "_", 2:2), 
                      paste0("legumes_", sprintf("%02d", 1:5), "_", 3:3), 
                      paste0("legumes_", sprintf("%02d", 1:5), "_", 4:4), 
                      paste0("legumes_", sprintf("%02d", 1:5), "_", 5:5),
                      paste0("legumes_", sprintf("%02d", 1:5), "_", 6:6))

print(numerical_summary_l(production_df, prefixes_legumes))




```


#### legumineuses

```{r}



prefixes_legumineuses <- c(paste0("legumineuses_", sprintf("%02d", 1:5), "_", 1:1), 
                      paste0("legumineuses_", sprintf("%02d", 1:5), "_", 2:2), 
                      paste0("legumineuses_", sprintf("%02d", 1:5), "_", 3:3), 
                      paste0("legumineuses_", sprintf("%02d", 1:5), "_", 4:4), 
                      paste0("legumineuses_", sprintf("%02d", 1:5), "_", 5:5))

print(numerical_summary_l(production_df, prefixes_legumineuses))




```

#### aquatique 

```{r}



prefixes_aquatique <- c(paste0("aquatique_", sprintf("%02d", 1:5), "_", 1:1))
  

print(numerical_summary_l(production_df, prefixes_aquatique))




```

#### culture (-9 CHANGE)

```{r}

production_df <- production_df %>%
  mutate(o_culture_03 = ifelse(o_culture_03 == -99, -9, o_culture_03))

prefixes_culture <- c(paste0("o_culture_", sprintf("%02d", 1:5)))
  

print(numerical_summary_l(production_df, prefixes_culture))




```











###Almost Binary
####cereals

```{r}



prefixes_cereals_consum <- c(paste0("cereals_consumption_", 1:6))


print(almost_binary_summary_l(production_df, prefixes_cereals_consum))



```

####farines
```{r}

prefixes_farines_consum <- c(paste0("farine_tubercules_consumption_", 1:6))


print(almost_binary_summary_l(production_df, prefixes_farines_consum))



```
####legumes


```{r}

prefixes_legumes_consum <- c(paste0("legumes_consumption_", 1:6))


print(almost_binary_summary_l(production_df, prefixes_legumes_consum))



```

####legumineuses


```{r}

prefixes_legumes_consum <- c(paste0("legumineuses_consumption_", 1:5))


print(almost_binary_summary_l(production_df, prefixes_legumes_consum))



```

####aquatique


```{r}

prefixes_aquatique_consum <- c("aquatique_consumption_1")


print(almost_binary_summary_l(production_df, prefixes_aquatique_consum))



```

####culture 

```{r}

prefixes_culture_consum <- c("autre_culture_yesno")


print(almost_binary_summary_l(production_df, prefixes_culture_consum))



```



##Income 
###Categorical 

#####product_miscellaneous

```{r}

prefixes_product_divers <- c(paste0("product_divers_", 1:14), "product_divers_99")

print(binary_summary_l(income_df, prefixes_product_divers))

```


####  agri_income_46_

```{r}

agri_income_46_d <- income_df %>%
  select(matches("agri_income_46_\\d+_\\d+"))


prefixes_agri_income_46 <- c(paste0("agri_income_46_",  1:4, "_", 1:1), 
                      paste0("agri_income_46_", 1:4, "_", 2:2),
                      paste0("agri_income_46_", 1:4, "_", 3:3),
                      paste0("agri_income_46_", 1:4, "_", 4:4),
                      paste0("agri_income_46_", 1:4, "_", 5:5),
                      paste0("agri_income_46_", 1:4, "_", 6:6),
                      paste0("agri_income_46_", 1:4, "_", 7:7),
                      paste0("agri_income_46_", 1:4, "_", 8:8),
                      paste0("agri_income_46_", 1:4, "_", 9:9),
                      paste0("agri_income_46_", 1:4, "_", 10:10),
                      paste0("agri_income_46_", 1:4, "_", 11:11),
                      paste0("agri_income_46_", 1:4, "_", 12:12))

print(binary_summary_l(agri_income_46_d, prefixes_agri_income_46))



```

####expenses_goods

```{r}

prefixes_expenses_goods <- c(paste0("expenses_goods_", 1:2), "expenses_goods_9")

print(binary_summary_l(income_df, prefixes_expenses_goods))

```


####agri_income_31

```{r}

prefixes_agri_income_31 <- c(paste0("agri_income_31_", 1:6))

print(binary_summary_l(income_df, prefixes_agri_income_31))

```


####agri_income_35

```{r}



prefixes_income_35 <- c("agri_income_35")
                          
print(categ_summary_l(income_df, prefixes_income_35))
 
```

####agri_income_47 - 48

```{r}

income_df <- income_df %>%
  mutate(agri_income_47_1 = ifelse(agri_income_47_1 == -40000, 40000, agri_income_47_1))

prefixes_agri_income <- c(paste0("agri_income_47_", 1:2),
                          paste0("agri_income_48_", 1:2),
                          "agri_income_47_o",
                          "agri_income_48_o")
                          
print(numerical_summary_l(income_df, prefixes_agri_income))
 
```


```{r}



prefixes_agri_income_09_o_o <- c("agri_income_09_o_o")
                          
print(categ_summary_l(income_df, prefixes_agri_income_09_o_o))
 
```


```{r}



prefixes_agri_income_09_o_o <- c("agri_income_09_o_o")
                          
print(categ_summary_l(income_df, prefixes_agri_income_09_o_o))
 
```



```{r}



prefixes_agri_income_09_o_o <- c("agri_income_09_o_o")
                          
print(categ_summary_l(income_df, prefixes_agri_income_09_o_o))
 
```



```{r}



prefixes_agri_income_09_o_o <- c("agri_income_09_o_o")
                          
print(categ_summary_l(income_df, prefixes_agri_income_09_o_o))
 
```



####agri_income_09_o_o

```{r}



prefixes_agri_income_09_o_o <- c("agri_income_09_o_o")
                          
print(categ_summary_l(income_df, prefixes_agri_income_09_o_o))
 
```






###Numerical 
####(-9 CHANGE) agri_income_36 - agri_income_45 

```{r}

income_df <- income_df %>%
  mutate(agri_income_38_1 = ifelse(agri_income_38_1 == -99, -9, agri_income_38_1)) %>%
  mutate(agri_income_39_1 = ifelse(agri_income_39_1 == -99, -9, agri_income_39_1))

prefixes_income_num <- c("agri_income_36", "agri_income_38", "agri_income_39", "agri_income_41", "agri_income_42", "agri_income_43", "agri_income_44", "agri_income_45")

print(numerical_summary(income_df, prefixes_income_num))







```

#### agri_income_07   


```{r}
#Switch data from wide to long 

agri_income_07_df <- income_df %>%
  select(hhid, starts_with("agri_income_07"), starts_with("speciesname_"), starts_with("speciesindex_")) %>%
  pivot_longer(
    cols = c(starts_with("agri_income_07_"), starts_with("speciesindex_")), 
    names_to = c(".value", "var"),   # Creates two new columns, one for variable name and one for time point
    names_pattern = "(agri_income_07|speciesindex)_(\\d+)"  # Regex pattern to match and split column names
  )

# Filter accordinly and create the respective variables 
agri_income_07_df_l <- agri_income_07_df %>%
  mutate(agri_income_07_01 = ifelse(speciesindex == 1, agri_income_07, NA))  %>%
  mutate(agri_income_07_02 = ifelse(speciesindex == 2, agri_income_07, NA))  %>%
  mutate(agri_income_07_03 = ifelse(speciesindex == 3, agri_income_07, NA))  %>%
  mutate(agri_income_07_04 = ifelse(speciesindex == 4, agri_income_07, NA))  %>%
  mutate(agri_income_07_05 = ifelse(speciesindex == 5, agri_income_07, NA))  %>%
  mutate(agri_income_07_06 = ifelse(speciesindex == 6, agri_income_07, NA))  %>%
  mutate(agri_income_07_07 = ifelse(speciesindex == 7, agri_income_07, NA))  %>%
  mutate(agri_income_07_08 = ifelse(speciesindex == 8, agri_income_07, NA))  %>%
  mutate(agri_income_07_09 = ifelse(speciesindex == 9, agri_income_07, NA))  %>%
  select(starts_with("agri_income_")) 
  

prefixes_agri_income_07 <- paste0("agri_income_07_", sprintf("%02d", 1:9))

print(numerical_summary_l(agri_income_07_df_l, prefixes_agri_income_07))

```

#### agri_income_08   

```{r}
#Switch data from wide to long 

agri_income_08_df <- income_df %>%
  select(hhid, starts_with("agri_income_08"), starts_with("speciesname_"), starts_with("speciesindex_")) %>%
    pivot_longer(
    cols = c(starts_with("agri_income_08_"), starts_with("speciesindex_")), 
    names_to = c(".value", "var"),   # Creates two new columns, one for variable name and one for time point
    names_pattern = "(agri_income_08|speciesindex)_(\\d+)"  # Regex pattern to match and split column names
  )


#View(agri_income_08_df)

# Filter accordinly and create the respective variables 
agri_income_08_df_l <- agri_income_08_df %>%
  mutate(agri_income_08_01 = ifelse(speciesindex == 1, agri_income_08, NA))  %>%
  mutate(agri_income_08_02 = ifelse(speciesindex == 2, agri_income_08, NA))  %>%
  mutate(agri_income_08_03 = ifelse(speciesindex == 3, agri_income_08, NA))  %>%
  mutate(agri_income_08_04 = ifelse(speciesindex == 4, agri_income_08, NA))  %>%
  mutate(agri_income_08_05 = ifelse(speciesindex == 5, agri_income_08, NA))  %>%
  mutate(agri_income_08_06 = ifelse(speciesindex == 6, agri_income_08, NA))  %>%
  mutate(agri_income_08_07 = ifelse(speciesindex == 7, agri_income_08, NA))  %>%
  mutate(agri_income_08_08 = ifelse(speciesindex == 8, agri_income_08, NA))  %>%
  mutate(agri_income_08_09 = ifelse(speciesindex == 9, agri_income_08, NA))  %>%
  select(starts_with("agri_income_")) 
  

prefixes_agri_income_08 <- paste0("agri_income_08_", sprintf("%02d", 1:9))

print(numerical_summary_l(agri_income_08_df_l, prefixes_agri_income_08))

# View(speciesindex_value)
# 
 #View(speciesindex_value)
```


#### agri_income_09   

```{r}
#Switch data from wide to long 

agri_income_09_df <- income_df %>%
  select(hhid, starts_with("agri_income_09"), starts_with("speciesname_"), starts_with("speciesindex_")) %>%
    pivot_longer(
    cols = c(starts_with("agri_income_09_"), starts_with("speciesindex_")), 
    names_to = c(".value", "var"),   # Creates two new columns, one for variable name and one for time point
    names_pattern = "(agri_income_09|speciesindex)_(\\d+)"  # Regex pattern to match and split column names
  )


View(agri_income_09_df)

# Filter accordinly and create the respective variables 
agri_income_09_df_l <- agri_income_09_df %>%
  mutate(agri_income_09_01 = ifelse(speciesindex == 1, agri_income_09, NA))  %>%
  mutate(agri_income_09_02 = ifelse(speciesindex == 2, agri_income_09, NA))  %>%
  mutate(agri_income_09_03 = ifelse(speciesindex == 3, agri_income_09, NA))  %>%
  mutate(agri_income_09_04 = ifelse(speciesindex == 4, agri_income_09, NA))  %>%
  mutate(agri_income_09_05 = ifelse(speciesindex == 5, agri_income_09, NA))  %>%
  mutate(agri_income_09_06 = ifelse(speciesindex == 6, agri_income_09, NA))  %>%
  mutate(agri_income_09_07 = ifelse(speciesindex == 7, agri_income_09, NA))  %>%
  mutate(agri_income_09_08 = ifelse(speciesindex == 8, agri_income_09, NA))  %>%
  mutate(agri_income_09_09 = ifelse(speciesindex == 9, agri_income_09, NA))  %>%
  select(starts_with("agri_income_")) 
  
head(agri_income_09_df_l)
#prefixes_agri_income_09 <- paste0("agri_income_09_", sprintf("%02d", 1:9))
prefixes_agri_income_09 <- c("agri_income_09_01", "agri_income_09_02","agri_income_09_03", "agri_income_09_04", "agri_income_09_05", "agri_income_09_08")
print(categ_summary_l(agri_income_09_df_l, prefixes_agri_income_09))

# prefixes_agri_income_09_6 <- c("agri_income_09_09")
# print(categ_summary_l(agri_income_09_df_l, prefixes_agri_income_09_9))

# view(agri_income_09_df_l$agri_income_09_03)

```


#### agri_income_10   

```{r}
#Switch data from wide to long 

agri_income_10_df <- income_df %>%
  select(hhid, starts_with("agri_income_10"), starts_with("speciesname_"), starts_with("speciesindex_")) %>%
    pivot_longer(
    cols = c(starts_with("agri_income_10_"), starts_with("speciesindex_")), 
    names_to = c(".value", "var"),   # Creates two new columns, one for variable name and one for time point
    names_pattern = "(agri_income_10|speciesindex)_(\\d+)"  # Regex pattern to match and split column names
  )


#View(agri_income_10_df)

# Filter accordinly and create the respective variables 
agri_income_10_df_l <- agri_income_10_df %>%
  mutate(agri_income_10_01 = ifelse(speciesindex == 1, agri_income_10, NA))  %>%
  mutate(agri_income_10_02 = ifelse(speciesindex == 2, agri_income_10, NA))  %>%
  mutate(agri_income_10_03 = ifelse(speciesindex == 3, agri_income_10, NA))  %>%
  mutate(agri_income_10_04 = ifelse(speciesindex == 4, agri_income_10, NA))  %>%
  mutate(agri_income_10_05 = ifelse(speciesindex == 5, agri_income_10, NA))  %>%
  mutate(agri_income_10_06 = ifelse(speciesindex == 6, agri_income_10, NA))  %>%
  mutate(agri_income_10_07 = ifelse(speciesindex == 7, agri_income_10, NA))  %>%
  mutate(agri_income_10_08 = ifelse(speciesindex == 8, agri_income_10, NA))  %>%
  mutate(agri_income_10_09 = ifelse(speciesindex == 9, agri_income_10, NA))  %>%
  select(starts_with("agri_income_")) 
  

prefixes_agri_income_10 <- paste0("agri_income_10_", sprintf("%02d", 1:9))

print(numerical_summary_l(agri_income_10_df_l, prefixes_agri_income_10))

# View(speciesindex_value)
# 
 #View(speciesindex_value)
```



#### agri_income_11   

```{r}
#Switch data from wide to long 

agri_income_11_df <- income_df %>%
  select(hhid, starts_with("agri_income_11"), starts_with("speciesname_"), starts_with("animals_sales_")) %>%
  pivot_longer(
    cols = starts_with("agri_income_11_"), 
    names_to = "agri_income_11_type",   # This will hold the different types (e.g., agri_income_11_x)
    names_pattern = "agri_income_11_(.*)",  # Captures anything after 'agri_income_11_' and stores it in agri_income_11_type
    values_to = "value"
  )

View(agri_income_11_df)

# Filter accordinly and create the respective variables 
agri_income_11_df_l <- agri_income_11_df %>%
  mutate(agri_income_11_01 = ifelse(animals_sales_1 == 1, value, NA))  %>%
  mutate(agri_income_11_02 = ifelse(animals_sales_2 == 1, value, NA))  %>%
  mutate(agri_income_11_03 = ifelse(animals_sales_3 == 1, value, NA))  %>%
  mutate(agri_income_11_04 = ifelse(animals_sales_4 == 1, value, NA))  %>%
  mutate(agri_income_11_05 = ifelse(animals_sales_5 == 1, value, NA))  %>%
  mutate(agri_income_11_06 = ifelse(animals_sales_6 == 1, value, NA))  %>%
  mutate(agri_income_11_07 = ifelse(animals_sales_7 == 1, value, NA))  %>%
  mutate(agri_income_11_08 = ifelse(animals_sales_8 == 1, value, NA))  %>%
  mutate(agri_income_11_09 = ifelse(animals_sales_9 == 1, value, NA))  %>%
  select(starts_with("agri_income_")) 
  

prefixes_agri_income_11 <- paste0("agri_income_11_", sprintf("%02d", 1:9))

print(numerical_summary_l(agri_income_11_df_l, prefixes_agri_income_11))

# View(speciesindex_value)
# 
 #View(speciesindex_value)
```

#### agri_income_12   

```{r}
#Switch data from wide to long 

agri_income_12_df <- income_df %>%
  select(hhid, starts_with("agri_income_12"), starts_with("speciesname_"), starts_with("animals_sales_")) %>%
  pivot_longer(
    cols = starts_with("agri_income_12_"), 
    names_to = "agri_income_12_type",   # This will hold the different types (e.g., agri_income_12_x)
    names_pattern = "agri_income_12_(.*)",  # Captures anything after 'agri_income_12_' and stores it in agri_income_12_type
    values_to = "value"
  )

View(agri_income_12_df)

# Filter accordinly and create the respective variables 
agri_income_12_df_l <- agri_income_12_df %>%
  mutate(agri_income_12_01 = ifelse(animals_sales_1 == 1, value, NA))  %>%
  mutate(agri_income_12_02 = ifelse(animals_sales_2 == 1, value, NA))  %>%
  mutate(agri_income_12_03 = ifelse(animals_sales_3 == 1, value, NA))  %>%
  mutate(agri_income_12_04 = ifelse(animals_sales_4 == 1, value, NA))  %>%
  mutate(agri_income_12_05 = ifelse(animals_sales_5 == 1, value, NA))  %>%
  mutate(agri_income_12_06 = ifelse(animals_sales_6 == 1, value, NA))  %>%
  mutate(agri_income_12_07 = ifelse(animals_sales_7 == 1, value, NA))  %>%
  mutate(agri_income_12_08 = ifelse(animals_sales_8 == 1, value, NA))  %>%
  mutate(agri_income_12_09 = ifelse(animals_sales_9 == 1, value, NA))  %>%
  select(starts_with("agri_income_")) 
  

prefixes_agri_income_12 <- paste0("agri_income_12_", sprintf("%02d", 1:9))

print(numerical_summary_l(agri_income_12_df_l, prefixes_agri_income_12))

# View(speciesindex_value)
# 
 #View(speciesindex_value)
```


#### agri_income_13


```{r}
agri_income_13_df <- income_df %>%
  select(hhid, matches("^agri_income_13_\\d+_\\d+"), starts_with("speciesname_"), starts_with("animals_sales_")) %>%
  #head(agri_income_13_df)
  
  # Apply mutate only to columns starting with "agri_income_13"
    mutate(across(starts_with("agri_income_13"), 
              ~ ifelse(. == 1, 
                       as.numeric(sub(".*_(\\d+)_\\d+$", "\\1", cur_column())), 
                       ifelse(. == 0, NA, .)))) %>%
  
  # Pivot longer for the agri_income_13 columns
  pivot_longer(
    cols = starts_with("agri_income_13_"), 
    names_to = "agri_income_13_type",   # This will hold the different types (e.g., agri_income_13_x)
    names_pattern = "agri_income_13_(.*)",  # Captures anything after 'agri_income_13_' and stores it in agri_income_13_type
    values_to = "value"
  )

#view(agri_income_13_df)

agri_income_13_df_l <- agri_income_13_df %>%
  mutate(agri_income_13_01 = ifelse(animals_sales_1 == 1, value, NA))  %>%
  mutate(agri_income_13_02 = ifelse(animals_sales_2 == 1, value, NA))  %>%
  mutate(agri_income_13_03 = ifelse(animals_sales_3 == 1, value, NA))  %>%
  mutate(agri_income_13_04 = ifelse(animals_sales_4 == 1, value, NA))  %>%
  mutate(agri_income_13_05 = ifelse(animals_sales_5 == 1, value, NA))  %>%
  mutate(agri_income_13_06 = ifelse(animals_sales_6 == 1, value, NA))  %>%
  mutate(agri_income_13_07 = ifelse(animals_sales_7 == 1, value, NA))  %>%
  mutate(agri_income_13_08 = ifelse(animals_sales_8 == 1, value, NA))  %>%
  mutate(agri_income_13_09 = ifelse(animals_sales_9 == 1, value, NA))  %>%
  select(starts_with("agri_income_")) 
  #view(agri_income_13_df_l)

prefixes_agri_income_13 <- paste0("agri_income_13_", sprintf("%02d", 1:5))

#prefixes_agri_income_13 <- c("agri_income_13_07")


print(categ_summary_l(agri_income_13_df_l, prefixes_agri_income_13))


# Generate the prefixes
prefixes_agri_income_13_2 <- c(paste0("agri_income_13_", sprintf("%02d", c(5:6, 8:8)), "agri_income_13_o"))

# Print the result using the 'categ_summary_l' function
print(categ_summary_l(agri_income_13_df_l, prefixes_agri_income_13_2))

```


#### agri_income_13_o 
```{r}

# Select only columns starting with "agri_income_13_o" along with hhid, speciesname, and animals_sales
agri_income_13_df_o <- income_df %>%
  select(hhid, matches("^agri_income_13_o_\\d+"), starts_with("speciesname_"), starts_with("animals_sales_")) %>%
  
  # Replace 1 and 0 in the agri_income_13_o columns based on the second index
  mutate(across(starts_with("agri_income_13_o"), 
                ~ ifelse(. == 1, 
                         as.numeric(sub(".*_(\\d+)$", "\\1", cur_column())),  # Replace 1 with second index from column name
                         ifelse(. == 0, NA, .)))) %>%
 
  # Pivot the agri_income_13_o columns into a long format
  pivot_longer(
    cols = starts_with("agri_income_13_o_"), 
    names_to = "agri_income_13_o_type",   # Capture variable type (e.g., agri_income_13_o_1, etc.)
    values_to = "value"
  )

View(agri_income_13_df_o)

# S Create the final variable 
agri_income_13_df_l_o <- agri_income_13_df_o %>%
  mutate(final_agri_income_13_o = ifelse(animals_sales_o == 1, value, NA)) 

prefixes_agri_income_13_o <- c("agri_income_13_o")

# Print the result using the 'categ_summary_l' function
print(categ_summary_l(agri_income_13_df_l_o, prefixes_agri_income_13_o))



```



















#### agri_income_14   

```{r}
#Switch data from wide to long 

agri_income_14_df <- income_df %>%
  select(hhid, starts_with("agri_income_14"), starts_with("speciesname_"), starts_with("animals_sales_")) %>%
  pivot_longer(
    cols = starts_with("agri_income_14_"), 
    names_to = "agri_income_14_type",   # This will hold the different types (e.g., agri_income_14_x)
    names_pattern = "agri_income_14_(.*)",  # Captures anything after 'agri_income_14_' and stores it in agri_income_14_type
    values_to = "value"
  )

#View(agri_income_14_df)

# Filter accordinly and create the respective variables 
agri_income_14_df_l <- agri_income_14_df %>%
  mutate(agri_income_14_01 = ifelse(animals_sales_1 == 1, value, NA))  %>%
  mutate(agri_income_14_02 = ifelse(animals_sales_2 == 1, value, NA))  %>%
  mutate(agri_income_14_03 = ifelse(animals_sales_3 == 1, value, NA))  %>%
  mutate(agri_income_14_04 = ifelse(animals_sales_4 == 1, value, NA))  %>%
  mutate(agri_income_14_05 = ifelse(animals_sales_5 == 1, value, NA))  %>%
  mutate(agri_income_14_06 = ifelse(animals_sales_6 == 1, value, NA))  %>%
  mutate(agri_income_14_07 = ifelse(animals_sales_7 == 1, value, NA))  %>%
  mutate(agri_income_14_08 = ifelse(animals_sales_8 == 1, value, NA))  %>%
  mutate(agri_income_14_09 = ifelse(animals_sales_9 == 1, value, NA))  %>%
    select(starts_with("agri_income_")) 
  

prefixes_agri_income_14 <- paste0("agri_income_14_", sprintf("%02d", 1:9))

print(numerical_summary_l(agri_income_14_df_l, prefixes_agri_income_14))

# View(speciesindex_value)
# 
 #View(speciesindex_value)
```

####agri_income_21_h - agri_income_23_o

```{r}
income_df <- income_df %>%
  mutate(agri_income_21_f_1 = ifelse(agri_income_21_f_1 == 720000.00, 0, agri_income_21_f_1))

prefixes_agri_income_21_h <- c("agri_income_21_h", "agri_income_21_f", "agri_income_22", "agri_income_23", "agri_income_24", "agri_income_21_h_o", "agri_income_21_f_o", "agri_income_22_o", "agri_income_23_o")

print(numerical_summary_l(income_df, prefixes_agri_income_21_h))



```


































### Almost binary 

```{r}

prefixes_abin_income <- c("expenses_goods_t", "agri_income_40", "species_autre")


print(almost_binary_summary_l(income_df, prefixes_abin_income))


```



## Community 

####Binary

```{r}

prefixes_community_bin <- c(paste0("q_", 16:34),"q_35_check", "q_37", "q_39", "q_41")


print(binary_summary_l(community_df, prefixes_community_bin))



```

###Numerical 

```{r}


prefixes_community_num <- c(
  "number_hh",                    
  "number_total",
  paste0("q_", 28:33, "a"),     
  paste0("q_", 43:55),
  paste0("q_", 57:58),
  paste0("q", 60:61),
  "q63",
  paste0("q63_", 1:10),
  paste0("q", 64:66)
  )                


print(numerical_summary_l(community_df, prefixes_community_num))

head(prefixes_community_num)

```

```{r}


prefixes_community_num <- c(
  "number_hh",                    
  "number_total",
  paste0("q_", 28:33, "a"),     
  paste0("q_", 43:55),
  paste0("q_", 57:58),
  paste0("q", 60:61),
  "q63",
  paste0("q63_", 1:10),
  paste0("q", 64:66)
  )                


print(numerical_summary_l(community_df, prefixes_community_num))

head(prefixes_community_num)

```







