---
title: "Parasitological_Logistic_Regression_Analysis"
output: html_document
date: "2024-11-18"
---

#BEGIN HERE - load packages

```{r}
#install.packages("ggmosaic")
#install.packages("vcd")
#install.packages("stargazer")
#install.packages("MASS")  
#install.packages("pscl")  
#install.packages("sandwich")
#install.packages("gt")

library(gt)
library(vcd)
library(ggmosaic)
library(officer)
library(r2rtf)
library(dplyr)
library(ggplot2)
library(kwb.utils)
library(haven)
library(data.table)
library(rtf)
library(tidyverse)
library(estimatr)
library(broom)
#library(MASS)       
library(stats)
library(stargazer)
library(pscl)
library(sandwich)

```

#Load file paths

```{r}
# Define the file paths
proj_paths <- list(
  projects = "C:/Users/Kateri/Box/NSF Senegal",
  alternative_projects = "C:/Users/km978/Box/NSF Senegal"
)

# Check if the Kateri path exists and resolve the project path accordingly
if (file.exists(proj_paths$projects)) {
  proj <- kwb.utils::resolve(list(
    projects = proj_paths$projects,
    p1 = "<projects>/Data Management/_PartnerData/Child infection dataframe/Dataframe"
  ))
} else {
  proj <- kwb.utils::resolve(list(
    projects = proj_paths$alternative_projects,
    p1 = "<projects>/Data Management/_PartnerData/Child infection dataframe/Dataframe"
  ))
}

file_path_infection_df <- file.path(proj$p1, "child_infection_dataframe_features.dta")
infection_df <- read_dta(file_path_infection_df)


```

## Filter df

```{r}

matched_only_df <- infection_df %>%
  filter(match_score != "")

```

#Create relevant variables

```{r}


# Calculate egg counts
matched_only_df <- matched_only_df %>%
  # 1) Calculate S. haematobium egg count
  mutate(
    sh_egg_count = if_else(fu_p1 > 0, fu_p1, fu_p2),  # max of fu_p1 and fu_p2, only use fu_p2 if fu_p1 is zero

    #  2) Calculate S. mansoni egg count
    # Calculate average of each pass
    p1_avg = (p1_kato1_k1_pg + p1_kato2_k2_peg) / 2,
    p2_avg = (p2_kato1_k1_epg + p2_kato2_k2_epg) / 2,

    # Only calculate p2_avg if p1_avg is zero, then take the maximum of p1_avg and p2_avg
    sm_egg_count = if_else(p1_avg > 0, p1_avg, p2_avg)
  )# %>%

#Change variables to factors 

# matched_only_df <- matched_only_df %>%
#   mutate(
#     health_5_3_2_ = as.factor(health_5_3_2_), 
#     health_5_5_ = as.factor(health_5_5_),
#     health_5_6_ = as.factor(health_5_6_),
#     health_5_8_ = as.factor(health_5_8_),
#     health_5_9_ = as.factor(health_5_9_),
#     health_5_10_ = as.factor(health_5_10_)
# )

```

#Cleaning 

```{r}

matched_only_df <- matched_only_df %>%
  mutate(
    hh_31_ = ifelse(is.na(hh_31_), 0, hh_31_),
    hh_33_ = ifelse(is.na(hh_33_), 0, hh_33_),
    health_5_4_ = ifelse(is.na(health_5_4_), 0, health_5_4_),
    health_5_3_2_ = ifelse(is.na(health_5_3_2_), 0, health_5_3_2_)
  )

#Create total egg count: 
matched_only_df <- matched_only_df %>%
  mutate(
total_egg = sm_egg_count + sh_egg_count
)

```


#EDA

```{r}
str(matched_only_df$sm_egg_count)
table(matched_only_df$sm_egg_count)
summary(matched_only_df$sm_egg_count)
```

###categorical 
```{r}
# var_names <- c("health_5_3_2_", "health_5_4_", "health_5_5_", "health_5_6_", "health_5_8_", "health_5_9_", "hh_gender_", "hh_ethnicity_", "hh_12_1_", "hh_12_2_", "hh_12_3_",  "hh_12_4_", "hh_12_5_", "hh_12_6_", "hh_12_7_", "hh_12_8_", "hh_31_", "hh_33_", "hh_37_", "living_01", "living_02", "living_04", "wealthindex")
# 
# matched_only_df_summary <- matched_only_df %>%
#    dplyr::select(all_of(var_names))
#Categorical function

# Function to calculate summary statistics for a single categorical vector
categ_func_l <- function(value_l) {
  # N = Total number of non-empty, non-NA observations (including -9s but excluding true NAs/empty cells)
  N <- sum(!is.na(value_l) & value_l != "")
  
  # Remove NAs and invalid values (-9 in this example)
  valid_value_l <- value_l[!is.na(value_l) & value_l != -9]
  
  # Calculate frequency and proportion for valid responses
  freq_table_l <- table(valid_value_l)
  proportions_l <- round(freq_table_l / length(valid_value_l), 2)
  
  # Calculate the proportion of -9s and NAs
  prop_na_l <- round(sum(value_l == -9, na.rm = TRUE) / N, 2)
  
  # Create a data frame with the summary
  categorical_data_l <- data.frame(
    Value = names(freq_table_l),
    N = N,  # Total number of observations
    Frequency = as.vector(freq_table_l),  # Frequency of valid responses
    Proportion = as.vector(proportions_l),  # Proportion of valid responses
    prop_na = prop_na_l  # Proportion of -9s/NAs
  )
  
  return(categorical_data_l)
}

# Function to summarize multiple categorical variables by prefix
categ_summary_l <- function(data_l, prefixes_l) {
  summaries_l <- lapply(prefixes_l, function(prefix_l) {
    variable_data_l <- data_l %>%
      select(starts_with(prefix_l))
    
    # Pull the 'value' column and pass to categ_func_l
    value_l <- variable_data_l[[1]]
    summary_categ_l <- categ_func_l(value_l)
    summary_categ_l$Variable_l <- prefix_l  # Assign the prefix as the variable name
    return(summary_categ_l)
  })
  
  categ_sum_set_l <- bind_rows(summaries_l)
  return(categ_sum_set_l)
}


```



```{r}
# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/NSF-Senegal/Latex"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/NSF-Senegal/Latex"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}


prefixes_categ <- c("hh_31_", "hh_33_", "living_01", "living_02", "living_03", "living_04")


output_categ <- as.data.frame(categ_summary_l(matched_only_df, prefixes_categ))
rownames(output_categ) <- NULL


output_categ_gt <- gt(output_categ)

output_categ_gt <- output_categ_gt %>%
  tab_header(
    title = "Categorical Stats"
  )


gtsave(output_categ_gt, "output_categ_clean_table.tex")
```


###binary

```{r}
# Function to calculate summary statistics for a single vector (variable)
binary_func_l <- function(value) {

  # Calculate summary statistics for 0s and 1s
  binary_stats_l <- data.frame(
    N = round(sum(!is.na(value)), 2),
    mean = round(mean(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    sd = round(sd(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    prop_na = round(sum(value == -9, na.rm = TRUE) / sum(!is.na(value)), 2)
  )
  
  return(binary_stats_l)
}

binary_summary_l <- function(baseline_data, prefixes) {
  # Loop over each prefix
  summaries_binary_l <- lapply(prefixes, function(prefix) {
    # Select the column that matches the prefix
    selected_data <- baseline_data %>%
      select(starts_with(prefix))
    
    # Pull the column values and pass to binary_func_l
    value <- selected_data[[1]]
    summary_stats <- binary_func_l(value)
    
    # Add the prefix (variable name) to the summary
    summary_stats$variable <- prefix
    
    return(summary_stats)
  })
  
  binary_sum_set_l <- bind_rows(summaries_binary_l)
  return(binary_sum_set_l)
}

```



```{r}
# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/NSF-Senegal/Latex"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/NSF-Senegal/Latex"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}

prefixes_binary <- c("health_5_3_2_", "health_5_5_", "health_5_6_", "health_5_8_", "health_5_9_", "hh_gender_", "hh_12_1_", "hh_12_2_", "hh_12_3_", "hh_12_4_", "hh_12_5_", "hh_12_6_", "hh_12_7_",  "hh_12_8_")

# output_binary <- as.data.frame(categ_summary_l(matched_only_df, prefixes_binary))
# rownames(output_binary) <- NULL

output_binary <- binary_summary_l(matched_only_df, prefixes_binary)

# Use stargazer for the formatted output
# stargazer(output_binary,
#           type = "text",
#           style = "aer",
#            summary = FALSE,
#             rownames = NULL,
#           single.row = FALSE,
#           order = NULL,
#           out = "binary_var.tex")

output_binary_gt <- gt(output_binary)

output_binary_gt <- output_binary_gt %>%
  tab_header(
    title = "Binary Stats"
  )


gtsave(output_binary_gt, "output_binary_clean_table.tex")


```

###numerical 


```{r}

# Function to calculate summary statistics for a single numeric vector
numerical_summary_func_l <- function(value) {
  
  # Calculate summary statistics for numeric variables
  numerical_stats_l <- data.frame(
    N = round(sum(!is.na(value)), 2),
    min = round(min(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    mean = round(mean(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    #max = round(max(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    max = sprintf("%.2f", max(ifelse(value == -9, NA, value), na.rm = TRUE),2),
    sd = round(sd(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    prop_na = round(sum(value == -9, na.rm = TRUE) / sum(!is.na(value)), 2)
  )
  
  return(numerical_stats_l)
}

# Function to summarize multiple sets of numeric variables by prefix
numerical_summary_l <- function(baseline_data, prefixes) {
  # Loop over each prefix
  summaries_numerical_l <- lapply(prefixes, function(prefix) {
    # Select the column that matches the prefix
    numerical_data_l <- baseline_data %>%
      select(starts_with(prefix))
    
    # Pull the column values and pass to numerical_summary_func_l
    value <- numerical_data_l[[1]]
    numerical_summary_stats <- numerical_summary_func_l(value)
    
    # Add the prefix (variable name) to the summary
    numerical_summary_stats$variable <- prefix
    
    return(numerical_summary_stats)
  })
  
  # Combine the summaries into a single data frame
  numerical_sum_set_l <- bind_rows(summaries_numerical_l)
  return(numerical_sum_set_l)
}


```


```{r}
# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/NSF-Senegal/Latex"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/NSF-Senegal/Latex"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}

prefixes_numerical <- c("wealthindex", "health_5_4_", "hh_age_")

# output_binary <- as.data.frame(categ_summary_l(matched_only_df, prefixes_binary))
# rownames(output_binary) <- NULL
# 
output_numerical <- numerical_summary_l(matched_only_df, prefixes_numerical)
# 
# # Use stargazer for the formatted output
# stargazer(output_numerical,
#           type = "text",
#           style = "aer",
#            summary = FALSE,
#             rownames = NULL,
#           single.row = FALSE,
#           order = NULL,
#           out = "numerical_var.tex")

output_numerical_gt <- gt(output_numerical)

output_numerical_gt <- output_numerical_gt %>%
  tab_header(
    title = "Numerical Stats"
  )


gtsave(output_numerical_gt, "output_numerical_clean_table.tex")


```




```{r}
#MAYBE do this lol
###rename vars for clarity 

# matched_only_df <- matched_only_df %>%
#   rename(health_perception = health_5_3_2_,
#          health_sch = health_5_4_,
#          health_med = health_5_5_,
#          health_diag = health_5_6_,
#          
#                   )

```


#Variable notes:

-   health_5_3_2 = illness suffered? \_2 = chose Bilharzia
-   health_5_4 = how many days of school missed
-   health_5_5 = Has he/she received medication for schistosomiasis in the past 12 months?
-   health_5_6 = Ever diagnosed w/ schisto?
-   health_5_8 = blood in urine past 12 months?
-   health_5_9 = blood in stool past 12 months?
-   hh_11 = which water source
-   hh_12 = why person spent time near water source
-   hh_31_ = result acheived in academic year 
-   hh_33 = performace in class
-   hh_37 = had illness last 12 months
-   living_01 = source of drinking water
-   living_02 = is the water treated
-   living_03 = if so, how
-   living_04 = main type of toilet used
-   q_18 = 18.Educational facilities (e.g. school)
-   q_19 = Health facilities (e.g. health center)
-   q_23 = Running drinking water for drinking
-   q_24 = Tap water system (only if 23 = YES)
-   q_35_check = Was there any deworming treatment carried out by the Ministry of Health or another organization?
-   q_39 = In the village, are there currently any ongoing projects aimed at reducing the prevalence of bilharzia?
-   q_46 = How many minutes does it take to go to the nearest doctor by car/motorcycle?
-   q_49 = How far is the nearest water point (in kilometers)?
-   q_51 = How far is the nearest health infrastructure (in kilometers)?


health_5_3_2_ = What type of illness or injury did he/she suffer from? (answer choice is Bilharzia) Binary
health_5_4_ = How many days did he/she miss work/school due to illness or injury in the past month? Numeric

##stargazer package reminders lol

output of regression table
 stargazer(production_reg,
           title ="Precision",
           type = "text",
           report = "vc*s",
           #model.numbers=FALSE,
           covariate.labels = c("Heat", "Male", "Time", "Heat X Time ", "Height", "Height (Missing)"),
           dep.var.labels = "",
           column.labels = regression_names,
           no.space = TRUE,
           column.sep.width = "3pt",
           se = production_reg_pvals,
           p = production_reg_pvals,
           omit.stat = c("f", "adj.rsq", "ser")
           omit = c("height_reg", "height_reg_miss")

#Bivariate Logistic regression 01



```{r}

# formula_01_h <- sh_inf ~ health_5_3_2_ + health_5_4_ 
# formula_01_m <- sm_inf ~ health_5_3_2_ + health_5_4_ 
# formula_01_t <- total_egg ~ health_5_3_2_ + health_5_4_ 
# 
# # Run logistic regressions
# logit_model_01_h <- glm(formula_01_h, data = matched_only_df, family = binomial)
# logit_model_01_m <- glm(formula_01_m, data = matched_only_df, family = binomial)
# 
# # Calculate McFadden's Pseudo R^2 and handle missing/null values
# pseudo_r2_h <- pR2(logit_model_01_h)["McFadden"]
# pseudo_r2_h <- ifelse(is.null(pseudo_r2_h) || is.na(pseudo_r2_h), "N/A", round(as.numeric(pseudo_r2_h), 4))
# 
# pseudo_r2_m <- pR2(logit_model_01_m)["McFadden"]
# pseudo_r2_m <- ifelse(is.null(pseudo_r2_m) || is.na(pseudo_r2_m), "N/A", round(as.numeric(pseudo_r2_m), 4))
# 
# # Calculate BIC for both models
# bic_value_h <- BIC(logit_model_01_h)
# bic_value_m <- BIC(logit_model_01_m)
# 
# # Calculate robust standard errors for both models
# robust_se_h <- sqrt(diag(vcovHC(logit_model_01_h, type = "HC1")))
# robust_se_m <- sqrt(diag(vcovHC(logit_model_01_m, type = "HC1")))
# 
# # Display summary of both models using stargazer
# logit_models_done <- stargazer(logit_model_01_h, logit_model_01_m,
#           covariate.labels = c("Percieved infection", "Missed school days"),
#           type = "latex",
#           digit.separator = "",
#           no.space = TRUE,
#           column.sep.width = "3pt",
#           dep.var.labels = c("S. haematobium", "S. mansoni"),
#           #column.labels = c("S. haematobium", "S. mansoni"),
#           omit.stat = c("f", "adj.rsq"),
#           se = list(robust_se_h, robust_se_m),
#           add.lines = list(
#             c("Pseudo $R^2$", pseudo_r2_h, pseudo_r2_m),
#             c("BIC", round(bic_value_h, 2), round(bic_value_m, 2)))
#               )

```




```{r}

# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/NSF-Senegal/Latex"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/NSF-Senegal/Latex"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}

## Selected covariates at the village level:


# Specify the formula for logistic regression
formula_01_h <- sh_inf ~ health_5_3_2_ + health_5_4_ 
formula_01_m <- sm_inf ~ health_5_3_2_ + health_5_4_ 
formula_01_t <- total_egg ~ health_5_3_2_ + health_5_4_ 
# Run logistic regressions for S. haematobium and S. mansoni
logit_model_01_h <- glm(formula_01_h, data = matched_only_df, family = binomial)
logit_model_01_m <- glm(formula_01_m, data = matched_only_df, family = binomial)

# Run OLS regression for Total Egg Count
ols_model_01_t <- lm(formula_01_t, data = matched_only_df)

# Calculate McFadden's Pseudo R^2 for the logistic models
pseudo_r2_h_01 <- pR2(logit_model_01_h)["McFadden"]
pseudo_r2_h_01 <- ifelse(is.null(pseudo_r2_h_01) || is.na(pseudo_r2_h_01), "N/A", round(as.numeric(pseudo_r2_h_01), 4))

pseudo_r2_m_01 <- pR2(logit_model_01_m)["McFadden"]
pseudo_r2_m_01 <- ifelse(is.null(pseudo_r2_m_01) || is.na(pseudo_r2_m_01), "N/A", round(as.numeric(pseudo_r2_m_01), 4))

# Calculate BIC for both logistic models
bic_value_h_01 <- BIC(logit_model_01_h)
bic_value_m_01 <- BIC(logit_model_01_m)

# Calculate robust standard errors for the logistic models
robust_se_h_01 <- sqrt(diag(vcovHC(logit_model_01_h, type = "HC1")))
robust_se_m_01 <- sqrt(diag(vcovHC(logit_model_01_m, type = "HC1")))

# Calculate R-squared, Adjusted R-squared, and RMSE for the OLS model (total_egg)
r_squared_t_01 <- summary(ols_model_01_t)$r.squared
adj_r_squared_t_01 <- summary(ols_model_01_t)$adj.r.squared
rmse_t_01 <- sqrt(mean(residuals(ols_model_01_t)^2))

# Calculate BIC for the OLS model
bic_value_t_01 <- BIC(ols_model_01_t)

# Calculate robust standard errors for the OLS model
robust_se_t_01 <- sqrt(diag(vcovHC(ols_model_01_t, type = "HC1")))

# Display summary of both logistic models and the OLS model using stargazer
logit_models_done_01 <- stargazer(logit_model_01_h, logit_model_01_m, ols_model_01_t,
          covariate.labels = c("Percieved infection", "Missed school days"),
          type = "latex",
          digit.separator = "",
          no.space = TRUE,
          column.sep.width = "3pt",
          dep.var.labels = c("S. haematobium", "S. mansoni", "Total egg count"),
          omit.stat = c("f", "adj.rsq"),
          se = list(robust_se_h_01, robust_se_m_01, robust_se_t_01),
          add.lines = list(
            c("Pseudo $R^2$", pseudo_r2_h, pseudo_r2_m, "N/A"),  # For OLS (not applicable)
            c("BIC", round(bic_value_h_01, 2), round(bic_value_m_01, 2), round(bic_value_t_01, 2)),
            c("R-squared", "", "", round(r_squared_t_01, 4)),
            c("Adjusted R-squared", "", "", round(adj_r_squared_t_01, 4)),
            c("RMSE", "", "", round(rmse_t_01, 4))
          )
)

cat(logit_models_done_01, sep = '\n', file = 'logit_modeles_01_table.tex')
#out = "logit_model_01_table.tex"
# Extract coefficients

# Logistic regression model for S. haematobium (logit_model_01_h)
# Extract coefficients for the first model
coefficients_01_h <- coef(logit_model_01_h)
odds_ratios_01_h <- exp(coefficients_01_h)

# Logistic regression model for S. mansoni (logit_model_01_m)
# Extract coefficients for the second model
coefficients_01_m <- coef(logit_model_01_m)
odds_ratios_01_m <- exp(coefficients_01_m)

# OLS model for Total Egg Count (ols_model_01_t)
# Extract coefficients for the OLS model
coefficients_01_t <- coef(ols_model_01_t)

# # Create data frames for odds ratios and coefficients (long format)
# odds_ratios_long_01_h <- data.frame(
#   Variable = c("Intercept", 
#                "Perceived infection", 
#                "Missed school days"),
#   Odds_Ratio = odds_ratios_01_h
# )
# 
# odds_ratios_long_01_m <- data.frame(
#   Variable = c("Intercept", 
#                "Perceived infection", 
#                "Missed school days"),
#   Odds_Ratio = odds_ratios_01_m
# )
# 
# coefficients_long_01_t <- data.frame(
#   Variable = c("Intercept", 
#                "Perceived infection", 
#                "Missed school days"),
#   Coefficient = coefficients_01_t
# )
# 
# # Use stargazer to create latex tables for odds ratios and coefficients
# stargazer(odds_ratios_long_01_h, odds_ratios_long_01_m,
#           summary = FALSE,   # Suppress summary statistics
#           type = "latex",
#           rownames = FALSE,   # Remove row numbers
#           out = "odds_ratios_01_h_m.tex")

# Calculate confidence intervals for logistic models
conf_int_01_h <- confint(logit_model_01_h)
conf_int_odds_ratios_01_h <- exp(conf_int_01_h)

conf_int_01_m <- confint(logit_model_01_m)
conf_int_odds_ratios_01_m <- exp(conf_int_01_m)

# Confidence intervals for OLS model (coefficients and standard errors)
conf_int_01_t <- confint(ols_model_01_t)

# Combine the odds ratios with their confidence intervals for logistic models
CI_odds_01_h <- data.frame(Odds_Ratio = odds_ratios_01_h, 
                           CI_Lower = conf_int_odds_ratios_01_h[, 1], 
                           CI_Upper = conf_int_odds_ratios_01_h[, 2])

CI_odds_01_m <- data.frame(Odds_Ratio = odds_ratios_01_m, 
                           CI_Lower = conf_int_odds_ratios_01_m[, 1], 
                           CI_Upper = conf_int_odds_ratios_01_m[, 2])


# Display odds ratios with confidence intervals using stargazer
stargazer(CI_odds_01_h, CI_odds_01_m,
          type = "latex",
          out = "CI_odds_01_h_m.tex")

# Display coefficients with confidence intervals for the OLS model
CI_coeff_01_t <- data.frame(Coefficient = coefficients_01_t,
                            CI_Lower = conf_int_01_t[, 1],
                            CI_Upper = conf_int_01_t[, 2])

stargazer(CI_coeff_01_t,
          type = "latex",
          out = "CI_coeff_01_t.tex")

```


#Bivariate Logistic regression 02



```{r}

# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/NSF-Senegal/Latex"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/NSF-Senegal/Latex"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}
# Specify the formula for logistic regression
formula_02_h <- sh_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_
formula_02_m <- sm_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_
formula_02_t <- total_egg ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_
# Run logistic regressions for S. haematobium and S. mansoni
logit_model_02_h <- glm(formula_02_h, data = matched_only_df, family = binomial)
logit_model_02_m <- glm(formula_02_m, data = matched_only_df, family = binomial)

# Run OLS regression for Total Egg Count
ols_model_02_t <- lm(formula_02_t, data = matched_only_df)

# Calculate McFadden's Pseudo R^2 for the logistic models
pseudo_r2_h_02 <- pR2(logit_model_02_h)["McFadden"]
pseudo_r2_h_02 <- ifelse(is.null(pseudo_r2_h_02) || is.na(pseudo_r2_h_02), "N/A", round(as.numeric(pseudo_r2_h_02), 4))

pseudo_r2_m_02 <- pR2(logit_model_02_m)["McFadden"]
pseudo_r2_m_02 <- ifelse(is.null(pseudo_r2_m_02) || is.na(pseudo_r2_m_02), "N/A", round(as.numeric(pseudo_r2_m_02), 4))

# Calculate BIC for both logistic models
bic_value_h_02 <- BIC(logit_model_02_h)
bic_value_m_02 <- BIC(logit_model_02_m)

# Calculate robust standard errors for the logistic models
robust_se_h_02 <- sqrt(diag(vcovHC(logit_model_02_h, type = "HC1")))
robust_se_m_02 <- sqrt(diag(vcovHC(logit_model_02_m, type = "HC1")))

# Calculate R-squared, Adjusted R-squared, and RMSE for the OLS model (total_egg)
r_squared_t_02 <- summary(ols_model_02_t)$r.squared
adj_r_squared_t_02 <- summary(ols_model_02_t)$adj.r.squared
rmse_t_02 <- sqrt(mean(residuals(ols_model_02_t)^2))

# Calculate BIC for the OLS model
bic_value_t_02 <- BIC(ols_model_02_t)

# Calculate robust standard errors for the OLS model
robust_se_t_02 <- sqrt(diag(vcovHC(ols_model_02_t, type = "HC1")))

# Display summary of both logistic models and the OLS model using stargazer
logit_models_done_02 <- stargazer(logit_model_02_h, logit_model_02_m, ols_model_02_t,
          covariate.labels = c("Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia"),
          type = "latex",
          digit.separator = "",
          no.space = TRUE,
          column.sep.width = "3pt",
          dep.var.labels = c("S. haematobium", "S. mansoni", "Total egg count"),
          omit.stat = c("f", "adj.rsq"),
          se = list(robust_se_h_02, robust_se_m_02, robust_se_t_02),
          add.lines = list(
            c("Pseudo $R^2$", pseudo_r2_h, pseudo_r2_m, "N/A"),  # For OLS (not applicable)
            c("BIC", round(bic_value_h_02, 2), round(bic_value_m_02, 2), round(bic_value_t_02, 2)),
            c("R-squared", "", "", round(r_squared_t_02, 4)),
            c("Adjusted R-squared", "", "", round(adj_r_squared_t_02, 4)),
            c("RMSE", "", "", round(rmse_t_02, 4))
          )
)

cat(logit_models_done_02, sep = '\n', file = 'logit_modeles_02_table.tex')
#out = "logit_model_02_table.tex"

#>>>>>****>>>> Extract coefficients <<<<<****<<<<<

# # Logistic regression model for S. haematobium (logit_model_02_h)
# # Extract coefficients for the first model
# coefficients_02_h <- coef(logit_model_02_h)
# odds_ratios_02_h <- exp(coefficients_02_h)
# 
# # Logistic regression model for S. mansoni (logit_model_02_m)
# # Extract coefficients for the second model
# coefficients_02_m <- coef(logit_model_02_m)
# odds_ratios_02_m <- exp(coefficients_02_m)
# 
# # OLS model for Total Egg Count (ols_model_02_t)
# # Extract coefficients for the OLS model
# coefficients_02_t <- coef(ols_model_02_t)
# 
# # Create data frames for odds ratios and coefficients (long format)
# odds_ratios_long_02_h <- data.frame(
#  Variable = c("Intercept", 
#                "Perceived infection", 
#                "Missed school days", 
#                "Received medication", 
#                "Ever diagnosed with Bilharzia"),
#   Odds_Ratio = odds_ratios_02_h
# )
# 
# odds_ratios_long_02_m <- data.frame(
#   Variable = c("Intercept", 
#                "Perceived infection", 
#                "Missed school days", 
#                "Received medication", 
#                "Ever diagnosed with Bilharzia"),
#   Odds_Ratio = odds_ratios_02_m
# )
# 
# coefficients_long_02_t <- data.frame(
#   Variable = c("Intercept", 
#                "Perceived infection", 
#                "Missed school days", 
#                "Received medication", 
#                "Ever diagnosed with Bilharzia"),
#   Coefficient = coefficients_02_t
# )
# 
# # Use stargazer to create latex tables for odds ratios and coefficients
# stargazer(odds_ratios_long_02_h, odds_ratios_long_02_m,
#           summary = FALSE,   # Suppress summary statistics
#           type = "latex",
#           rownames = FALSE,   # Remove row numbers
#           out = "odds_ratios_02_h_m.tex")

# Calculate confidence intervals for logistic models
# conf_int_02_h <- confint(logit_model_02_h)
# conf_int_odds_ratios_02_h <- exp(conf_int_02_h)
# 
# conf_int_02_m <- confint(logit_model_02_m)
# conf_int_odds_ratios_02_m <- exp(conf_int_02_m)

# Confidence intervals for OLS model (coefficients and standard errors)
conf_int_02_t <- confint(ols_model_02_t)

# Combine the odds ratios with their confidence intervals for logistic models
CI_odds_02_h <- data.frame(Odds_Ratio = odds_ratios_02_h, 
                           CI_Lower = conf_int_odds_ratios_02_h[, 1], 
                           CI_Upper = conf_int_odds_ratios_02_h[, 2])

CI_odds_02_m <- data.frame(Odds_Ratio = odds_ratios_02_m, 
                           CI_Lower = conf_int_odds_ratios_02_m[, 1], 
                           CI_Upper = conf_int_odds_ratios_02_m[, 2])


# Display odds ratios with confidence intervals using stargazer
stargazer(CI_odds_02_h, CI_odds_02_m,
          type = "latex",
          out = "CI_odds_02_h_m.tex")

# Display coefficients with confidence intervals for the OLS model
CI_coeff_02_t <- data.frame(Coefficient = coefficients_02_t,
                            CI_Lower = conf_int_02_t[, 1],
                            CI_Upper = conf_int_02_t[, 2])

stargazer(CI_coeff_02_t,
          type = "latex",
          out = "CI_coeff_02_t.tex")

```




```{r}
# setwd("C:/Users/km978/Downloads/SenegalGIT/NSF-Senegal/Latex")
# 
# # Specify the formula for logistic regression
# formula_02 <- sh_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_
# 
# # Run the logistic regression
# logit_model_02 <- glm(formula, data = matched_only_df, family = binomial)
# 
# pseudo2_r2 <- pR2(logit_model_02)["McFadden"]
# pseudo2_r2 <- ifelse(is.null(pseudo2_r2) || is.na(pseudo2_r2), "N/A", round(as.numeric(pseudo2_r2), 4))
# 
# # Calculate BIC
# bic_value2 <- BIC(logit_model_02)
# 
# robust_se2 <- sqrt(diag(vcovHC(logit_model_02, type = "HC1")))
# # Display summary of the model
# logit_model_02_done <- stargazer(logit_model_02,  
#           covariate.labels = c("Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia"),
#           #dep.var.labels = "",
#           type = "latex", 
#           digit.separator = "",
#           no.space = TRUE,
#           column.sep.width = "3pt",
#           omit.stat = c("f", "adj.rsq"),
#           se = list(robust_se2),
#           add.lines = list(c("Pseudo $R^2$", round(pseudo2_r2, 4)),
#                             c("BIC", round(bic_value2, 2)))
#          )
# 
# 
# cat(logit_model_02_done, sep = '\n', file = 'logit_model_02_table.tex')
# 
# # Extract coefficients
# coefficients_02 <- coef(logit_model_02)
# 
# # Calculate odds ratios
# odds_ratios_02 <- exp(coefficients_02)
# 
# # Display odds ratios in long format for better readability 
# odds_ratios_long_02 <- data.frame(
#   Variable = c("Intercept", 
#                "Perceived infection", 
#                "Missed school days", 
#                "Received medication", 
#                "Ever diagnosed with Bilharzia"),
#   Odds_Ratio = odds_ratios_02
# )
# 
# # Use stargazer for a "long" table
# stargazer(odds_ratios_long_02,
#           summary = FALSE,   # Suppresses summary statistics
#           type = "latex",
#           rownames = FALSE, #Removes row numbers
#           out = "odds_ratios_02.tex")
# 
# # Calculate confidence intervals for coefficients
# conf_int <- confint(logit_model_02)
# 
# # Exponentiate to get confidence intervals for odds ratios
# conf_int_odds_ratios_02 <- exp(conf_int)
# 
# # Display odds ratios with confidence intervals
# CI_odds_02 <- data.frame(Odds_Ratio = odds_ratios_02, 
#            CI_Lower = conf_int_odds_ratios_02[, 1], 
#            CI_Upper = conf_int_odds_ratios_02[, 2])
# 
# stargazer(CI_odds_02,
#           type = "latex",
#           out = "CI_odds_02.tex")
```



#Bivariate Logistic regression 03

```{r}
# #setwd("C:/Users/Kateri/Downloads/SenegalGIT/NSF-Senegal/Latex Output")
#    setwd("C:/Users/km978/Downloads/SenegalGIT/NSF-Senegal/Latex")
# 
# # Specify the formula for logistic regression
# 
# # Replace all 2s in the variable health_5_8_ with NAs
# # Replace all 2s in the variable health_5_8_ with NAs directly in the dataframe
# matched_only_df$health_5_8_ <- ifelse(matched_only_df$health_5_8_ == 2, NA, matched_only_df$health_5_8_)
# 
# 
# formula_03 <- sh_inf ~  health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ 
# 
# # Run the logistic regression
# logit_model_03 <- glm(formula_03, data = matched_only_df, family = binomial)
# 
# covariate_labels_03 <- c("Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine", "Blood in stool")
# #view(matched_only_df)
# 
# pseudoR2_3 <- pR2(logit_model_03)["McFadden"]
# pseudoR2_3 <- ifelse(is.null(pseudoR2_3) || is.na(pseudoR2_3), "N/A", round(as.numeric(pseudoR2_3), 4))
# 
# # Calculate BIC
# bic_value3 <- BIC(logit_model_03)
# 
# robust_se3 <- sqrt(diag(vcovHC(logit_model_03, type = "HC1")))
# # Display summary of the model
# logit_model_03_done <- stargazer(logit_model_03,  
#           covariate.labels = covariate_labels_03,
#           #dep.var.labels = "",
#           type = "latex", 
#           digit.separator = "",
#           no.space = TRUE,
#           column.sep.width = "3pt",
#           omit.stat = c("f", "adj.rsq"),
#           se = list(robust_se3),
#           add.lines = list(c("Pseudo $R^2$", round(pseudoR2_3, 4)),
#                             c("BIC", round(bic_value3, 2)))
#          )  
# #This is so the entire chunk can run - I'm not sure why I get errors 
# cat(logit_model_03_done, sep = '\n', file = 'logit_model_03_table.tex')
# 
# 
# # Extract coefficients
# coefficients_03 <- coef(logit_model_03)
# 
# # Calculate odds ratios
# odds_ratios_03 <- exp(coefficients_03)
# odds_ratios_03
# #Display odds ratios in long format for better readability
# odds_ratios_long_03 <- data.frame(
#   Variable = c("Intercept", 
#                "Percieved infection",
#                "Missed school days",
#                "Recived medication", 
#                "Ever diagnosed with Bilharzia", 
#                "Blood in urine",
#                "Blood in stool"),
#   Odds_Ratio = odds_ratios_03
# )
# 
# # Use stargazer for a "long" table
# stargazer(odds_ratios_long_03,
#           summary = FALSE,   # Suppresses summary statistics
#           type = "latex",
#           rownames = FALSE, #Removes row numbers
#           out = "odds_ratios_03.tex")
# 
# # Calculate confidence intervals for coefficients
# conf_int_03 <- confint(logit_model_03)
# 
# # Exponentiate to get confidence intervals for odds ratios
# conf_int_odds_ratios_03 <- exp(conf_int_03)
# 
# # Display odds ratios with confidence intervals
# CI_odds_03 <- data.frame(Odds_Ratio = odds_ratios_03, 
#            CI_Lower = conf_int_odds_ratios_03[, 1], 
#            CI_Upper = conf_int_odds_ratios_03[, 2])
# 
# stargazer(CI_odds_03,
#           type = "latex",
#           out = "CI_odds_03.tex")
```





```{r}
# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/NSF-Senegal/Latex"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/NSF-Senegal/Latex"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}

# Specify the formula for logistic regression
formula_03_h <- sh_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ 
formula_03_m <- sm_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ 
formula_03_t <- total_egg ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ 
# Run logistic regressions for S. haematobium and S. mansoni
logit_model_03_h <- glm(formula_03_h, data = matched_only_df, family = binomial)
logit_model_03_m <- glm(formula_03_m, data = matched_only_df, family = binomial)

# Run OLS regression for Total Egg Count
ols_model_03_t <- lm(formula_03_t, data = matched_only_df)

# Calculate McFadden's Pseudo R^2 for the logistic models
pseudo_r2_h_03 <- pR2(logit_model_03_h)["McFadden"]
pseudo_r2_h_03 <- ifelse(is.null(pseudo_r2_h_03) || is.na(pseudo_r2_h_03), "N/A", round(as.numeric(pseudo_r2_h_03), 4))

pseudo_r2_m_03 <- pR2(logit_model_03_m)["McFadden"]
pseudo_r2_m_03 <- ifelse(is.null(pseudo_r2_m_03) || is.na(pseudo_r2_m_03), "N/A", round(as.numeric(pseudo_r2_m_03), 4))

# Calculate BIC for both logistic models
bic_value_h_03 <- BIC(logit_model_03_h)
bic_value_m_03 <- BIC(logit_model_03_m)

# Calculate robust standard errors for the logistic models
robust_se_h_03 <- sqrt(diag(vcovHC(logit_model_03_h, type = "HC1")))
robust_se_m_03 <- sqrt(diag(vcovHC(logit_model_03_m, type = "HC1")))

# Calculate R-squared, Adjusted R-squared, and RMSE for the OLS model (total_egg)
r_squared_t_03 <- summary(ols_model_03_t)$r.squared
adj_r_squared_t_03 <- summary(ols_model_03_t)$adj.r.squared
rmse_t_03 <- sqrt(mean(residuals(ols_model_03_t)^2))

# Calculate BIC for the OLS model
bic_value_t_03 <- BIC(ols_model_03_t)

# Calculate robust standard errors for the OLS model
robust_se_t_03 <- sqrt(diag(vcovHC(ols_model_03_t, type = "HC1")))

covariate_labels_03 <- c("Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine", "Blood in stool")

# Display summary of both logistic models and the OLS model using stargazer
logit_models_done_03 <- stargazer(logit_model_03_h, logit_model_03_m, ols_model_03_t,
          covariate.labels = covariate_labels_03,
          type = "latex",
          digit.separator = "",
          no.space = TRUE,
          column.sep.width = "3pt",
          dep.var.labels = c("S. haematobium", "S. mansoni", "Total egg count"),
          omit.stat = c("f", "adj.rsq"),
          se = list(robust_se_h_03, robust_se_m_03, robust_se_t_03),
          add.lines = list(
            c("Pseudo $R^2$", pseudo_r2_h, pseudo_r2_m, "N/A"),  # For OLS (not applicable)
            c("BIC", round(bic_value_h_03, 2), round(bic_value_m_03, 2), round(bic_value_t_03, 2)),
            c("R-squared", "", "", round(r_squared_t_03, 4)),
            c("Adjusted R-squared", "", "", round(adj_r_squared_t_03, 4)),
            c("RMSE", "", "", round(rmse_t_03, 4))
          )
)

cat(logit_models_done_03, sep = '\n', file = 'logit_modeles_03_table.tex')
#out = "logit_model_03_table.tex"
# Extract coefficients

# Logistic regression model for S. haematobium (logit_model_03_h)
# Extract coefficients for the first model
# coefficients_03_h <- coef(logit_model_03_h)
# odds_ratios_03_h <- exp(coefficients_03_h)

# Logistic regression model for S. mansoni (logit_model_03_m)
# Extract coefficients for the second model
# coefficients_03_m <- coef(logit_model_03_m)
# odds_ratios_03_m <- exp(coefficients_03_m)
# 
# # OLS model for Total Egg Count (ols_model_03_t)
# # Extract coefficients for the OLS model
# coefficients_03_t <- coef(ols_model_03_t)
# 
# # Create data frames for odds ratios and coefficients (long format)
# odds_ratios_long_03_h <- data.frame(
#  Variable = c("Intercept", 
#                "Percieved infection",
#                "Missed school days",
#                "Recived medication",
#                "Ever diagnosed with Bilharzia",
#                "Blood in urine",
#                "Blood in stool"),
#   Odds_Ratio = odds_ratios_03_h
# )
# 
# odds_ratios_long_03_m <- data.frame(
# Variable = c("Intercept", 
#                "Percieved infection",
#                "Missed school days",
#                "Recived medication",
#                "Ever diagnosed with Bilharzia",
#                "Blood in urine",
#                "Blood in stool"),
#   Odds_Ratio = odds_ratios_03_m
# )
# 
# coefficients_long_03_t <- data.frame(
#  Variable = c("Intercept", 
#                "Percieved infection",
#                "Missed school days",
#                "Recived medication",
#                "Ever diagnosed with Bilharzia",
#                "Blood in urine",
#                "Blood in stool"),
#   Coefficient = coefficients_03_t
# )
# 
# # Use stargazer to create latex tables for odds ratios and coefficients
# stargazer(odds_ratios_long_03_h, odds_ratios_long_03_m,
#           summary = FALSE,   # Suppress summary statistics
#           type = "latex",
#           rownames = FALSE,   # Remove row numbers
#           out = "odds_ratios_03_h_m.tex")

# Calculate confidence intervals for logistic models
conf_int_03_h <- confint(logit_model_03_h)
conf_int_odds_ratios_03_h <- exp(conf_int_03_h)

conf_int_03_m <- confint(logit_model_03_m)
conf_int_odds_ratios_03_m <- exp(conf_int_03_m)

# Confidence intervals for OLS model (coefficients and standard errors)
conf_int_03_t <- confint(ols_model_03_t)

# Combine the odds ratios with their confidence intervals for logistic models
CI_odds_03_h <- data.frame(Odds_Ratio = odds_ratios_03_h, 
                           CI_Lower = conf_int_odds_ratios_03_h[, 1], 
                           CI_Upper = conf_int_odds_ratios_03_h[, 2])

CI_odds_03_m <- data.frame(Odds_Ratio = odds_ratios_03_m, 
                           CI_Lower = conf_int_odds_ratios_03_m[, 1], 
                           CI_Upper = conf_int_odds_ratios_03_m[, 2])


# Display odds ratios with confidence intervals using stargazer
stargazer(CI_odds_03_h, CI_odds_03_m,
          type = "latex",
          out = "CI_odds_03_h_m.tex")

# Display coefficients with confidence intervals for the OLS model
CI_coeff_03_t <- data.frame(Coefficient = coefficients_03_t,
                            CI_Lower = conf_int_03_t[, 1],
                            CI_Upper = conf_int_03_t[, 2])

stargazer(CI_coeff_03_t,
          type = "latex",
          out = "CI_coeff_03_t.tex")

```


#Bivariate Logistic regression 04


```{r}
# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/NSF-Senegal/Latex"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/NSF-Senegal/Latex"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}

# Specify the formula for logistic regression
formula_04_h <- sh_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ + hh_gender_ + hh_ethnicity_ + hh_12_1_ + hh_12_2_ + hh_12_3_ + hh_12_4_ + hh_12_5_ + hh_12_6_ + hh_12_7_ + hh_12_8_ + hh_31_ + hh_33_ + hh_37_ + living_01 + living_02 + living_04  + wealthindex
formula_04_m <- sm_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ + hh_gender_ + hh_ethnicity_ + hh_12_1_ + hh_12_2_ + hh_12_3_ + hh_12_4_ + hh_12_5_ + hh_12_6_ + hh_12_7_ + hh_12_8_ + hh_31_ + hh_33_ + hh_37_ + living_01 + living_02 + living_04  + wealthindex
formula_04_t <- total_egg ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ + hh_gender_ + hh_ethnicity_ + hh_12_1_ + hh_12_2_ + hh_12_3_ + hh_12_4_ + hh_12_5_ + hh_12_6_ + hh_12_7_ + hh_12_8_ + hh_31_ + hh_33_ + hh_37_ + living_01 + living_02 + living_04  + wealthindex
# Run logistic regressions for S. haematobium and S. mansoni
logit_model_04_h <- glm(formula_04_h, data = matched_only_df, family = binomial)
logit_model_04_m <- glm(formula_04_m, data = matched_only_df, family = binomial)

# Run OLS regression for Total Egg Count
ols_model_04_t <- lm(formula_04_t, data = matched_only_df)

# Calculate McFadden's Pseudo R^2 for the logistic models
pseudo_r2_h_04 <- pR2(logit_model_04_h)["McFadden"]
pseudo_r2_h_04 <- ifelse(is.null(pseudo_r2_h_04) || is.na(pseudo_r2_h_04), "N/A", round(as.numeric(pseudo_r2_h_04), 4))

pseudo_r2_m_04 <- pR2(logit_model_04_m)["McFadden"]
pseudo_r2_m_04 <- ifelse(is.null(pseudo_r2_m_04) || is.na(pseudo_r2_m_04), "N/A", round(as.numeric(pseudo_r2_m_04), 4))

# Calculate BIC for both logistic models
bic_value_h_04 <- BIC(logit_model_04_h)
bic_value_m_04 <- BIC(logit_model_04_m)

# Calculate robust standard errors for the logistic models
robust_se_h_04 <- sqrt(diag(vcovHC(logit_model_04_h, type = "HC1")))
robust_se_m_04 <- sqrt(diag(vcovHC(logit_model_04_m, type = "HC1")))

# Calculate R-squared, Adjusted R-squared, and RMSE for the OLS model (total_egg)
r_squared_t_04 <- summary(ols_model_04_t)$r.squared
adj_r_squared_t_04 <- summary(ols_model_04_t)$adj.r.squared
rmse_t_04 <- sqrt(mean(residuals(ols_model_04_t)^2))

# Calculate BIC for the OLS model
bic_value_t_04 <- BIC(ols_model_04_t)

# Calculate robust standard errors for the OLS model
robust_se_t_04 <- sqrt(diag(vcovHC(ols_model_04_t, type = "HC1")))

covariate_labels_04 <- c("Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine", "Blood in stool", "Gender", "Ethnicity", "Fetch water for HH", "water for Livestock", "Fetch water for ag", "Wash clothes", "Do the dishes", "harvest aquatic veg", "Swim/bathe", "Play", "Grade achieved in 2022/2023", "Academic performance", "School missed", "Source of drinking water supply", "Water treated?", "Type of toilet", "wealth index")

# Display summary of both logistic models and the OLS model using stargazer
logit_models_done_04 <- stargazer(logit_model_04_h, logit_model_04_m, ols_model_04_t,
          covariate.labels = covariate_labels_04,
          type = "latex",
          digit.separator = "",
          no.space = TRUE,
          column.sep.width = "3pt",
          dep.var.labels = c("S. haematobium", "S. mansoni", "Total egg count"),
          omit.stat = c("f", "adj.rsq"),
          se = list(robust_se_h_04, robust_se_m_04, robust_se_t_04),
          add.lines = list(
            c("Pseudo $R^2$", pseudo_r2_h, pseudo_r2_m, "N/A"),  # For OLS (not applicable)
            c("BIC", round(bic_value_h_04, 2), round(bic_value_m_04, 2), round(bic_value_t_04, 2)),
            c("R-squared", "", "", round(r_squared_t_04, 4)),
            c("Adjusted R-squared", "", "", round(adj_r_squared_t_04, 4)),
            c("RMSE", "", "", round(rmse_t_04, 4))
          )
)

cat(logit_models_done_04, sep = '\n', file = 'logit_modeles_04_table.tex')
#out = "logit_model_04_table.tex"
# Extract coefficients

# Logistic regression model for S. haematobium (logit_model_04_h)
# Extract coefficients for the first model
# coefficients_04_h <- coef(logit_model_04_h)
# odds_ratios_04_h <- exp(coefficients_04_h)
# 
# # Logistic regression model for S. mansoni (logit_model_04_m)
# # Extract coefficients for the second model
# coefficients_04_m <- coef(logit_model_04_m)
# odds_ratios_04_m <- exp(coefficients_04_m)
# 
# # OLS model for Total Egg Count (ols_model_04_t)
# # Extract coefficients for the OLS model
# coefficients_04_t <- coef(ols_model_04_t)
# 
# # Create data frames for odds ratios and coefficients (long format)
# odds_ratios_long_04_h <- data.frame(
#  Variable = c("Intercept", "Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine","Blood in stool", "Gender", "Ethnicity", "Fetch water for HH", "water for Livestock", "Fetch water for ag", "Wash clothes", "Do the dishes", "harvest aquatic veg", "Swim/bathe", "Play", "Grade achieved in 2022/2023", "Academic performance", "School missed", "Source of drinking water supply", "Water treated?", "Type of toilet", "wealth index"),
#   Odds_Ratio = odds_ratios_04_h
# )
# 
# odds_ratios_long_04_m <- data.frame(
#  Variable = c("Intercept", "Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine","Blood in stool", "Gender", "Ethnicity", "Fetch water for HH", "water for Livestock", "Fetch water for ag", "Wash clothes", "Do the dishes", "harvest aquatic veg", "Swim/bathe", "Play", "Grade achieved in 2022/2023", "Academic performance", "School missed", "Source of drinking water supply", "Water treated?", "Type of toilet", "wealth index"),
#   Odds_Ratio = odds_ratios_04_m
# )
# 
# coefficients_long_04_t <- data.frame(
#  Variable = c("Intercept", "Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine","Blood in stool", "Gender", "Ethnicity", "Fetch water for HH", "water for Livestock", "Fetch water for ag", "Wash clothes", "Do the dishes", "harvest aquatic veg", "Swim/bathe", "Play", "Grade achieved in 2022/2023", "Academic performance", "School missed", "Source of drinking water supply", "Water treated?", "Type of toilet", "wealth index"),
#   Coefficient = coefficients_04_t
# )
# 
# # Use stargazer to create latex tables for odds ratios and coefficients
# stargazer(odds_ratios_long_04_h, odds_ratios_long_04_m,
#           summary = FALSE,   # Suppress summary statistics
#           type = "latex",
#           rownames = FALSE,   # Remove row numbers
#           out = "odds_ratios_04_h_m.tex")

# Calculate confidence intervals for logistic models
conf_int_04_h <- confint(logit_model_04_h)
conf_int_odds_ratios_04_h <- exp(conf_int_04_h)

conf_int_04_m <- confint(logit_model_04_m)
conf_int_odds_ratios_04_m <- exp(conf_int_04_m)

# Confidence intervals for OLS model (coefficients and standard errors)
conf_int_04_t <- confint(ols_model_04_t)

# Combine the odds ratios with their confidence intervals for logistic models
CI_odds_04_h <- data.frame(Odds_Ratio = odds_ratios_04_h, 
                           CI_Lower = conf_int_odds_ratios_04_h[, 1], 
                           CI_Upper = conf_int_odds_ratios_04_h[, 2])

CI_odds_04_m <- data.frame(Odds_Ratio = odds_ratios_04_m, 
                           CI_Lower = conf_int_odds_ratios_04_m[, 1], 
                           CI_Upper = conf_int_odds_ratios_04_m[, 2])


# Display odds ratios with confidence intervals using stargazer
stargazer(CI_odds_04_h, CI_odds_04_m,
          type = "latex",
          out = "CI_odds_04_h_m.tex")

# Display coefficients with confidence intervals for the OLS model
CI_coeff_04_t <- data.frame(Coefficient = coefficients_04_t,
                            CI_Lower = conf_int_04_t[, 1],
                            CI_Upper = conf_int_04_t[, 2])

stargazer(CI_coeff_04_t,
          type = "latex",
          out = "CI_coeff_04_t.tex")
```














