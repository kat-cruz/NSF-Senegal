---
title: "Balance_Tables"
author: "Kateri Mouawad"
date: "2025-01-03"
output: html_document
---

#START HERE - load packages

```{r}

#remotes::install_github("kwb-r/kwb.utils")

#options(repos = c(
#  kwbr = 'https://kwb-r.r-universe.dev',
#  CRAN = 'https://cloud.r-project.org'))
  
# Download and install kwb.utils in R
#install.packages('kwb.utils')




# install.packages(officer)
# install.packages(r2rtf)
# install.packages(dplyr)
# install.packages(ggplot2)
# install.packages(kwb.utils)
# install.packages(haven)
# install.packages(data.table)
# install.packages(rtf)
# install.packages(tidyverse)
# install.packages(estimatr)
# install.packages(broom)
#install.packages(reshape2)
#library(reshape2)
library(officer)
library(r2rtf)
library(dplyr)
library(ggplot2)
library(kwb.utils)
library(haven)
library(data.table)
library(rtf)
library(tidyverse)
library(estimatr)
library(broom)

```



#File and Data paths
```{r}

# Define the file paths
proj_paths <- list(
  projects = "C:/Users/Kateri/Box/NSF Senegal",
  alternative_projects = "C:/Users/km978/Box/NSF Senegal"
)

# Check if the Kateri path exists and resolve the project path accordingly
if (file.exists(proj_paths$projects)) {
  proj <- kwb.utils::resolve(list(
    projects = proj_paths$projects,
    p1 = "<projects>/Data Management/Output/Data Analysis/Balance_Tables"
  ))  
} else {
  proj <- kwb.utils::resolve(list(
    projects = proj_paths$alternative_projects,
    p1 = "<projects>/Data Management/Output/Data Analysis/Balance_Tables"
  ))
}


file_path_balance_tables_df <- file.path(proj$p1, "baseline_balance_tables_data.dta")
balance_df <- read_dta(file_path_balance_tables_df)

```




filter by treatment group

```{r}


# Adding indicator variables for household training categories
balance_df <- balance_df %>%
  mutate(
    # Extract the two middle characters (e.g., 2A) from hhid
    group = str_sub(hhid, 3, 4),
    
    # Add indicator variables based on the group value
    control = if_else(group %in% c("0A", "0B"), 1, 0),
    public_health_trained = if_else(group %in% c("1A", "1B"), 1, 0),
    private_benefits_trained = if_else(group %in% c("2A", "2B"), 1, 0),
    public_and_private_trained = if_else(group %in% c("3A", "3B"), 1, 0)
  ) %>%
  # Drop the 'group' column if it's not needed
  select(-group)

view(balance_df)


```



```{r}


# for individual-level variables, these need to be scaled to the household level
    # 1) Understand the Variable: Is it continuous, binary, or categorical? What does it represent?
    # 2) Decide Whatâ€™s Meaningful: What summary statistic (mean, max, proportion) best represents the household for your analysis goals?
    

# Specify the individual-level variables to scale
individual_vars <- c("hh_education_year_achieve_", "hh_14_", "hh_16_", "agri_income_05") # Replace with the names of the variables to scale
household_id <- "hhid"       # Replace with your household identifier column

# Create new variables in the original dataframe by scaling to household-level means
balance_df <- balance_df %>%
  group_by(!!sym(household_id)) %>%
  mutate(across(
    all_of(individual_vars), 
    ~ mean(.x, na.rm = TRUE), 
    .names = "{.col}mean"
  )) %>%
  ungroup()

# View the updated dataframe
print(balance_df)



```



































