---
title: "Parasitological_Logistic_Regression_Analysis"
output: html_document
date: "2024-11-18"
---

#BEGIN HERE - load packages

```{r}
#install.packages("ggmosaic")
#install.packages("vcd")
#install.packages("stargazer")
#install.packages("MASS")  
#install.packages("pscl")  
#install.packages("sandwich")
#install.packages("gt")
#install.packages("caret")
#install.packages("xtable")

library(gt)
library(vcd)
library(ggmosaic)
library(officer)
library(r2rtf)
library(dplyr)
library(ggplot2)
library(kwb.utils)
library(haven)
library(data.table)
library(rtf)
library(tidyverse)
library(estimatr)
library(broom)
#library(MASS)       
library(stats)
library(stargazer)
library(pscl)
library(sandwich)
library(caret)
library(xtable)

```

#Load file paths

```{r}
# Define the file paths
proj_paths <- list(
  projects = "C:/Users/Kateri/Box/NSF Senegal",
  alternative_projects = "C:/Users/km978/Box/NSF Senegal"
)

# Check if the Kateri path exists and resolve the project path accordingly
if (file.exists(proj_paths$projects)) {
  proj <- kwb.utils::resolve(list(
    projects = proj_paths$projects,
    p1 = "<projects>/Data Management/_PartnerData/Child infection dataframe/Dataframe"
  ))
} else {
  proj <- kwb.utils::resolve(list(
    projects = proj_paths$alternative_projects,
    p1 = "<projects>/Data Management/_PartnerData/Child infection dataframe/Dataframe"
  ))
}

file_path_infection_df <- file.path(proj$p1, "child_infection_dataframe_features.dta")
infection_df <- read_dta(file_path_infection_df)


```

## Filter df

```{r}

matched_only_df <- infection_df %>%
  filter(match_score != "")

```

#Create relevant variables

```{r}


# Calculate egg counts
matched_only_df <- matched_only_df %>%
  # 1) Calculate S. haematobium egg count
  mutate(
    sh_egg_count = if_else(fu_p1 > 0, fu_p1, fu_p2),  # max of fu_p1 and fu_p2, only use fu_p2 if fu_p1 is zero

    #  2) Calculate S. mansoni egg count
    # Calculate average of each pass
    p1_avg = (p1_kato1_k1_pg + p1_kato2_k2_peg) / 2,
    p2_avg = (p2_kato1_k1_epg + p2_kato2_k2_epg) / 2,

    # Only calculate p2_avg if p1_avg is zero, then take the maximum of p1_avg and p2_avg
    sm_egg_count = if_else(p1_avg > 0, p1_avg, p2_avg)
  )# %>%

#Change variables to factors 

# matched_only_df <- matched_only_df %>%
#   mutate(
#     health_5_3_2_ = as.factor(health_5_3_2_), 
#     health_5_5_ = as.factor(health_5_5_),
#     health_5_6_ = as.factor(health_5_6_),
#     health_5_8_ = as.factor(health_5_8_),
#     health_5_9_ = as.factor(health_5_9_),
#     health_5_10_ = as.factor(health_5_10_)
# )

```

#Cleaning 

```{r}
#turn NAs into zeros
matched_only_df <- matched_only_df %>%
  mutate(
    hh_31_ = ifelse(is.na(hh_31_), 0, hh_31_),
    hh_33_ = ifelse(is.na(hh_33_), 0, hh_33_),
    health_5_4_ = ifelse(is.na(health_5_4_), 0, health_5_4_),
    health_5_3_2_ = ifelse(is.na(health_5_3_2_), 0, health_5_3_2_)
    )

matched_only_df <- matched_only_df %>%
  mutate(
    hh_19_ = if_else(hh_19_ == 0 & hh_18_ == 0, 0, hh_19_),
    hh_31_ = if_else(hh_30_ == 0 & hh_26_ == 0, 0, hh_31_),  # hh_30 conditional on hh_26 = 1
    hh_33_ = if_else(hh_26_ == 0 & hh_32_ == 0, 0, hh_33_),
    living_03 = if_else(living_02 == 0, 0, living_03),
    living_04 = 0,  # No condition provided
    hh_12_1_ = if_else(hh_10_ == 0, 0, hh_12_1_),
    hh_12_2_ = if_else(hh_10_ == 0, 0, hh_12_2_),
    hh_12_3_ = if_else(hh_10_ == 0, 0, hh_12_3_), 
    hh_12_4_ = if_else(hh_10_ == 0, 0, hh_12_4_),    
    hh_12_5_ = if_else(hh_10_ == 0, 0, hh_12_5_),    
    hh_12_6_ = if_else(hh_10_ == 0, 0, hh_12_6_),    
    hh_12_7_ = if_else(hh_10_ == 0, 0, hh_12_7_),    
    hh_12_8_ = if_else(hh_10_ == 0, 0, hh_12_8_)  
    
    
     )


view(matched_only_df)
names(matched_only_df)
#Create total egg count: 
matched_only_df <- matched_only_df %>%
  mutate(
total_egg = sm_egg_count + sh_egg_count
)

#Scale watercontact variable 

# create total time variable. Replace "h" with ":" and calculate total time
matched_only_df$total_time <- as.numeric(difftime(
  as.POSIXct(gsub("h", ":", matched_only_df$Endsamplingtime), format = "%H:%M"),
  as.POSIXct(gsub("h", ":", matched_only_df$BegeningTimesampling), format = "%H:%M"),
  units = "mins"
))

#Create scaled variable:
matched_only_df$Humanwatercontact <- as.numeric(matched_only_df$Humanwatercontact)
matched_only_df <- matched_only_df %>%
  mutate(scaled = Humanwatercontact / total_time)

matched_only_df <- matched_only_df %>%
  mutate(
    total_time = ifelse(is.na(total_time), 0, total_time),
    scaled = ifelse(is.na(scaled), 0, scaled))

#view(matched_only_df)

```


#EDA

```{r}
str(matched_only_df$sm_egg_count)
table(matched_only_df$sm_egg_count)
summary(matched_only_df$sm_egg_count)
```

###categorical 
```{r}

# Function to calculate summary statistics for a single categorical vector
categ_func_l <- function(value_l) {
  # N = Total number of non-empty, non-NA observations (including -9s but excluding true NAs/empty cells)
  N <- sum(!is.na(value_l) & value_l != "")
  
  # Remove NAs and invalid values (-9 in this example)
  valid_value_l <- value_l[!is.na(value_l) & value_l != -9]
  
  # Calculate frequency and proportion for valid responses
  freq_table_l <- table(valid_value_l)
  proportions_l <- round(freq_table_l / length(valid_value_l), 2)
  
  # Calculate the proportion of -9s and NAs
  prop_na_l <- round(sum(value_l == -9, na.rm = TRUE) / N, 2)
  
  # Create a data frame with the summary
  categorical_data_l <- data.frame(
    Value = names(freq_table_l),
    N = N,  # Total number of observations
    Frequency = as.vector(freq_table_l),  # Frequency of valid responses
    Proportion = as.vector(proportions_l),  # Proportion of valid responses
    prop_na = prop_na_l  # Proportion of -9s/NAs
  )
  
  return(categorical_data_l)
}

# Function to summarize multiple categorical variables by prefix
categ_summary_l <- function(data_l, prefixes_l) {
  summaries_l <- lapply(prefixes_l, function(prefix_l) {
    variable_data_l <- data_l %>%
      select(starts_with(prefix_l))
    
    # Pull the 'value' column and pass to categ_func_l
    value_l <- variable_data_l[[1]]
    summary_categ_l <- categ_func_l(value_l)
    summary_categ_l$Variable <- prefix_l  # Assign the prefix as the variable name
    
    # Reorder columns so Variable is first
    summary_categ_l <- summary_categ_l %>%
      select(Variable, everything())
    
    return(summary_categ_l)
  })
  
  categ_sum_set_l <- bind_rows(summaries_l)
  return(categ_sum_set_l)
}



```

####output

```{r}
# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}


# Define the prefixes
prefixes_categ <- c("hh_19_", "hh_31_", "hh_33_", "living_01", "living_03", "living_04")


# Recode the values for the variables
matched_only_df <- matched_only_df %>%
  mutate(
    hh_31_ = recode(
      hh_31_,
      `1` = "Graduated, studies completed",
      `2` = "Moving to the next class",
      `3` = "Failure, repetition",
      `4` = "Failure, dismissal",
      `5` = "Dropping out during the year"
    ),
    hh_33_ = recode(
      hh_33_,
      `1` = "Lower",
      `2` = "About the same",
      `3` = "Superior"
    ),
    living_01 = recode(
      living_01,
      `1` = "Interior tap",
      `2` = "Public tap",
      `3` = "Neighborâ€™s tap",
      `4` = "Protected well",
      `5` = "Unprotected well",
      `6` = "Drill hole",
      `7` = "Tanker service",
      `8` = "Water seller",
      `9` = "Source",
      `10` = "Stream",
      `99` = "Other"
    ),
    living_03 = recode(
      living_03,
      `1` = "Bleach/Aqua tabs",
      `2` = "Boil",
      `3` = "Filtration",
      `99` = "Other (to be specified)"
    ),
    living_04 = recode(
      living_04,
      `0` = "None/outside",
      `1` = "Flush with sewer",
      `2` = "Toilet flush with septic tank",
      `3` = "Bucket",
      `4` = "Covered pit latrines",
      `5` = "Uncovered pit latrines",
      `6` = "Improved latrines",
      `99` = "Others"
    ),
    hh_19_ = recode(
      hh_19_,
      `1` = "Lake",
      `2` = "Pond",
      `3` = "River",
      `4` = "Irrigation channel",
      `99` = "Other, give details"
    )
  )

# Generate categorical summary
output_categ <- as.data.frame(categ_summary_l(matched_only_df, prefixes_categ))
rownames(output_categ) <- NULL

# # Variable labels mapping
# variable_labels <- c(
#   "hh_19_" = "Source of water",
#   "hh_31_" = "Result achieved in academic year",
#   "hh_33_" = "Performance in class",
#   "living_01" = "Source of drinking water",
#   "living_03" = "How is water treated",
#   "living_04" = "Main type of toilet used"
# )
# # Rename variables using the labels
# Rename variables in the dataframe

output_categ <- output_categ %>%
  mutate(Variable = recode(Variable,
    "hh_19_" = "Source of water",
    "hh_31_" = "Result achieved in academic year",
    "hh_33_" = "Performance in class",
    "living_01" = "Source of drinking water",
    "living_03" = "How is water treated",
    "living_04" = "Main type of toilet used"
  ))


# output_categ <- output_categ %>%
#   rename(
#     `Missing` = prop_na
#   )

output_categ <- output_categ %>%
  select(-prop_na)

# Create the gt table
output_categ_gt <- gt(output_categ) %>%
  tab_header(
    title = "Categorical Variable Summary Statistics"
  )

output_categ_gt
gtsave(output_categ_gt, "categ_summary_stats.tex")


```


###binary 

```{r}
# Function to calculate summary statistics for a single vector (variable)
binary_func_l <- function(value) {

  # Calculate summary statistics for 0s and 1s
  binary_stats_l <- data.frame(
    N = round(sum(!is.na(value)), 2),
    Mean = round(mean(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    SD = round(sd(ifelse(value == -9, NA, value), na.rm = TRUE), 2),
    prop_na = round(sum(value == -9, na.rm = TRUE) / sum(!is.na(value)), 2)
  )
  
  return(binary_stats_l)
}

binary_summary_l <- function(baseline_data, prefixes) {
  # Loop over each prefix
  summaries_binary_l <- lapply(prefixes, function(prefix) {
    # Select the column that matches the prefix
    selected_data <- baseline_data %>%
      select(starts_with(prefix))
    
    # Pull the column values and pass to binary_func_l
    value <- selected_data[[1]]
    summary_stats <- binary_func_l(value)
    
    # Add the prefix (variable name) to the summary
    summary_stats$Variable <- prefix
    
          # Reorder columns so Variable_l is first
    summary_stats <- summary_stats %>%
      select(Variable, everything())
    
    return(summary_stats)
  })
  
  binary_sum_set_l <- bind_rows(summaries_binary_l)
  return(binary_sum_set_l)
}

```

####output

```{r}
# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}

prefixes_binary <- c("hh_gender_", "health_5_3_2_", "health_5_5_", "health_5_6_", "health_5_8_","health_5_9_", "hh_12_1_", "hh_12_2_", "hh_12_3_", "hh_12_4_", "hh_12_5_", "hh_12_6_", "hh_12_7_",  "hh_12_8_")

output_bin <- binary_summary_l(matched_only_df, prefixes_binary)

output_bin <- output_bin %>%
  mutate(Variable = recode(Variable,
    "hh_gender_" = "Gender",
    "health_5_3_2_" = "Had Bilharzia past 12 months",
    "health_5_5_" = "Received medication for Schisto past 12 months",
    "health_5_6_" = "Ever diagnosed with schisto",
    "health_5_8_" = "Blood in urine past 12 months?",
    "health_5_9_" = "Blood in stool past 12 months?",
    "hh_12_1_" = "Fetched water for HH",
    "hh_12_1_" = "Fetched water for HH",
    "hh_12_2_" = "Gave water to livestock",
    "hh_12_3_" = "Fetched water for agriculture",
    "hh_12_4_" = "Washed clothes",
    "hh_12_5_" = "Did the dishes",
    "hh_12_6_" = "Harvested aquatic vegetation",
    "hh_12_7_" = "Swam/bathed",
    "hh_12_8_" = "Played"
  ))


# output_bin <- output_bin %>%
#   rename(
#     `Missing` = prop_na
#   )

output_bin <- output_bin %>%
  select(-prop_na)

# Create the gt table
output_bin_gt <- gt(output_bin) %>%
  tab_header(
    title = "Binary Variable Summary Statistics"
  )

gtsave(output_bin_gt, "binary_summary_stats_table.tex")
output_bin_gt

```

####output village


```{r}

#Village level co-variates
# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}

# Ensure data is summarized at the village level for accuracy 
village_level_data <- matched_only_df %>%
  select(village_id, q_18, q_19, q_23, q_24, q_35_check, q_39, schisto_indicator) %>%
   distinct(village_id, .keep_all = TRUE)


prefixes_binary_vil <- c("q_18", "q_19", "q_23", "q_24", "q_35_check", "q_39", "schisto_indicator")

output_bin_vil <- binary_summary_l(village_level_data, prefixes_binary_vil)

output_bin_vil <- output_bin_vil %>%
  mutate(Variable = recode(Variable,
    "q_18" = "Educational facilities",
    "q_19" = "Health facilities",
    "q_23" = "Running drinking water for drinking",
    "q_24" = "Tap water system",
    "q_35_check" = "Deworming treatment carried out?",
    "q_39" = "Ongoing projects to reduce bilharzia?",
    "schisto_indicator" =  "Snails found with schisto"
     ))

# 
# output_bin_vil <- output_bin_vil %>%
#   rename(
#     `Missing` = prop_na
#   )

output_bin_vil <- output_bin_vil %>%
  select(-prop_na)

# Create the gt table
output_bin_vil_gt <- gt(output_bin_vil) %>%
  tab_header(
    title = "Village-level Binary Summary Statistics"
  )

gtsave(output_bin_vil_gt, "binary_vil_summary_stats.tex")
output_bin_vil_gt

```



###almost binary 

```{r}

# Function to calculate summary statistics for a single vector (variable)
almost_binary_func_l <- function(value) {
  
  # Ensure we're working with values 0, 1, and 2 only
  value <- value[value %in% c(0, 1, 2, -9)] 
  
  # Calculate summary statistics for 0s and 1s (exclude -9 and 2 for mean and SD)
  almost_binary_stats_l <- data.frame(
    N = round(sum(!is.na(value)), 2),  # N includes 0s, 1s, and 2s
    Mean = round(mean(ifelse(value == -9 | value == 2, NA, value), na.rm = TRUE), 2),  # Exclude 2s and -9 for mean
    SD = round(sd(ifelse(value == -9 | value == 2, NA, value), na.rm = TRUE), 2),  # Exclude 2s and -9 for SD
    Prop_na = round(sum(value == -9, na.rm = TRUE) / sum(!is.na(value)), 2)  # Proportion of NAs (-9)
  )
  
  # Calculate proportion of 2s
  proportion_dont_know <- data.frame(
    proportion_dont_know = round(mean(value == 2, na.rm = TRUE), 2)  # Proportion of "Don't know" (2)
  )
  
  # Combine results
  almost_binary_combined_stats_l <- cbind(almost_binary_stats_l, proportion_dont_know)
  
  return(almost_binary_combined_stats_l)
}

# Function to summarize multiple sets of variables by prefix
almost_binary_summary_l <- function(baseline_data, prefixes) {
  # Loop over each prefix
  summaries_almost_binary_l <- lapply(prefixes, function(prefix) {
    # Select the column that matches the prefix
    almost_binary_data_l <- baseline_data %>%
      select(starts_with(prefix))
    
    # Ensure only one column is selected for each prefix
 #Pull the column values and pass to almost_binary_func_l
    value <- almost_binary_data_l[[1]]
    almost_binary_summary_stats_l <- almost_binary_func_l(value)
    
    # Add the prefix (variable name) to the summary
    almost_binary_summary_stats_l$Variable <- prefix
    
        almost_binary_summary_stats_l <- almost_binary_summary_stats_l %>%
      select(Variable, everything())
    
    return(almost_binary_summary_stats_l)
  })
  
  # Combine all summaries into a single data frame
  almost_binary_sum_set_l <- bind_rows(summaries_almost_binary_l)
  return(almost_binary_sum_set_l)
}

```


```{r}


# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}

prefixes_almost_binary <- c("health_5_3_2_", "health_5_5_", "health_5_6_", "health_5_8_", "health_5_9_")

output_alm_bin <- almost_binary_summary_l(matched_only_df, prefixes_almost_binary)


output_alm_bin <- output_alm_bin %>%
  mutate(Variable = recode(Variable,
    "health_5_3_2_" = "Had Bilharzia past 12 months",
    "health_5_5_" = "Received medication for Schisto past 12 months",
    "health_5_6_" = "Ever diagnosed with schisto",
    "health_5_8_" = "Blood in urine past 12 months?",
    "health_5_9_" = "Blood in stool past 12 months?")
  )


output_alm_bin <- output_alm_bin %>%
  rename(
    `Missing` = Prop_na,
    `Don't know` = proportion_dont_know
  )

output_alm_bin <- output_alm_bin %>%
  select(-Missing)

colnames(output_alm_bin)


# Create the gt table
output_alm_bin_gt <- gt(output_alm_bin) %>%
  tab_header(
    title = "Binary Summary Statistics with 'I don't Know'"
  )

gtsave(output_alm_bin_gt, "almost_binary_summary_stats.tex")
output_alm_bin_gt


```



###numerical 


```{r}

# Function to calculate summary statistics for a single numeric vector
numerical_summary_func_l <- function(value) {
  
  # Calculate summary statistics for numeric variables
 numerical_stats_l <- data.frame(
  N = round(sum(!is.na(value)), 2),
  Min = round(min(ifelse(value == -9, NA, as.numeric(value)), na.rm = TRUE), 2),
  Mean = round(mean(ifelse(value == -9, NA, as.numeric(value)), na.rm = TRUE), 2),
  Max = sprintf("%.2f", max(ifelse(value == -9, NA, as.numeric(value)), na.rm = TRUE), 2),
  SD = round(sd(ifelse(value == -9, NA, as.numeric(value)), na.rm = TRUE), 2),
  prop_na = round(sum(value == -9 | is.na(value)) / length(value), 2)
)

  return(numerical_stats_l)
}

# Function to summarize multiple sets of numeric variables by prefix
numerical_summary_l <- function(baseline_data, prefixes) {
  # Loop over each prefix
  summaries_numerical_l <- lapply(prefixes, function(prefix) {
    # Select the column that matches the prefix
    numerical_data_l <- baseline_data %>%
      select(starts_with(prefix))
    
    # Pull the column values and pass to numerical_summary_func_l
    value <- numerical_data_l[[1]]
    numerical_summary_stats <- numerical_summary_func_l(value)
    
    # Add the prefix (variable name) to the summary
    numerical_summary_stats$Variable <- prefix
    
    numerical_summary_stats <- numerical_summary_stats %>%
      select(Variable, everything())
    
    return(numerical_summary_stats)
  })
  
  # Combine the summaries into a single data frame
  numerical_sum_set_l <- bind_rows(summaries_numerical_l)
  return(numerical_sum_set_l)
}


```


```{r}
# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}

prefixes_numerical <- c("wealthindex", "health_5_4_", "hh_age_")

output_num <- numerical_summary_l(matched_only_df, prefixes_numerical)


output_num <- output_num %>%
  mutate(Variable = recode(Variable,
    "wealthindex" = "Wealth index",
    "hh_age_" = "Age",
    "health_5_4_" = "Number of school days missed",
    "health_5_8_" = "Blood in urine past 12 months?",
    "health_5_9_" = "Blood in stool past 12 months?")
  )


# output_num <- output_num %>%
#   rename(
#     `Missing` = prop_na
#   )

output_num <- output_num %>%
  select(-prop_na)

# Create the gt table
output_num_gt <- gt(output_num) %>%
  tab_header(
    title = "Continuous Variable Summary Statistics"
  )

gtsave(output_num_gt, "continuous_summary_stats.tex")
output_num_gt


```

```{r}


# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}

# Ensure data is summarized at the village level for accuracy 
village_level_data_num <- matched_only_df %>%
  select(village_id, q_46, q_49, q_51, Cerratophyllummassg, Bulinus, Biomph, Humanwatercontact, scaled, InfectedBulinus, InfectedBiomphalaria) %>%
  distinct(village_id, .keep_all = TRUE)
#view(village_level_data_num)

prefixes_numerical_vil <- c("q_46", "q_49", "q_51", "Cerratophyllummassg", "Bulinus", "Biomph", "InfectedBulinus", "InfectedBiomphalaria","Humanwatercontact", "scaled")

output_num_vil <- numerical_summary_l(village_level_data_num, prefixes_numerical_vil)


output_num_vil <- output_num_vil %>%
  mutate(Variable = recode(Variable,
    "q_46" = "Minutes to nearest doctor by vehicle",
    "q_49" = "Nearest water point (km)",
    "q_51" = "Nearest health infrastructure (km)",
    "Cerratophyllummassg" = "Cerato mass",
    "Bulinus" = "Bulinus snail count",
    "Biomph"= "Biomphalaria snail count",
    "InfectedBulinus" = "Schisto-infected Bulinus snails",
    "InfectedBiomphalaria" ="Schisto-infected Biomphalaria snails",
    "Humanwatercontact" = "Human water contact during smapling",
    "scaled" =  "Proportion of human water contact to total time"
    )
  )


output_num_vil <- output_num_vil %>%
  rename(
    `Missing` = prop_na
  )

# Create the gt table
output_num_vil_gt <- gt(output_num_vil) %>%
  tab_header(
    title = "Village-level Continuous Variable Summary Statistics"
  )

gtsave(output_num_vil_gt, "continuous_village_summary_stats.tex")
output_num_vil_gt





```


#Variable notes:

-   health_5_3_2 = illness suffered? \_2 = chose Bilharzia
-   health_5_4 = how many days of school missed
-   health_5_5 = Has he/she received medication for schistosomiasis in the past 12 months?
-   health_5_6 = Ever diagnosed w/ schisto?
-   health_5_8 = blood in urine past 12 months?
-   health_5_9 = blood in stool past 12 months?
-   hh_11 = which water source
-   hh_12 = why person spent time near water source
-   hh_13_ = past 12 months, how many hours per week     spent near water source?
-   hh_18_ = past 7 days, how many hours spent near water source? 
-   hh_19_ = what source of water? 
      - lake, pond, river, irrigation channel, other
-   hh_29_ = what is highest level of education achieved
-   hh_30 = did they attend any school during 2022-23
-   hh_31_ = result acheived in academic year 
-   hh_33 = performace in class
-   hh_37 = had illness last 12 months
-   living_01 = source of drinking water
-   living_02 = is the water treated
-   living_03 = if so, how
-   living_04 = main type of toilet used
-   q_18 = 18.Educational facilities (e.g. school)
-   q_19 = Health facilities (e.g. health center)
-   q_23 = Running drinking water for drinking
-   q_24 = Tap water system (only if 23 = YES)
-   q_35_check = Was there any deworming treatment carried out by the Ministry of Health or another organization?
-   q_39 = In the village, are there currently any ongoing projects aimed at reducing the prevalence of bilharzia?
-   q_46 = How many minutes does it take to go to the nearest doctor by car/motorcycle?
-   q_49 = How far is the nearest water point (in kilometers)?
-   q_51 = How far is the nearest health infrastructure (in kilometers)?
-   Cerratophyllum mass = a measure of the amount of cerato (the species of plant we are interested in) at the water site (kgs)
-   Bulinus = count of the number of bulinus snails 
-   Biomph = count of the number of Biomphalaria snails
-   Human-water-contact = measure of human water contact during the sampling window
-   BegeningTimesampling = time sampling started for human water contact
-   Endsamplingtime = time sampling ended for human water contact
-   Schistoinfection = yes no if snails were infected with schistosomiasis 
-   InfectedBulinus = count of the number of infected Bulinus snails
-   InfectedBiomphalaria = count of the number of infected Biomphalaria snails


health_5_3_2_ = What type of illness or injury did he/she suffer from? (answer choice is Bilharzia) Binary
health_5_4_ = How many days did he/she miss work/school due to illness or injury in the past month? Numeric

##stargazer package reminders lol

output of regression table
 stargazer(production_reg,
           title ="Precision",
           type = "text",
           report = "vc*s",
           #model.numbers=FALSE,
           covariate.labels = c("Heat", "Male", "Time", "Heat X Time ", "Height", "Height (Missing)"),
           dep.var.labels = "",
           column.labels = regression_names,
           no.space = TRUE,
           column.sep.width = "3pt",
           se = production_reg_pvals,
           p = production_reg_pvals,
           omit.stat = c("f", "adj.rsq", "ser")
           omit = c("height_reg", "height_reg_miss")

#Regression 01


```{r}

############################ Bivariate Logistic Regression #####################################

# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}

model_01_data <- matched_only_df %>% 
  select(total_egg, sm_inf, sh_inf, health_5_3_2_,health_5_4_, hh_gender_, hh_age_, hh_29_, q_23, q_24, q_49, Cerratophyllummassg, schisto_indicator, scaled, Humanwatercontact, InfectedBulinus, InfectedBiomphalaria)

model_01_data <- model_01_data[complete.cases(model_01_data), ]
#(model_01_data)

## Selected covariates at the village level:
#view(matched_only_df)

# Specify the formula for logistic regression
formula_01_h <- sh_inf ~ health_5_3_2_ + health_5_4_ + hh_gender_ + hh_age_ +  hh_29_ + q_23 + q_24 + q_49 + Cerratophyllummassg + schisto_indicator + scaled + Humanwatercontact + InfectedBulinus + InfectedBiomphalaria
formula_01_m <- sm_inf ~ health_5_3_2_ + health_5_4_ + hh_gender_ + hh_age_ +  hh_29_ + q_23 + q_24 + q_49 + Cerratophyllummassg + schisto_indicator + scaled + Humanwatercontact + InfectedBulinus + InfectedBiomphalaria
formula_01_t <- total_egg ~ health_5_3_2_ + health_5_4_ + hh_gender_ + hh_age_ +  hh_29_ + q_23 + q_24 + q_49 + Cerratophyllummassg + schisto_indicator + scaled + Humanwatercontact + InfectedBulinus + InfectedBiomphalaria
# Run logistic regressions for S. haematobium and S. mansoni 
logit_model_01_h <- glm(formula_01_h, data = model_01_data, family = binomial)
logit_model_01_m <- glm(formula_01_m, data = model_01_data, family = binomial)

# Run OLS regression for Total Egg Count
ols_model_01_t <- lm(formula_01_t, data = model_01_data)

# Calculate McFadden's Pseudo R^2 for the logistic models
pseudo_r2_h_01 <- pR2(logit_model_01_h)["McFadden"]
pseudo_r2_h_01 <- ifelse(is.null(pseudo_r2_h_01) || is.na(pseudo_r2_h_01), "N/A", round(as.numeric(pseudo_r2_h_01), 4))

pseudo_r2_m_01 <- pR2(logit_model_01_m)["McFadden"]
pseudo_r2_m_01 <- ifelse(is.null(pseudo_r2_m_01) || is.na(pseudo_r2_m_01), "N/A", round(as.numeric(pseudo_r2_m_01), 4))

# Calculate BIC for both logistic models
bic_value_h_01 <- BIC(logit_model_01_h)
bic_value_m_01 <- BIC(logit_model_01_m)

# Calculate robust standard errors for the logistic models
robust_se_h_01 <- sqrt(diag(vcovHC(logit_model_01_h, type = "HC1")))
robust_se_m_01 <- sqrt(diag(vcovHC(logit_model_01_m, type = "HC1")))

# Calculate R-squared, Adjusted R-squared, and RMSE for the OLS model (total_egg)
r_squared_t_01 <- summary(ols_model_01_t)$r.squared
adj_r_squared_t_01 <- summary(ols_model_01_t)$adj.r.squared
rmse_t_01 <- sqrt(mean(residuals(ols_model_01_t)^2))

# Calculate BIC for the OLS model
bic_value_t_01 <- BIC(ols_model_01_t)

# Calculate robust standard errors for the OLS model
robust_se_t_01 <- sqrt(diag(vcovHC(ols_model_01_t, type = "HC1")))

# Display summary of both logistic models and the OLS model using stargazer
logit_models_done_01 <- stargazer(logit_model_01_h, logit_model_01_m, ols_model_01_t,
          covariate.labels = c("Percieved infection", "Missed school days", "Sex", "Age", "Education level"),
          title = "Regression Models 01: S.mansoni & S. haematobium Infections",
          type = "latex",
          digit.separator = "",
          no.space = TRUE,
          column.sep.width = "3pt",
          dep.var.labels = c("S. h", 
                             "S. m", 
                             "\\makecell{{S.h + S.m} \\\\ \\ {egg count}}"),
          omit = c("q_23", "q_24", "q_49", "Cerratophyllummassg", "schisto_indicator", 
           "scaled", "Humanwatercontact", "InfectedBulinus", "InfectedBiomphalaria"),
          se = list(robust_se_h_01, robust_se_m_01, robust_se_t_01),
          omit.stat = c("f", "adj.rsq", "rsq", "ll", "aic", "ser"),
          add.lines = list(
            c("Pseudo $R^2$", pseudo_r2_h, pseudo_r2_m, "N/A"),  # For OLS (not applicable)
            c("BIC", round(bic_value_h_01, 2), round(bic_value_m_01, 2), round(bic_value_t_01, 2)),
            c("$R^2$", "", "", round(r_squared_t_01, 4)),
            c("Adjusted $R^2$", "", "", round(adj_r_squared_t_01, 4)),
            c("RMSE", "", "", round(rmse_t_01, 4))),
           notes = "Note: the following Variables are included as village-level covariates: Has running water, Has tap water system, Distance to nearest water point, Cerato mass, Snails actually have schisto, Scaled time spent in water, Human water contact, Infected bulinus snails, and infected Biomphalaria snails."
)
# q_24, q_49, Cerratophyllummassg, schisto_indicator, scaled, Humanwatercontact, InfectedBulinus, and InfectedBiomphalaria are included as village-level covariates.

cat(logit_models_done_01, sep = '\n', file = 'logit_modeles_01_table.tex')

```

##Confusion matricies 01




```{r}

path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}


#view(matched_only_df)

# Generate predicted probabilities for each model
predicted_probs_h_01 <- predict(logit_model_01_h, type = "response")
predicted_probs_m_01 <- predict(logit_model_01_m, type = "response")
predicted_probs_t_01 <- predict(ols_model_01_t, type = "response")  # Assuming binary output from OLS


# Define thresholds
thresholds_01 <- seq(0, 1, by = 0.1)
# Define a threshold for Total_egg (you can adjust this based on your data)
threshold_egg <- 5  # Example threshold - Create a binary version of the Total_egg variable
binary_total_egg <- ifelse(model_01_data$total_egg > threshold_egg, 1, 0)

# Function to compute confusion matrix and errors for a given model
compute_confusion_01 <- function(predicted_probs_01, actual_values_01, thresholds_01) {
  errors_01 <- sapply(thresholds_01, function(t_01) {
    predictions_01 <- ifelse(predicted_probs_01 > t_01, 1, 0)
    
    # Convert both to factors with the same levels
    confusion_matrix_01 <- table(
      factor(predictions_01, levels = c(0, 1)),
      factor(actual_values_01, levels = c(0, 1))
    )
    
    # Avoid subscript out of bounds by checking if the matrix has both rows/columns
    if (all(dim(confusion_matrix_01) == c(2, 2))) {
      fnr_01 <- confusion_matrix_01[2, 1] / sum(confusion_matrix_01[, 1])  # FN / (FN + TP)
      fpr_01 <- confusion_matrix_01[1, 2] / sum(confusion_matrix_01[, 2])  # FP / (FP + TN)
    } else {
      fnr_01 <- NA
      fpr_01 <- NA
    }
    
    return(fnr_01 + fpr_01)
  })
  
  optimal_threshold_01 <- thresholds_01[which.min(errors_01)]
  
  # Generate confusion matrix at optimal threshold
  predictions_optimal_01 <- ifelse(predicted_probs_01 > optimal_threshold_01, 1, 0)
  confusion_matrix_optimal_01 <- table(
    Predicted_01 = predictions_optimal_01, 
    Actual_01 = actual_values_01
  )
  
  return(list(confusion_matrix_optimal_01 = confusion_matrix_optimal_01, optimal_threshold_01 = optimal_threshold_01))
}

# Apply the function to each model
results_h_01 <- compute_confusion_01(predicted_probs_h_01, model_01_data$sh_inf, thresholds_01)
results_m_01 <- compute_confusion_01(predicted_probs_m_01, model_01_data$sm_inf, thresholds_01)
results_t_01 <- compute_confusion_01(predicted_probs_t_01, binary_total_egg, thresholds_01)

# Combine confusion matrices into a single LaTeX table
combined_matrix_01 <- rbind(
  cbind(Model_01 = "Logit Model H", as.matrix(results_h_01$confusion_matrix_optimal_01)),
  cbind(Model_01 = "Logit Model M", as.matrix(results_m_01$confusion_matrix_optimal_01)),
  cbind(Model_01 = "OLS Model T", as.matrix(results_t_01$confusion_matrix_optimal_01))
)

# Add row and column names for clarity
# rownames(combined_matrix_01) <- c(
#   "Logit H", "Logit H",  # These will correspond to the rows for Logit H model
#   "Logit M", "Logit M",  # These will correspond to the rows for Logit M model
#   "OLS T", "OLS T"  # These will correspond to the rows for OLS T model
# )

colnames(combined_matrix_01) <- c("Model:", "Predicted: Class 0", "Predicted: Class 1")

# Output to LaTeX
latex_combined_01 <- xtable(combined_matrix_01, 
                            caption = "Combined Confusion Matrices for Three Models", 
                            label = "tab:combined_confusion_matrices_01")
print(latex_combined_01, include.rownames = FALSE, include.colnames = TRUE, file = 'confusion_matrices_01.tex')

# Print optimal thresholds for each model
cat("Optimal Thresholds:\n")
cat("Logit Model H:", results_h_01$optimal_threshold_01, "\n")
cat("Logit Model M:", results_m_01$optimal_threshold_01, "\n")
cat("OLS Model T:", results_t_01$optimal_threshold_01, "\n")


#cat(latex_combined_01, sep = '\n', file = 'confusion_matrices_01.tex')


```























```{r}

## Confusion matrix
# This code is evaluating the classification performance of a logistic regression model (logit_model_01_h) by:
# 
# 1) Generating predicted probabilities of the target variable.
# 2) Using thresholds (from 0 to 1) to classify predictions as 1 (positive) or 0 (negative).
# 3) Creating confusion matrices at each threshold to calculate false negative rates (FNR) and false positive rates (FPR).
# 4) Computing a combined error metric (FNR + FPR) for each threshold to find the optimal threshold for minimizing prediction errors.

# A confusion matrix compares the predicted classifications (predictions) to the actual outcomes (matched_only_df$sh_inf):
          # True Positives (TP): Correctly predicted infected.
          # True Negatives (TN): Correctly predicted not infected.
          # False Positives (FP): Predicted infected but not infected.
          # False Negatives (FN): Predicted not infected but actually infected.
          # False Negative Rate (FNR): Proportion of actual positives classified as negatives.
          # False Positive Rate (FPR): Proportion of actual negatives classified as positives.
# Define possible paths
# path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
# path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
# 
# # set the working directory
# if (dir.exists(path1)) {
#   setwd(path1)
# } else if (dir.exists(path2)) {
#   setwd(path2)
# }
# 
# 
# # Generate predicted probabilities for each model
# predicted_probs_h_01 <- predict(logit_model_01_h, type = "response")
# predicted_probs_m_01 <- predict(logit_model_01_m, type = "response")
# predicted_probs_t_01 <- predict(ols_model_01_t, type = "response")  # Assuming binary output from OLS
# 
# 
# # Define thresholds
# thresholds_01 <- seq(0, 1, by = 0.1)
# 
# # Function to compute confusion matrix and errors for a given model
# compute_confusion_01 <- function(predicted_probs_01, actual_values_01, thresholds_01) {
#   errors_01 <- sapply(thresholds_01, function(t_01) {
#     predictions_01 <- ifelse(predicted_probs_01 > t_01, 1, 0)
#     
#     # Create a complete confusion matrix
#     confusion_matrix_01 <- table(
#       factor(predictions_01, levels = c(0, 1)),
#       factor(actual_values_01, levels = c(0, 1))
#     )
#     
#     # Avoid subscript out of bounds by checking if the matrix has both rows/columns
#     if (all(dim(confusion_matrix_01) == c(2, 2))) {
#       fnr_01 <- confusion_matrix_01[2, 1] / sum(confusion_matrix_01[, 1])  # FN / (FN + TP)
#       fpr_01 <- confusion_matrix_01[1, 2] / sum(confusion_matrix_01[, 2])  # FP / (FP + TN)
#     } else {
#       fnr_01 <- NA
#       fpr_01 <- NA
#     }
#     
#     return(fnr_01 + fpr_01)
#   })
#   
#   optimal_threshold_01 <- thresholds_01[which.min(errors_01)]
#   
#   # Generate confusion matrix at optimal threshold
#   predictions_optimal_01 <- ifelse(predicted_probs_01 > optimal_threshold_01, 1, 0)
#   confusion_matrix_optimal_01 <- table(
#     Predicted_01 = predictions_optimal_01, 
#     Actual_01 = actual_values_01
#   )
#   
#   return(list(confusion_matrix_optimal_01 = confusion_matrix_optimal_01, optimal_threshold_01 = optimal_threshold_01))
# }
# 
# # Apply the function to each model
# results_h_01 <- compute_confusion_01(predicted_probs_h_01, matched_only_df$sh_inf, thresholds_01)
# results_m_01 <- compute_confusion_01(predicted_probs_m_01, matched_only_df$sh_inf, thresholds_01)
# results_t_01 <- compute_confusion_01(predicted_probs_t_01, matched_only_df$sh_inf, thresholds_01)
# 
# # Combine confusion matrices into a single LaTeX table
# combined_matrix_01 <- rbind(
#   cbind(Model_01 = "Logit Model H", as.matrix(results_h_01$confusion_matrix_optimal_01)),
#   cbind(Model_01 = "Logit Model M", as.matrix(results_m_01$confusion_matrix_optimal_01)),
#   cbind(Model_01 = "OLS Model T", as.matrix(results_t_01$confusion_matrix_optimal_01))
# )
# 
# # Add row and column names for clarity
# rownames(combined_matrix_01) <- c(
#   "Logit H - Actual: Class 0", "Logit H - Actual: Class 1",
#   "Logit M - Actual: Class 0", "Logit M - Actual: Class 1",
#   "OLS T - Actual: Class 0", "OLS T - Actual: Class 1"
# )
# colnames(combined_matrix_01) <- c("Model_01", "Predicted: Class 0", "Predicted: Class 1")
# 
# # Output to LaTeX
# latex_combined_01 <- xtable(combined_matrix_01, 
#                             caption = "Combined Confusion Matrices for Three Models", 
#                             label = "tab:combined_confusion_matrices_01")
# print(latex_combined_01, include.rownames = TRUE, include.colnames = TRUE)
# 
# # Print optimal thresholds for each model
# cat("Optimal Thresholds:\n")
# cat("Logit Model H:", results_h_01$optimal_threshold_01, "\n")
# cat("Logit Model M:", results_m_01$optimal_threshold_01, "\n")
# cat("OLS Model T:", results_t_01$optimal_threshold_01, "\n")
# 
# 
# 



```

```{r}


# generate predicted probabilities
# predicted_probs_01 <- predict(logit_model_01_h, type = "response")
# 
# # define thresholds
# thresholds_01 <- seq(0, 1, by = 0.1)
# 
# # iterate over thresholds and calculate errors
# errors_01 <- sapply(thresholds, function(t) {
#   predictions_01 <- ifelse(predicted_probs_01 > t, 1, 0)
#   
#   # Create a complete confusion matrix
#   confusion_matrix_01 <- table(
#     factor(predictions, levels = c(0, 1)), 
#     factor(matched_only_df$sh_inf, levels = c(0, 1))
#   )
#   
#   # Avoid subscript out of bounds by checking if the matrix has both rows/columns
#   if (all(dim(confusion_matrix_01) == c(2, 2))) {
#     fnr <- confusion_matrix_01[2, 1] / sum(confusion_matrix_01[, 1])  # FN / (FN + TP)
#     fpr <- confusion_matrix_01[1, 2] / sum(confusion_matrix_01[, 2])  # FP / (FP + TN)
#   } else {
#     # If any row/column is missing, set FNR/FPR to NA or a default value
#     fnr_01 <- NA
#     fpr_01 <- NA
#   }
#   
#   return(fnr_01 + fpr_01)
# })
# 
# # identify the optimal threshold
# optimal_threshold_01 <- thresholds[which.min(errors)]
# 
# 
# 
# 
# # validate results
# predictions_optimal_01 <- ifelse(predicted_probs_01 > optimal_threshold_01, 1, 0)
# confusion_matrix_optimal_h_01 <- table(Predicted_01 = predictions_optimal_01, Actual = matched_only_df$sh_inf)
# 
# rownames(confusion_matrix_optimal_h_01) <- c("Actual: Class 0", "Actual: Class 1")
# colnames(confusion_matrix_optimal_h_01) <- c("Predicted: Class 0", "Predicted: Class 1")
# 
# latex_confusion_01 <- xtable(confusion_matrix_optimal_01, 
#                           caption = "S. haematobium Confusion Matrix", 
#                           label = "tab:confusion_matrix_optimal_h_01")
# 
# cat("Optimal Threshold:", optimal_threshold_01, "\n")
# print(confusion_matrix_optimal_01)
# 
# 
# 
# print(latex_confusion_01, include.rownames = TRUE, include.colnames = TRUE, type = "latex", file = "latex_confusion_01.tex")


```


#Bivariate Logistic regression 02



```{r}

# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}
# Specify the formula for logistic regression
formula_02_h <- sh_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ +
formula_02_m <- sm_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_
formula_02_t <- total_egg ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_
# Run logistic regressions for S. haematobium and S. mansoni
logit_model_02_h <- glm(formula_02_h, data = matched_only_df, family = binomial)
logit_model_02_m <- glm(formula_02_m, data = matched_only_df, family = binomial)

# Run OLS regression for Total Egg Count
ols_model_02_t <- lm(formula_02_t, data = matched_only_df)

# Calculate McFadden's Pseudo R^2 for the logistic models
pseudo_r2_h_02 <- pR2(logit_model_02_h)["McFadden"]
pseudo_r2_h_02 <- ifelse(is.null(pseudo_r2_h_02) || is.na(pseudo_r2_h_02), "N/A", round(as.numeric(pseudo_r2_h_02), 4))

pseudo_r2_m_02 <- pR2(logit_model_02_m)["McFadden"]
pseudo_r2_m_02 <- ifelse(is.null(pseudo_r2_m_02) || is.na(pseudo_r2_m_02), "N/A", round(as.numeric(pseudo_r2_m_02), 4))

# Calculate BIC for both logistic models
bic_value_h_02 <- BIC(logit_model_02_h)
bic_value_m_02 <- BIC(logit_model_02_m)

# Calculate robust standard errors for the logistic models
robust_se_h_02 <- sqrt(diag(vcovHC(logit_model_02_h, type = "HC1")))
robust_se_m_02 <- sqrt(diag(vcovHC(logit_model_02_m, type = "HC1")))

# Calculate R-squared, Adjusted R-squared, and RMSE for the OLS model (total_egg)
r_squared_t_02 <- summary(ols_model_02_t)$r.squared
adj_r_squared_t_02 <- summary(ols_model_02_t)$adj.r.squared
rmse_t_02 <- sqrt(mean(residuals(ols_model_02_t)^2))

# Calculate BIC for the OLS model
bic_value_t_02 <- BIC(ols_model_02_t)

# Calculate robust standard errors for the OLS model
robust_se_t_02 <- sqrt(diag(vcovHC(ols_model_02_t, type = "HC1")))

# Display summary of both logistic models and the OLS model using stargazer
logit_models_done_02 <- stargazer(logit_model_02_h, logit_model_02_m, ols_model_02_t,
          covariate.labels = c("Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia"),
          type = "latex",
          digit.separator = "",
          no.space = TRUE,
          column.sep.width = "3pt",
          dep.var.labels = c("S. haematobium", "S. mansoni", "Total egg count"),
          omit.stat = c("f", "adj.rsq"),
          se = list(robust_se_h_02, robust_se_m_02, robust_se_t_02),
          add.lines = list(
            c("Pseudo $R^2$", pseudo_r2_h, pseudo_r2_m, "N/A"),  # For OLS (not applicable)
            c("BIC", round(bic_value_h_02, 2), round(bic_value_m_02, 2), round(bic_value_t_02, 2)),
            c("R-squared", "", "", round(r_squared_t_02, 4)),
            c("Adjusted R-squared", "", "", round(adj_r_squared_t_02, 4)),
            c("RMSE", "", "", round(rmse_t_02, 4))
          )
)

cat(logit_models_done_02, sep = '\n', file = 'logit_modeles_02_table.tex')

# Confidence intervals for OLS model (coefficients and standard errors)
conf_int_02_t <- confint(ols_model_02_t)

# Combine the odds ratios with their confidence intervals for logistic models
CI_odds_02_h <- data.frame(Odds_Ratio = odds_ratios_02_h, 
                           CI_Lower = conf_int_odds_ratios_02_h[, 1], 
                           CI_Upper = conf_int_odds_ratios_02_h[, 2])

CI_odds_02_m <- data.frame(Odds_Ratio = odds_ratios_02_m, 
                           CI_Lower = conf_int_odds_ratios_02_m[, 1], 
                           CI_Upper = conf_int_odds_ratios_02_m[, 2])


# Display odds ratios with confidence intervals using stargazer
stargazer(CI_odds_02_h, CI_odds_02_m,
          type = "latex",
          out = "CI_odds_02_h_m.tex")

# Display coefficients with confidence intervals for the OLS model
CI_coeff_02_t <- data.frame(Coefficient = coefficients_02_t,
                            CI_Lower = conf_int_02_t[, 1],
                            CI_Upper = conf_int_02_t[, 2])

stargazer(CI_coeff_02_t,
          type = "latex",
          out = "CI_coeff_02_t.tex")

```




```{r}
# setwd("C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis")
# 
# # Specify the formula for logistic regression
# formula_02 <- sh_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_
# 
# # Run the logistic regression
# logit_model_02 <- glm(formula, data = matched_only_df, family = binomial)
# 
# pseudo2_r2 <- pR2(logit_model_02)["McFadden"]
# pseudo2_r2 <- ifelse(is.null(pseudo2_r2) || is.na(pseudo2_r2), "N/A", round(as.numeric(pseudo2_r2), 4))
# 
# # Calculate BIC
# bic_value2 <- BIC(logit_model_02)
# 
# robust_se2 <- sqrt(diag(vcovHC(logit_model_02, type = "HC1")))
# # Display summary of the model
# logit_model_02_done <- stargazer(logit_model_02,  
#           covariate.labels = c("Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia"),
#           #dep.var.labels = "",
#           type = "latex", 
#           digit.separator = "",
#           no.space = TRUE,
#           column.sep.width = "3pt",
#           omit.stat = c("f", "adj.rsq"),
#           se = list(robust_se2),
#           add.lines = list(c("Pseudo $R^2$", round(pseudo2_r2, 4)),
#                             c("BIC", round(bic_value2, 2)))
#          )
# 
# 
# cat(logit_model_02_done, sep = '\n', file = 'logit_model_02_table.tex')
# 
# # Extract coefficients
# coefficients_02 <- coef(logit_model_02)
# 
# # Calculate odds ratios
# odds_ratios_02 <- exp(coefficients_02)
# 
# # Display odds ratios in long format for better readability 
# odds_ratios_long_02 <- data.frame(
#   Variable = c("Intercept", 
#                "Perceived infection", 
#                "Missed school days", 
#                "Received medication", 
#                "Ever diagnosed with Bilharzia"),
#   Odds_Ratio = odds_ratios_02
# )
# 
# # Use stargazer for a "long" table
# stargazer(odds_ratios_long_02,
#           summary = FALSE,   # Suppresses summary statistics
#           type = "latex",
#           rownames = FALSE, #Removes row numbers
#           out = "odds_ratios_02.tex")
# 
# # Calculate confidence intervals for coefficients
# conf_int <- confint(logit_model_02)
# 
# # Exponentiate to get confidence intervals for odds ratios
# conf_int_odds_ratios_02 <- exp(conf_int)
# 
# # Display odds ratios with confidence intervals
# CI_odds_02 <- data.frame(Odds_Ratio = odds_ratios_02, 
#            CI_Lower = conf_int_odds_ratios_02[, 1], 
#            CI_Upper = conf_int_odds_ratios_02[, 2])
# 
# stargazer(CI_odds_02,
#           type = "latex",
#           out = "CI_odds_02.tex")
```



#Bivariate Logistic regression 03



```{r}
# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}

# Specify the formula for logistic regression
formula_03_h <- sh_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ 
formula_03_m <- sm_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ 
formula_03_t <- total_egg ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ 
# Run logistic regressions for S. haematobium and S. mansoni
logit_model_03_h <- glm(formula_03_h, data = matched_only_df, family = binomial)
logit_model_03_m <- glm(formula_03_m, data = matched_only_df, family = binomial)

# Run OLS regression for Total Egg Count
ols_model_03_t <- lm(formula_03_t, data = matched_only_df)

# Calculate McFadden's Pseudo R^2 for the logistic models
pseudo_r2_h_03 <- pR2(logit_model_03_h)["McFadden"]
pseudo_r2_h_03 <- ifelse(is.null(pseudo_r2_h_03) || is.na(pseudo_r2_h_03), "N/A", round(as.numeric(pseudo_r2_h_03), 4))

pseudo_r2_m_03 <- pR2(logit_model_03_m)["McFadden"]
pseudo_r2_m_03 <- ifelse(is.null(pseudo_r2_m_03) || is.na(pseudo_r2_m_03), "N/A", round(as.numeric(pseudo_r2_m_03), 4))

# Calculate BIC for both logistic models
bic_value_h_03 <- BIC(logit_model_03_h)
bic_value_m_03 <- BIC(logit_model_03_m)

# Calculate robust standard errors for the logistic models
robust_se_h_03 <- sqrt(diag(vcovHC(logit_model_03_h, type = "HC1")))
robust_se_m_03 <- sqrt(diag(vcovHC(logit_model_03_m, type = "HC1")))

# Calculate R-squared, Adjusted R-squared, and RMSE for the OLS model (total_egg)
r_squared_t_03 <- summary(ols_model_03_t)$r.squared
adj_r_squared_t_03 <- summary(ols_model_03_t)$adj.r.squared
rmse_t_03 <- sqrt(mean(residuals(ols_model_03_t)^2))

# Calculate BIC for the OLS model
bic_value_t_03 <- BIC(ols_model_03_t)

# Calculate robust standard errors for the OLS model
robust_se_t_03 <- sqrt(diag(vcovHC(ols_model_03_t, type = "HC1")))

covariate_labels_03 <- c("Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine", "Blood in stool")

# Display summary of both logistic models and the OLS model using stargazer
logit_models_done_03 <- stargazer(logit_model_03_h, logit_model_03_m, ols_model_03_t,
          covariate.labels = covariate_labels_03,
          type = "latex",
          digit.separator = "",
          no.space = TRUE,
          column.sep.width = "3pt",
          dep.var.labels = c("S. haematobium", "S. mansoni", "Total egg count"),
          omit.stat = c("f", "adj.rsq"),
          se = list(robust_se_h_03, robust_se_m_03, robust_se_t_03),
          add.lines = list(
            c("Pseudo $R^2$", pseudo_r2_h, pseudo_r2_m, "N/A"),  # For OLS (not applicable)
            c("BIC", round(bic_value_h_03, 2), round(bic_value_m_03, 2), round(bic_value_t_03, 2)),
            c("R-squared", "", "", round(r_squared_t_03, 4)),
            c("Adjusted R-squared", "", "", round(adj_r_squared_t_03, 4)),
            c("RMSE", "", "", round(rmse_t_03, 4))
          )
)

cat(logit_models_done_03, sep = '\n', file = 'logit_modeles_03_table.tex')
#out = "logit_model_03_table.tex"
# Extract coefficients

# Logistic regression model for S. haematobium (logit_model_03_h)
# Extract coefficients for the first model
# coefficients_03_h <- coef(logit_model_03_h)
# odds_ratios_03_h <- exp(coefficients_03_h)

# Logistic regression model for S. mansoni (logit_model_03_m)
# Extract coefficients for the second model
# coefficients_03_m <- coef(logit_model_03_m)
# odds_ratios_03_m <- exp(coefficients_03_m)
# 
# # OLS model for Total Egg Count (ols_model_03_t)
# # Extract coefficients for the OLS model
# coefficients_03_t <- coef(ols_model_03_t)
# 
# # Create data frames for odds ratios and coefficients (long format)
# odds_ratios_long_03_h <- data.frame(
#  Variable = c("Intercept", 
#                "Percieved infection",
#                "Missed school days",
#                "Recived medication",
#                "Ever diagnosed with Bilharzia",
#                "Blood in urine",
#                "Blood in stool"),
#   Odds_Ratio = odds_ratios_03_h
# )
# 
# odds_ratios_long_03_m <- data.frame(
# Variable = c("Intercept", 
#                "Percieved infection",
#                "Missed school days",
#                "Recived medication",
#                "Ever diagnosed with Bilharzia",
#                "Blood in urine",
#                "Blood in stool"),
#   Odds_Ratio = odds_ratios_03_m
# )
# 
# coefficients_long_03_t <- data.frame(
#  Variable = c("Intercept", 
#                "Percieved infection",
#                "Missed school days",
#                "Recived medication",
#                "Ever diagnosed with Bilharzia",
#                "Blood in urine",
#                "Blood in stool"),
#   Coefficient = coefficients_03_t
# )
# 
# # Use stargazer to create latex tables for odds ratios and coefficients
# stargazer(odds_ratios_long_03_h, odds_ratios_long_03_m,
#           summary = FALSE,   # Suppress summary statistics
#           type = "latex",
#           rownames = FALSE,   # Remove row numbers
#           out = "odds_ratios_03_h_m.tex")

# Calculate confidence intervals for logistic models
conf_int_03_h <- confint(logit_model_03_h)
conf_int_odds_ratios_03_h <- exp(conf_int_03_h)

conf_int_03_m <- confint(logit_model_03_m)
conf_int_odds_ratios_03_m <- exp(conf_int_03_m)

# Confidence intervals for OLS model (coefficients and standard errors)
conf_int_03_t <- confint(ols_model_03_t)

# Combine the odds ratios with their confidence intervals for logistic models
CI_odds_03_h <- data.frame(Odds_Ratio = odds_ratios_03_h, 
                           CI_Lower = conf_int_odds_ratios_03_h[, 1], 
                           CI_Upper = conf_int_odds_ratios_03_h[, 2])

CI_odds_03_m <- data.frame(Odds_Ratio = odds_ratios_03_m, 
                           CI_Lower = conf_int_odds_ratios_03_m[, 1], 
                           CI_Upper = conf_int_odds_ratios_03_m[, 2])


# Display odds ratios with confidence intervals using stargazer
stargazer(CI_odds_03_h, CI_odds_03_m,
          type = "latex",
          out = "CI_odds_03_h_m.tex")

# Display coefficients with confidence intervals for the OLS model
CI_coeff_03_t <- data.frame(Coefficient = coefficients_03_t,
                            CI_Lower = conf_int_03_t[, 1],
                            CI_Upper = conf_int_03_t[, 2])

stargazer(CI_coeff_03_t,
          type = "latex",
          out = "CI_coeff_03_t.tex")

```


#Bivariate Logistic regression 04


```{r}
# Define possible paths
path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"

# set the working directory
if (dir.exists(path1)) {
  setwd(path1)
} else if (dir.exists(path2)) {
  setwd(path2)
}

# Specify the formula for logistic regression
formula_04_h <- sh_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ + hh_gender_ + hh_ethnicity_ + hh_12_1_ + hh_12_2_ + hh_12_3_ + hh_12_4_ + hh_12_5_ + hh_12_6_ + hh_12_7_ + hh_12_8_ + hh_31_ + hh_33_ + hh_37_ + living_01 + living_02 + living_04  + wealthindex
formula_04_m <- sm_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ + hh_gender_ + hh_ethnicity_ + hh_12_1_ + hh_12_2_ + hh_12_3_ + hh_12_4_ + hh_12_5_ + hh_12_6_ + hh_12_7_ + hh_12_8_ + hh_31_ + hh_33_ + hh_37_ + living_01 + living_02 + living_04  + wealthindex
formula_04_t <- total_egg ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ + hh_gender_ + hh_ethnicity_ + hh_12_1_ + hh_12_2_ + hh_12_3_ + hh_12_4_ + hh_12_5_ + hh_12_6_ + hh_12_7_ + hh_12_8_ + hh_31_ + hh_33_ + hh_37_ + living_01 + living_02 + living_04  + wealthindex
# Run logistic regressions for S. haematobium and S. mansoni
logit_model_04_h <- glm(formula_04_h, data = matched_only_df, family = binomial)
logit_model_04_m <- glm(formula_04_m, data = matched_only_df, family = binomial)

# Run OLS regression for Total Egg Count
ols_model_04_t <- lm(formula_04_t, data = matched_only_df)

# Calculate McFadden's Pseudo R^2 for the logistic models
pseudo_r2_h_04 <- pR2(logit_model_04_h)["McFadden"]
pseudo_r2_h_04 <- ifelse(is.null(pseudo_r2_h_04) || is.na(pseudo_r2_h_04), "N/A", round(as.numeric(pseudo_r2_h_04), 4))

pseudo_r2_m_04 <- pR2(logit_model_04_m)["McFadden"]
pseudo_r2_m_04 <- ifelse(is.null(pseudo_r2_m_04) || is.na(pseudo_r2_m_04), "N/A", round(as.numeric(pseudo_r2_m_04), 4))

# Calculate BIC for both logistic models
bic_value_h_04 <- BIC(logit_model_04_h)
bic_value_m_04 <- BIC(logit_model_04_m)

# Calculate robust standard errors for the logistic models
robust_se_h_04 <- sqrt(diag(vcovHC(logit_model_04_h, type = "HC1")))
robust_se_m_04 <- sqrt(diag(vcovHC(logit_model_04_m, type = "HC1")))

# Calculate R-squared, Adjusted R-squared, and RMSE for the OLS model (total_egg)
r_squared_t_04 <- summary(ols_model_04_t)$r.squared
adj_r_squared_t_04 <- summary(ols_model_04_t)$adj.r.squared
rmse_t_04 <- sqrt(mean(residuals(ols_model_04_t)^2))

# Calculate BIC for the OLS model
bic_value_t_04 <- BIC(ols_model_04_t)

# Calculate robust standard errors for the OLS model
robust_se_t_04 <- sqrt(diag(vcovHC(ols_model_04_t, type = "HC1")))

covariate_labels_04 <- c("Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine", "Blood in stool", "Gender", "Ethnicity", "Fetch water for HH", "water for Livestock", "Fetch water for ag", "Wash clothes", "Do the dishes", "harvest aquatic veg", "Swim/bathe", "Play", "Grade achieved in 2022/2023", "Academic performance", "School missed", "Source of drinking water supply", "Water treated?", "Type of toilet", "wealth index")

# Display summary of both logistic models and the OLS model using stargazer
logit_models_done_04 <- stargazer(logit_model_04_h, logit_model_04_m, ols_model_04_t,
          covariate.labels = covariate_labels_04,
          type = "latex",
          digit.separator = "",
          no.space = TRUE,
          column.sep.width = "3pt",
          dep.var.labels = c("S. haematobium", "S. mansoni", "Total egg count"),
          omit.stat = c("f", "adj.rsq"),
          se = list(robust_se_h_04, robust_se_m_04, robust_se_t_04),
          add.lines = list(
            c("Pseudo $R^2$", pseudo_r2_h, pseudo_r2_m, "N/A"),  # For OLS (not applicable)
            c("BIC", round(bic_value_h_04, 2), round(bic_value_m_04, 2), round(bic_value_t_04, 2)),
            c("R-squared", "", "", round(r_squared_t_04, 4)),
            c("Adjusted R-squared", "", "", round(adj_r_squared_t_04, 4)),
            c("RMSE", "", "", round(rmse_t_04, 4))
          )
)

cat(logit_models_done_04, sep = '\n', file = 'logit_modeles_04_table.tex')
#out = "logit_model_04_table.tex"
# Extract coefficients

# Logistic regression model for S. haematobium (logit_model_04_h)
# Extract coefficients for the first model
# coefficients_04_h <- coef(logit_model_04_h)
# odds_ratios_04_h <- exp(coefficients_04_h)
# 
# # Logistic regression model for S. mansoni (logit_model_04_m)
# # Extract coefficients for the second model
# coefficients_04_m <- coef(logit_model_04_m)
# odds_ratios_04_m <- exp(coefficients_04_m)
# 
# # OLS model for Total Egg Count (ols_model_04_t)
# # Extract coefficients for the OLS model
# coefficients_04_t <- coef(ols_model_04_t)
# 
# # Create data frames for odds ratios and coefficients (long format)
# odds_ratios_long_04_h <- data.frame(
#  Variable = c("Intercept", "Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine","Blood in stool", "Gender", "Ethnicity", "Fetch water for HH", "water for Livestock", "Fetch water for ag", "Wash clothes", "Do the dishes", "harvest aquatic veg", "Swim/bathe", "Play", "Grade achieved in 2022/2023", "Academic performance", "School missed", "Source of drinking water supply", "Water treated?", "Type of toilet", "wealth index"),
#   Odds_Ratio = odds_ratios_04_h
# )
# 
# odds_ratios_long_04_m <- data.frame(
#  Variable = c("Intercept", "Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine","Blood in stool", "Gender", "Ethnicity", "Fetch water for HH", "water for Livestock", "Fetch water for ag", "Wash clothes", "Do the dishes", "harvest aquatic veg", "Swim/bathe", "Play", "Grade achieved in 2022/2023", "Academic performance", "School missed", "Source of drinking water supply", "Water treated?", "Type of toilet", "wealth index"),
#   Odds_Ratio = odds_ratios_04_m
# )
# 
# coefficients_long_04_t <- data.frame(
#  Variable = c("Intercept", "Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine","Blood in stool", "Gender", "Ethnicity", "Fetch water for HH", "water for Livestock", "Fetch water for ag", "Wash clothes", "Do the dishes", "harvest aquatic veg", "Swim/bathe", "Play", "Grade achieved in 2022/2023", "Academic performance", "School missed", "Source of drinking water supply", "Water treated?", "Type of toilet", "wealth index"),
#   Coefficient = coefficients_04_t
# )
# 
# # Use stargazer to create latex tables for odds ratios and coefficients
# stargazer(odds_ratios_long_04_h, odds_ratios_long_04_m,
#           summary = FALSE,   # Suppress summary statistics
#           type = "latex",
#           rownames = FALSE,   # Remove row numbers
#           out = "odds_ratios_04_h_m.tex")

# Calculate confidence intervals for logistic models
conf_int_04_h <- confint(logit_model_04_h)
conf_int_odds_ratios_04_h <- exp(conf_int_04_h)

conf_int_04_m <- confint(logit_model_04_m)
conf_int_odds_ratios_04_m <- exp(conf_int_04_m)

# Confidence intervals for OLS model (coefficients and standard errors)
conf_int_04_t <- confint(ols_model_04_t)

# Combine the odds ratios with their confidence intervals for logistic models
CI_odds_04_h <- data.frame(Odds_Ratio = odds_ratios_04_h, 
                           CI_Lower = conf_int_odds_ratios_04_h[, 1], 
                           CI_Upper = conf_int_odds_ratios_04_h[, 2])

CI_odds_04_m <- data.frame(Odds_Ratio = odds_ratios_04_m, 
                           CI_Lower = conf_int_odds_ratios_04_m[, 1], 
                           CI_Upper = conf_int_odds_ratios_04_m[, 2])


# Display odds ratios with confidence intervals using stargazer
stargazer(CI_odds_04_h, CI_odds_04_m,
          type = "latex",
          out = "CI_odds_04_h_m.tex")

# Display coefficients with confidence intervals for the OLS model
CI_coeff_04_t <- data.frame(Coefficient = coefficients_04_t,
                            CI_Lower = conf_int_04_t[, 1],
                            CI_Upper = conf_int_04_t[, 2])

stargazer(CI_coeff_04_t,
          type = "latex",
          out = "CI_coeff_04_t.tex")
```





##old codes

```{r}

#Old code of model 01 - contains odd ratios 

# Define possible paths
# path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
# path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
# 
# # set the working directory
# if (dir.exists(path1)) {
#   setwd(path1)
# } else if (dir.exists(path2)) {
#   setwd(path2)
# }
# 
# ## Selected covariates at the village level:
# 
# 
# # Specify the formula for logistic regression
# formula_01_h <- sh_inf ~ health_5_3_2_ + health_5_4_ 
# formula_01_m <- sm_inf ~ health_5_3_2_ + health_5_4_ 
# formula_01_t <- total_egg ~ health_5_3_2_ + health_5_4_ 
# # Run logistic regressions for S. haematobium and S. mansoni
# logit_model_01_h <- glm(formula_01_h, data = matched_only_df, family = binomial)
# logit_model_01_m <- glm(formula_01_m, data = matched_only_df, family = binomial)
# 
# # Run OLS regression for Total Egg Count
# ols_model_01_t <- lm(formula_01_t, data = matched_only_df)
# 
# # Calculate McFadden's Pseudo R^2 for the logistic models
# pseudo_r2_h_01 <- pR2(logit_model_01_h)["McFadden"]
# pseudo_r2_h_01 <- ifelse(is.null(pseudo_r2_h_01) || is.na(pseudo_r2_h_01), "N/A", round(as.numeric(pseudo_r2_h_01), 4))
# 
# pseudo_r2_m_01 <- pR2(logit_model_01_m)["McFadden"]
# pseudo_r2_m_01 <- ifelse(is.null(pseudo_r2_m_01) || is.na(pseudo_r2_m_01), "N/A", round(as.numeric(pseudo_r2_m_01), 4))
# 
# # Calculate BIC for both logistic models
# bic_value_h_01 <- BIC(logit_model_01_h)
# bic_value_m_01 <- BIC(logit_model_01_m)
# 
# # Calculate robust standard errors for the logistic models
# robust_se_h_01 <- sqrt(diag(vcovHC(logit_model_01_h, type = "HC1")))
# robust_se_m_01 <- sqrt(diag(vcovHC(logit_model_01_m, type = "HC1")))
# 
# # Calculate R-squared, Adjusted R-squared, and RMSE for the OLS model (total_egg)
# r_squared_t_01 <- summary(ols_model_01_t)$r.squared
# adj_r_squared_t_01 <- summary(ols_model_01_t)$adj.r.squared
# rmse_t_01 <- sqrt(mean(residuals(ols_model_01_t)^2))
# 
# # Calculate BIC for the OLS model
# bic_value_t_01 <- BIC(ols_model_01_t)
# 
# # Calculate robust standard errors for the OLS model
# robust_se_t_01 <- sqrt(diag(vcovHC(ols_model_01_t, type = "HC1")))
# 
# # Display summary of both logistic models and the OLS model using stargazer
# logit_models_done_01 <- stargazer(logit_model_01_h, logit_model_01_m, ols_model_01_t,
#           covariate.labels = c("Percieved infection", "Missed school days"),
#           type = "latex",
#           digit.separator = "",
#           no.space = TRUE,
#           column.sep.width = "3pt",
#           dep.var.labels = c("S. haematobium", "S. mansoni", "Total egg count"),
#           omit.stat = c("f", "adj.rsq"),
#           se = list(robust_se_h_01, robust_se_m_01, robust_se_t_01),
#           add.lines = list(
#             c("Pseudo $R^2$", pseudo_r2_h, pseudo_r2_m, "N/A"),  # For OLS (not applicable)
#             c("BIC", round(bic_value_h_01, 2), round(bic_value_m_01, 2), round(bic_value_t_01, 2)),
#             c("R-squared", "", "", round(r_squared_t_01, 4)),
#             c("Adjusted R-squared", "", "", round(adj_r_squared_t_01, 4)),
#             c("RMSE", "", "", round(rmse_t_01, 4))
#           )
# )
# 
# cat(logit_models_done_01, sep = '\n', file = 'logit_modeles_01_table.tex')
# #out = "logit_model_01_table.tex"
# # Extract coefficients
# 
# # Logistic regression model for S. haematobium (logit_model_01_h)
# # Extract coefficients for the first model
# coefficients_01_h <- coef(logit_model_01_h)
# odds_ratios_01_h <- exp(coefficients_01_h)
# 
# # Logistic regression model for S. mansoni (logit_model_01_m)
# # Extract coefficients for the second model
# coefficients_01_m <- coef(logit_model_01_m)
# odds_ratios_01_m <- exp(coefficients_01_m)
# 
# # OLS model for Total Egg Count (ols_model_01_t)
# # Extract coefficients for the OLS model
# coefficients_01_t <- coef(ols_model_01_t)
# 
# # # Create data frames for odds ratios and coefficients (long format)
# # odds_ratios_long_01_h <- data.frame(
# #   Variable = c("Intercept", 
# #                "Perceived infection", 
# #                "Missed school days"),
# #   Odds_Ratio = odds_ratios_01_h
# # )
# # 
# # odds_ratios_long_01_m <- data.frame(
# #   Variable = c("Intercept", 
# #                "Perceived infection", 
# #                "Missed school days"),
# #   Odds_Ratio = odds_ratios_01_m
# # )
# # 
# # coefficients_long_01_t <- data.frame(
# #   Variable = c("Intercept", 
# #                "Perceived infection", 
# #                "Missed school days"),
# #   Coefficient = coefficients_01_t
# # )
# # 
# # # Use stargazer to create latex tables for odds ratios and coefficients
# # stargazer(odds_ratios_long_01_h, odds_ratios_long_01_m,
# #           summary = FALSE,   # Suppress summary statistics
# #           type = "latex",
# #           rownames = FALSE,   # Remove row numbers
# #           out = "odds_ratios_01_h_m.tex")
# 
# # Calculate confidence intervals for logistic models
# conf_int_01_h <- confint(logit_model_01_h)
# conf_int_odds_ratios_01_h <- exp(conf_int_01_h)
# 
# conf_int_01_m <- confint(logit_model_01_m)
# conf_int_odds_ratios_01_m <- exp(conf_int_01_m)
# 
# # Confidence intervals for OLS model (coefficients and standard errors)
# conf_int_01_t <- confint(ols_model_01_t)
# 
# # Combine the odds ratios with their confidence intervals for logistic models
# CI_odds_01_h <- data.frame(Odds_Ratio = odds_ratios_01_h, 
#                            CI_Lower = conf_int_odds_ratios_01_h[, 1], 
#                            CI_Upper = conf_int_odds_ratios_01_h[, 2])
# 
# CI_odds_01_m <- data.frame(Odds_Ratio = odds_ratios_01_m, 
#                            CI_Lower = conf_int_odds_ratios_01_m[, 1], 
#                            CI_Upper = conf_int_odds_ratios_01_m[, 2])
# 
# 
# # Display odds ratios with confidence intervals using stargazer
# stargazer(CI_odds_01_h, CI_odds_01_m,
#           type = "latex",
#           out = "CI_odds_01_h_m.tex")
# 
# # Display coefficients with confidence intervals for the OLS model
# CI_coeff_01_t <- data.frame(Coefficient = coefficients_01_t,
#                             CI_Lower = conf_int_01_t[, 1],
#                             CI_Upper = conf_int_01_t[, 2])
# 
# stargazer(CI_coeff_01_t,
#           type = "latex",
#           out = "CI_coeff_01_t.tex")

```


```{r}
#Regression 2:

# # Define possible paths
# path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
# path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
# 
# # set the working directory
# if (dir.exists(path1)) {
#   setwd(path1)
# } else if (dir.exists(path2)) {
#   setwd(path2)
# }
# # Specify the formula for logistic regression
# formula_02_h <- sh_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_
# formula_02_m <- sm_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_
# formula_02_t <- total_egg ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_
# # Run logistic regressions for S. haematobium and S. mansoni
# logit_model_02_h <- glm(formula_02_h, data = matched_only_df, family = binomial)
# logit_model_02_m <- glm(formula_02_m, data = matched_only_df, family = binomial)
# 
# # Run OLS regression for Total Egg Count
# ols_model_02_t <- lm(formula_02_t, data = matched_only_df)
# 
# # Calculate McFadden's Pseudo R^2 for the logistic models
# pseudo_r2_h_02 <- pR2(logit_model_02_h)["McFadden"]
# pseudo_r2_h_02 <- ifelse(is.null(pseudo_r2_h_02) || is.na(pseudo_r2_h_02), "N/A", round(as.numeric(pseudo_r2_h_02), 4))
# 
# pseudo_r2_m_02 <- pR2(logit_model_02_m)["McFadden"]
# pseudo_r2_m_02 <- ifelse(is.null(pseudo_r2_m_02) || is.na(pseudo_r2_m_02), "N/A", round(as.numeric(pseudo_r2_m_02), 4))
# 
# # Calculate BIC for both logistic models
# bic_value_h_02 <- BIC(logit_model_02_h)
# bic_value_m_02 <- BIC(logit_model_02_m)
# 
# # Calculate robust standard errors for the logistic models
# robust_se_h_02 <- sqrt(diag(vcovHC(logit_model_02_h, type = "HC1")))
# robust_se_m_02 <- sqrt(diag(vcovHC(logit_model_02_m, type = "HC1")))
# 
# # Calculate R-squared, Adjusted R-squared, and RMSE for the OLS model (total_egg)
# r_squared_t_02 <- summary(ols_model_02_t)$r.squared
# adj_r_squared_t_02 <- summary(ols_model_02_t)$adj.r.squared
# rmse_t_02 <- sqrt(mean(residuals(ols_model_02_t)^2))
# 
# # Calculate BIC for the OLS model
# bic_value_t_02 <- BIC(ols_model_02_t)
# 
# # Calculate robust standard errors for the OLS model
# robust_se_t_02 <- sqrt(diag(vcovHC(ols_model_02_t, type = "HC1")))
# 
# # Display summary of both logistic models and the OLS model using stargazer
# logit_models_done_02 <- stargazer(logit_model_02_h, logit_model_02_m, ols_model_02_t,
#           covariate.labels = c("Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia"),
#           type = "latex",
#           digit.separator = "",
#           no.space = TRUE,
#           column.sep.width = "3pt",
#           dep.var.labels = c("S. haematobium", "S. mansoni", "Total egg count"),
#           omit.stat = c("f", "adj.rsq"),
#           se = list(robust_se_h_02, robust_se_m_02, robust_se_t_02),
#           add.lines = list(
#             c("Pseudo $R^2$", pseudo_r2_h, pseudo_r2_m, "N/A"),  # For OLS (not applicable)
#             c("BIC", round(bic_value_h_02, 2), round(bic_value_m_02, 2), round(bic_value_t_02, 2)),
#             c("R-squared", "", "", round(r_squared_t_02, 4)),
#             c("Adjusted R-squared", "", "", round(adj_r_squared_t_02, 4)),
#             c("RMSE", "", "", round(rmse_t_02, 4))
#           )
# )
# 
# cat(logit_models_done_02, sep = '\n', file = 'logit_modeles_02_table.tex')
# #out = "logit_model_02_table.tex"
# 
# #>>>>>****>>>> Extract coefficients <<<<<****<<<<<
# 
# # # Logistic regression model for S. haematobium (logit_model_02_h)
# # # Extract coefficients for the first model
# # coefficients_02_h <- coef(logit_model_02_h)
# # odds_ratios_02_h <- exp(coefficients_02_h)
# # 
# # # Logistic regression model for S. mansoni (logit_model_02_m)
# # # Extract coefficients for the second model
# # coefficients_02_m <- coef(logit_model_02_m)
# # odds_ratios_02_m <- exp(coefficients_02_m)
# # 
# # # OLS model for Total Egg Count (ols_model_02_t)
# # # Extract coefficients for the OLS model
# # coefficients_02_t <- coef(ols_model_02_t)
# # 
# # # Create data frames for odds ratios and coefficients (long format)
# # odds_ratios_long_02_h <- data.frame(
# #  Variable = c("Intercept", 
# #                "Perceived infection", 
# #                "Missed school days", 
# #                "Received medication", 
# #                "Ever diagnosed with Bilharzia"),
# #   Odds_Ratio = odds_ratios_02_h
# # )
# # 
# # odds_ratios_long_02_m <- data.frame(
# #   Variable = c("Intercept", 
# #                "Perceived infection", 
# #                "Missed school days", 
# #                "Received medication", 
# #                "Ever diagnosed with Bilharzia"),
# #   Odds_Ratio = odds_ratios_02_m
# # )
# # 
# # coefficients_long_02_t <- data.frame(
# #   Variable = c("Intercept", 
# #                "Perceived infection", 
# #                "Missed school days", 
# #                "Received medication", 
# #                "Ever diagnosed with Bilharzia"),
# #   Coefficient = coefficients_02_t
# # )
# # 
# # # Use stargazer to create latex tables for odds ratios and coefficients
# # stargazer(odds_ratios_long_02_h, odds_ratios_long_02_m,
# #           summary = FALSE,   # Suppress summary statistics
# #           type = "latex",
# #           rownames = FALSE,   # Remove row numbers
# #           out = "odds_ratios_02_h_m.tex")
# 
# # Calculate confidence intervals for logistic models
# # conf_int_02_h <- confint(logit_model_02_h)
# # conf_int_odds_ratios_02_h <- exp(conf_int_02_h)
# # 
# # conf_int_02_m <- confint(logit_model_02_m)
# # conf_int_odds_ratios_02_m <- exp(conf_int_02_m)
# 
# # Confidence intervals for OLS model (coefficients and standard errors)
# conf_int_02_t <- confint(ols_model_02_t)
# 
# # Combine the odds ratios with their confidence intervals for logistic models
# CI_odds_02_h <- data.frame(Odds_Ratio = odds_ratios_02_h, 
#                            CI_Lower = conf_int_odds_ratios_02_h[, 1], 
#                            CI_Upper = conf_int_odds_ratios_02_h[, 2])
# 
# CI_odds_02_m <- data.frame(Odds_Ratio = odds_ratios_02_m, 
#                            CI_Lower = conf_int_odds_ratios_02_m[, 1], 
#                            CI_Upper = conf_int_odds_ratios_02_m[, 2])
# 
# 
# # Display odds ratios with confidence intervals using stargazer
# stargazer(CI_odds_02_h, CI_odds_02_m,
#           type = "latex",
#           out = "CI_odds_02_h_m.tex")
# 
# # Display coefficients with confidence intervals for the OLS model
# CI_coeff_02_t <- data.frame(Coefficient = coefficients_02_t,
#                             CI_Lower = conf_int_02_t[, 1],
#                             CI_Upper = conf_int_02_t[, 2])
# 
# stargazer(CI_coeff_02_t,
#           type = "latex",
#           out = "CI_coeff_02_t.tex")

```



```{r}
#Model 03

# # Define possible paths
# path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
# path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
# 
# # set the working directory
# if (dir.exists(path1)) {
#   setwd(path1)
# } else if (dir.exists(path2)) {
#   setwd(path2)
# }
# 
# # Specify the formula for logistic regression
# formula_03_h <- sh_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ 
# formula_03_m <- sm_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ 
# formula_03_t <- total_egg ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ 
# # Run logistic regressions for S. haematobium and S. mansoni
# logit_model_03_h <- glm(formula_03_h, data = matched_only_df, family = binomial)
# logit_model_03_m <- glm(formula_03_m, data = matched_only_df, family = binomial)
# 
# # Run OLS regression for Total Egg Count
# ols_model_03_t <- lm(formula_03_t, data = matched_only_df)
# 
# # Calculate McFadden's Pseudo R^2 for the logistic models
# pseudo_r2_h_03 <- pR2(logit_model_03_h)["McFadden"]
# pseudo_r2_h_03 <- ifelse(is.null(pseudo_r2_h_03) || is.na(pseudo_r2_h_03), "N/A", round(as.numeric(pseudo_r2_h_03), 4))
# 
# pseudo_r2_m_03 <- pR2(logit_model_03_m)["McFadden"]
# pseudo_r2_m_03 <- ifelse(is.null(pseudo_r2_m_03) || is.na(pseudo_r2_m_03), "N/A", round(as.numeric(pseudo_r2_m_03), 4))
# 
# # Calculate BIC for both logistic models
# bic_value_h_03 <- BIC(logit_model_03_h)
# bic_value_m_03 <- BIC(logit_model_03_m)
# 
# # Calculate robust standard errors for the logistic models
# robust_se_h_03 <- sqrt(diag(vcovHC(logit_model_03_h, type = "HC1")))
# robust_se_m_03 <- sqrt(diag(vcovHC(logit_model_03_m, type = "HC1")))
# 
# # Calculate R-squared, Adjusted R-squared, and RMSE for the OLS model (total_egg)
# r_squared_t_03 <- summary(ols_model_03_t)$r.squared
# adj_r_squared_t_03 <- summary(ols_model_03_t)$adj.r.squared
# rmse_t_03 <- sqrt(mean(residuals(ols_model_03_t)^2))
# 
# # Calculate BIC for the OLS model
# bic_value_t_03 <- BIC(ols_model_03_t)
# 
# # Calculate robust standard errors for the OLS model
# robust_se_t_03 <- sqrt(diag(vcovHC(ols_model_03_t, type = "HC1")))
# 
# covariate_labels_03 <- c("Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine", "Blood in stool")
# 
# # Display summary of both logistic models and the OLS model using stargazer
# logit_models_done_03 <- stargazer(logit_model_03_h, logit_model_03_m, ols_model_03_t,
#           covariate.labels = covariate_labels_03,
#           type = "latex",
#           digit.separator = "",
#           no.space = TRUE,
#           column.sep.width = "3pt",
#           dep.var.labels = c("S. haematobium", "S. mansoni", "Total egg count"),
#           omit.stat = c("f", "adj.rsq"),
#           se = list(robust_se_h_03, robust_se_m_03, robust_se_t_03),
#           add.lines = list(
#             c("Pseudo $R^2$", pseudo_r2_h, pseudo_r2_m, "N/A"),  # For OLS (not applicable)
#             c("BIC", round(bic_value_h_03, 2), round(bic_value_m_03, 2), round(bic_value_t_03, 2)),
#             c("R-squared", "", "", round(r_squared_t_03, 4)),
#             c("Adjusted R-squared", "", "", round(adj_r_squared_t_03, 4)),
#             c("RMSE", "", "", round(rmse_t_03, 4))
#           )
# )
# 
# cat(logit_models_done_03, sep = '\n', file = 'logit_modeles_03_table.tex')
# #out = "logit_model_03_table.tex"
# # Extract coefficients
# 
# # Logistic regression model for S. haematobium (logit_model_03_h)
# # Extract coefficients for the first model
# # coefficients_03_h <- coef(logit_model_03_h)
# # odds_ratios_03_h <- exp(coefficients_03_h)
# 
# # Logistic regression model for S. mansoni (logit_model_03_m)
# # Extract coefficients for the second model
# # coefficients_03_m <- coef(logit_model_03_m)
# # odds_ratios_03_m <- exp(coefficients_03_m)
# # 
# # # OLS model for Total Egg Count (ols_model_03_t)
# # # Extract coefficients for the OLS model
# # coefficients_03_t <- coef(ols_model_03_t)
# # 
# # # Create data frames for odds ratios and coefficients (long format)
# # odds_ratios_long_03_h <- data.frame(
# #  Variable = c("Intercept", 
# #                "Percieved infection",
# #                "Missed school days",
# #                "Recived medication",
# #                "Ever diagnosed with Bilharzia",
# #                "Blood in urine",
# #                "Blood in stool"),
# #   Odds_Ratio = odds_ratios_03_h
# # )
# # 
# # odds_ratios_long_03_m <- data.frame(
# # Variable = c("Intercept", 
# #                "Percieved infection",
# #                "Missed school days",
# #                "Recived medication",
# #                "Ever diagnosed with Bilharzia",
# #                "Blood in urine",
# #                "Blood in stool"),
# #   Odds_Ratio = odds_ratios_03_m
# # )
# # 
# # coefficients_long_03_t <- data.frame(
# #  Variable = c("Intercept", 
# #                "Percieved infection",
# #                "Missed school days",
# #                "Recived medication",
# #                "Ever diagnosed with Bilharzia",
# #                "Blood in urine",
# #                "Blood in stool"),
# #   Coefficient = coefficients_03_t
# # )
# # 
# # # Use stargazer to create latex tables for odds ratios and coefficients
# # stargazer(odds_ratios_long_03_h, odds_ratios_long_03_m,
# #           summary = FALSE,   # Suppress summary statistics
# #           type = "latex",
# #           rownames = FALSE,   # Remove row numbers
# #           out = "odds_ratios_03_h_m.tex")
# 
# # Calculate confidence intervals for logistic models
# conf_int_03_h <- confint(logit_model_03_h)
# conf_int_odds_ratios_03_h <- exp(conf_int_03_h)
# 
# conf_int_03_m <- confint(logit_model_03_m)
# conf_int_odds_ratios_03_m <- exp(conf_int_03_m)
# 
# # Confidence intervals for OLS model (coefficients and standard errors)
# conf_int_03_t <- confint(ols_model_03_t)
# 
# # Combine the odds ratios with their confidence intervals for logistic models
# CI_odds_03_h <- data.frame(Odds_Ratio = odds_ratios_03_h, 
#                            CI_Lower = conf_int_odds_ratios_03_h[, 1], 
#                            CI_Upper = conf_int_odds_ratios_03_h[, 2])
# 
# CI_odds_03_m <- data.frame(Odds_Ratio = odds_ratios_03_m, 
#                            CI_Lower = conf_int_odds_ratios_03_m[, 1], 
#                            CI_Upper = conf_int_odds_ratios_03_m[, 2])
# 
# 
# # Display odds ratios with confidence intervals using stargazer
# stargazer(CI_odds_03_h, CI_odds_03_m,
#           type = "latex",
#           out = "CI_odds_03_h_m.tex")
# 
# # Display coefficients with confidence intervals for the OLS model
# CI_coeff_03_t <- data.frame(Coefficient = coefficients_03_t,
#                             CI_Lower = conf_int_03_t[, 1],
#                             CI_Upper = conf_int_03_t[, 2])
# 
# stargazer(CI_coeff_03_t,
#           type = "latex",
#           out = "CI_coeff_03_t.tex")

```



```{r}

# Model 04:

# Define possible paths
# path1 <- "C:/Users/km978/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
# path2 <- "C:/Users/Kateri/Downloads/SenegalGIT/Latex_Output/Parasitological_Predictive_Analysis"
# 
# # set the working directory
# if (dir.exists(path1)) {
#   setwd(path1)
# } else if (dir.exists(path2)) {
#   setwd(path2)
# }
# 
# # Specify the formula for logistic regression
# formula_04_h <- sh_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ + hh_gender_ + hh_ethnicity_ + hh_12_1_ + hh_12_2_ + hh_12_3_ + hh_12_4_ + hh_12_5_ + hh_12_6_ + hh_12_7_ + hh_12_8_ + hh_31_ + hh_33_ + hh_37_ + living_01 + living_02 + living_04  + wealthindex
# formula_04_m <- sm_inf ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ + hh_gender_ + hh_ethnicity_ + hh_12_1_ + hh_12_2_ + hh_12_3_ + hh_12_4_ + hh_12_5_ + hh_12_6_ + hh_12_7_ + hh_12_8_ + hh_31_ + hh_33_ + hh_37_ + living_01 + living_02 + living_04  + wealthindex
# formula_04_t <- total_egg ~ health_5_3_2_ + health_5_4_ + health_5_5_ + health_5_6_ + health_5_8_ + health_5_9_ + hh_gender_ + hh_ethnicity_ + hh_12_1_ + hh_12_2_ + hh_12_3_ + hh_12_4_ + hh_12_5_ + hh_12_6_ + hh_12_7_ + hh_12_8_ + hh_31_ + hh_33_ + hh_37_ + living_01 + living_02 + living_04  + wealthindex
# # Run logistic regressions for S. haematobium and S. mansoni
# logit_model_04_h <- glm(formula_04_h, data = matched_only_df, family = binomial)
# logit_model_04_m <- glm(formula_04_m, data = matched_only_df, family = binomial)
# 
# # Run OLS regression for Total Egg Count
# ols_model_04_t <- lm(formula_04_t, data = matched_only_df)
# 
# # Calculate McFadden's Pseudo R^2 for the logistic models
# pseudo_r2_h_04 <- pR2(logit_model_04_h)["McFadden"]
# pseudo_r2_h_04 <- ifelse(is.null(pseudo_r2_h_04) || is.na(pseudo_r2_h_04), "N/A", round(as.numeric(pseudo_r2_h_04), 4))
# 
# pseudo_r2_m_04 <- pR2(logit_model_04_m)["McFadden"]
# pseudo_r2_m_04 <- ifelse(is.null(pseudo_r2_m_04) || is.na(pseudo_r2_m_04), "N/A", round(as.numeric(pseudo_r2_m_04), 4))
# 
# # Calculate BIC for both logistic models
# bic_value_h_04 <- BIC(logit_model_04_h)
# bic_value_m_04 <- BIC(logit_model_04_m)
# 
# # Calculate robust standard errors for the logistic models
# robust_se_h_04 <- sqrt(diag(vcovHC(logit_model_04_h, type = "HC1")))
# robust_se_m_04 <- sqrt(diag(vcovHC(logit_model_04_m, type = "HC1")))
# 
# # Calculate R-squared, Adjusted R-squared, and RMSE for the OLS model (total_egg)
# r_squared_t_04 <- summary(ols_model_04_t)$r.squared
# adj_r_squared_t_04 <- summary(ols_model_04_t)$adj.r.squared
# rmse_t_04 <- sqrt(mean(residuals(ols_model_04_t)^2))
# 
# # Calculate BIC for the OLS model
# bic_value_t_04 <- BIC(ols_model_04_t)
# 
# # Calculate robust standard errors for the OLS model
# robust_se_t_04 <- sqrt(diag(vcovHC(ols_model_04_t, type = "HC1")))
# 
# covariate_labels_04 <- c("Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine", "Blood in stool", "Gender", "Ethnicity", "Fetch water for HH", "water for Livestock", "Fetch water for ag", "Wash clothes", "Do the dishes", "harvest aquatic veg", "Swim/bathe", "Play", "Grade achieved in 2022/2023", "Academic performance", "School missed", "Source of drinking water supply", "Water treated?", "Type of toilet", "wealth index")
# 
# # Display summary of both logistic models and the OLS model using stargazer
# logit_models_done_04 <- stargazer(logit_model_04_h, logit_model_04_m, ols_model_04_t,
#           covariate.labels = covariate_labels_04,
#           type = "latex",
#           digit.separator = "",
#           no.space = TRUE,
#           column.sep.width = "3pt",
#           dep.var.labels = c("S. haematobium", "S. mansoni", "Total egg count"),
#           omit.stat = c("f", "adj.rsq"),
#           se = list(robust_se_h_04, robust_se_m_04, robust_se_t_04),
#           add.lines = list(
#             c("Pseudo $R^2$", pseudo_r2_h, pseudo_r2_m, "N/A"),  # For OLS (not applicable)
#             c("BIC", round(bic_value_h_04, 2), round(bic_value_m_04, 2), round(bic_value_t_04, 2)),
#             c("R-squared", "", "", round(r_squared_t_04, 4)),
#             c("Adjusted R-squared", "", "", round(adj_r_squared_t_04, 4)),
#             c("RMSE", "", "", round(rmse_t_04, 4))
#           )
# )
# 
# cat(logit_models_done_04, sep = '\n', file = 'logit_modeles_04_table.tex')
# #out = "logit_model_04_table.tex"
# # Extract coefficients
# 
# # Logistic regression model for S. haematobium (logit_model_04_h)
# # Extract coefficients for the first model
# # coefficients_04_h <- coef(logit_model_04_h)
# # odds_ratios_04_h <- exp(coefficients_04_h)
# # 
# # # Logistic regression model for S. mansoni (logit_model_04_m)
# # # Extract coefficients for the second model
# # coefficients_04_m <- coef(logit_model_04_m)
# # odds_ratios_04_m <- exp(coefficients_04_m)
# # 
# # # OLS model for Total Egg Count (ols_model_04_t)
# # # Extract coefficients for the OLS model
# # coefficients_04_t <- coef(ols_model_04_t)
# # 
# # # Create data frames for odds ratios and coefficients (long format)
# # odds_ratios_long_04_h <- data.frame(
# #  Variable = c("Intercept", "Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine","Blood in stool", "Gender", "Ethnicity", "Fetch water for HH", "water for Livestock", "Fetch water for ag", "Wash clothes", "Do the dishes", "harvest aquatic veg", "Swim/bathe", "Play", "Grade achieved in 2022/2023", "Academic performance", "School missed", "Source of drinking water supply", "Water treated?", "Type of toilet", "wealth index"),
# #   Odds_Ratio = odds_ratios_04_h
# # )
# # 
# # odds_ratios_long_04_m <- data.frame(
# #  Variable = c("Intercept", "Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine","Blood in stool", "Gender", "Ethnicity", "Fetch water for HH", "water for Livestock", "Fetch water for ag", "Wash clothes", "Do the dishes", "harvest aquatic veg", "Swim/bathe", "Play", "Grade achieved in 2022/2023", "Academic performance", "School missed", "Source of drinking water supply", "Water treated?", "Type of toilet", "wealth index"),
# #   Odds_Ratio = odds_ratios_04_m
# # )
# # 
# # coefficients_long_04_t <- data.frame(
# #  Variable = c("Intercept", "Percieved infection", "Missed school days", "Recived medication", "Ever diagnosed with Bilharzia", "Blood in urine","Blood in stool", "Gender", "Ethnicity", "Fetch water for HH", "water for Livestock", "Fetch water for ag", "Wash clothes", "Do the dishes", "harvest aquatic veg", "Swim/bathe", "Play", "Grade achieved in 2022/2023", "Academic performance", "School missed", "Source of drinking water supply", "Water treated?", "Type of toilet", "wealth index"),
# #   Coefficient = coefficients_04_t
# # )
# # 
# # # Use stargazer to create latex tables for odds ratios and coefficients
# # stargazer(odds_ratios_long_04_h, odds_ratios_long_04_m,
# #           summary = FALSE,   # Suppress summary statistics
# #           type = "latex",
# #           rownames = FALSE,   # Remove row numbers
# #           out = "odds_ratios_04_h_m.tex")
# 
# # Calculate confidence intervals for logistic models
# conf_int_04_h <- confint(logit_model_04_h)
# conf_int_odds_ratios_04_h <- exp(conf_int_04_h)
# 
# conf_int_04_m <- confint(logit_model_04_m)
# conf_int_odds_ratios_04_m <- exp(conf_int_04_m)
# 
# # Confidence intervals for OLS model (coefficients and standard errors)
# conf_int_04_t <- confint(ols_model_04_t)
# 
# # Combine the odds ratios with their confidence intervals for logistic models
# CI_odds_04_h <- data.frame(Odds_Ratio = odds_ratios_04_h, 
#                            CI_Lower = conf_int_odds_ratios_04_h[, 1], 
#                            CI_Upper = conf_int_odds_ratios_04_h[, 2])
# 
# CI_odds_04_m <- data.frame(Odds_Ratio = odds_ratios_04_m, 
#                            CI_Lower = conf_int_odds_ratios_04_m[, 1], 
#                            CI_Upper = conf_int_odds_ratios_04_m[, 2])
# 
# 
# # Display odds ratios with confidence intervals using stargazer
# stargazer(CI_odds_04_h, CI_odds_04_m,
#           type = "latex",
#           out = "CI_odds_04_h_m.tex")
# 
# # Display coefficients with confidence intervals for the OLS model
# CI_coeff_04_t <- data.frame(Coefficient = coefficients_04_t,
#                             CI_Lower = conf_int_04_t[, 1],
#                             CI_Upper = conf_int_04_t[, 2])
# 
# stargazer(CI_coeff_04_t,
#           type = "latex",
#           out = "CI_coeff_04_t.tex")
```

